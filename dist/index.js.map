{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@brandembassy/chat-web-sdk/webpack/universalModuleDefinition","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventType.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/be-javascript-utils/dist/query/queryParameters.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-platform/dist/contact/ContactStatus.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/index.js","webpack://@brandembassy/chat-web-sdk/external umd \"ua-parser-js\"","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/websocket/WebSocketClient.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-platform/dist/post/case/CaseStatus.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-chat/dist/channel/ChannelInfo.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/eventTargetPolyfill/EventTargetPolyfill.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/websocket/WebSocketClientEvent.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-platform/dist/message/MessageType.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-chat/dist/user/BrowserFingerprint.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/node_modules/@brandembassy/be-javascript-utils/dist/collection/object.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/websocket/HeartBeatState.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-chat/dist/awsEvents/AwsChatWindowEvent.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/pushUpdate/pushUpdateWebSocket.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/websocket/initializeHeartbeat.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-platform/dist/http/headers.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/Logger.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/node_modules/@brandembassy/be-javascript-utils/dist/query/queryParameters.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/push-updates-sdk/dist/websocket/ReconnectingWebSocket.js","webpack://@brandembassy/chat-web-sdk/./node_modules/@brandembassy/ts-types-platform/dist/message/MessageDirection.js","webpack://@brandembassy/chat-web-sdk/webpack/bootstrap","webpack://@brandembassy/chat-web-sdk/webpack/runtime/compat get default export","webpack://@brandembassy/chat-web-sdk/webpack/runtime/define property getters","webpack://@brandembassy/chat-web-sdk/webpack/runtime/hasOwnProperty shorthand","webpack://@brandembassy/chat-web-sdk/webpack/runtime/make namespace object","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isNull.js","webpack://@brandembassy/chat-web-sdk/./src/variables/VariableStorage.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/accessTokenStorage.ts","webpack://@brandembassy/chat-web-sdk/./src/error/ChatSDKError.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/AuthorizationError.ts","webpack://@brandembassy/chat-web-sdk/./src/env/version.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/generateId.ts","webpack://@brandembassy/chat-web-sdk/./src/visitor/createVisitorPayload.ts","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_isPrototype.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_nativeKeys.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_overArg.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_baseKeys.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_freeGlobal.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_root.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_Symbol.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_getRawTag.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_objectToString.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_baseGetTag.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isObject.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isFunction.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_coreJsData.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_isMasked.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_toSource.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_baseIsNative.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_getNative.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_getValue.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_DataView.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_Map.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_Promise.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_Set.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_WeakMap.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_getTag.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isObjectLike.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_baseIsArguments.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isArguments.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isArray.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isLength.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isBuffer.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/stubFalse.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_baseIsTypedArray.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_nodeUtil.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isTypedArray.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/_baseUnary.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isEmpty.js","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isArrayLike.js","webpack://@brandembassy/chat-web-sdk/./src/request/requestQueue.ts","webpack://@brandembassy/chat-web-sdk/./src/request/makeRequest.ts","webpack://@brandembassy/chat-web-sdk/./src/request/requestRateLimit.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/splitName.ts","webpack://@brandembassy/chat-web-sdk/./src/error/errorMessages.ts","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isUndefined.js","webpack://@brandembassy/chat-web-sdk/./src/customField/CustomFields.ts","webpack://@brandembassy/chat-web-sdk/./src/customer/Customer.ts","webpack://@brandembassy/chat-web-sdk/./src/customer/setCustomerCustomFieldsPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/customer/CustomerInstance.ts","webpack://@brandembassy/chat-web-sdk/./src/customer/customerIdentityPayload.ts","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/isNil.js","webpack://@brandembassy/chat-web-sdk/./src/utils/getBrandIdAndChannelId.ts","webpack://@brandembassy/chat-web-sdk/./src/sockets/EventPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/event/sendChatEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/createReconnectPayloadData.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/handleRefreshToken.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/getAuthorizationTokenForUrl.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/generateAuthorizationTokenPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/isAuthorizationTokenGeneratedPostbackData.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/isAuthSuccessEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/isTokenRefreshedSuccessResponse.ts","webpack://@brandembassy/chat-web-sdk/./src/browserFingerprint/getBrowserFingerprint.ts","webpack://@brandembassy/chat-web-sdk/./src/request/defaultHeaders.ts","webpack://@brandembassy/chat-web-sdk/./src/error/AbortError.ts","webpack://@brandembassy/chat-web-sdk/./src/error/SdkVersionNotSupported.ts","webpack://@brandembassy/chat-web-sdk/./src/event/middleware/sdkVersionCheck.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/getNetworkInfo.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/isWindowClosing.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/SecureSessionsType.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/fetchJSON.ts","webpack://@brandembassy/chat-web-sdk/./src/request/getErrorResponseData.ts","webpack://@brandembassy/chat-web-sdk/./src/channel/fetchChannelAvailability.ts","webpack://@brandembassy/chat-web-sdk/./src/channel/fetchChannelInfo.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/getSecuredSessionType.ts","webpack://@brandembassy/chat-web-sdk/./src/env/Environments.ts","webpack://@brandembassy/chat-web-sdk/./src/env/setEnvironmentEndpoints.ts","webpack://@brandembassy/chat-web-sdk/./src/error/IpAddressBlockedError.ts","webpack://@brandembassy/chat-web-sdk/./src/event/ChatEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/event/ChatEventMiddleware.ts","webpack://@brandembassy/chat-web-sdk/./src/event/ChatEventTarget.ts","webpack://@brandembassy/chat-web-sdk/./src/agent/agentTyping.ts","webpack://@brandembassy/chat-web-sdk/./src/event/normalizeEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/event/middleware/ChatEventMapper.ts","webpack://@brandembassy/chat-web-sdk/./src/agent/assignedAgentChanged.ts","webpack://@brandembassy/chat-web-sdk/./src/contact/contactCreated.ts","webpack://@brandembassy/chat-web-sdk/./src/contact/contactStatusChanged.ts","webpack://@brandembassy/chat-web-sdk/./src/contact/contactToRoutingQueueAssignmentChanged.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/livechatThread/livechatRecovered.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/threadRecovered.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/assert.ts","webpack://@brandembassy/chat-web-sdk/./src/initializeSdkVariables.ts","webpack://@brandembassy/chat-web-sdk/./src/request/validateAndFilterHttpHeaders.ts","webpack://@brandembassy/chat-web-sdk/./src/request/validateAndFilterWebSocketQuery.ts","webpack://@brandembassy/chat-web-sdk/./src/message/MessageSuccessEventData.ts","webpack://@brandembassy/chat-web-sdk/./src/message/SendMessageFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/message/getAuthor.ts","webpack://@brandembassy/chat-web-sdk/./src/message/isMessage.ts","webpack://@brandembassy/chat-web-sdk/./src/message/isMessageCreatedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/message/isMessageSentEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/message/isMessageReadChangedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/message/fetchMessageWithFullContent.ts","webpack://@brandembassy/chat-web-sdk/./src/request/isS3ChatEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/request/getEventData.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/cachedTransactionTokenResponse.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/getAuthorizeUrl.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/identityToken.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/thirdPartyTokenStorage.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/refreshThirdPartyToken.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/handleNewThirdPartyToken.ts","webpack://@brandembassy/chat-web-sdk/./src/sockets/WebSocketClientError.ts","webpack://@brandembassy/chat-web-sdk/./src/sockets/WsEventTarget.ts","webpack://@brandembassy/chat-web-sdk/./src/sockets/WebSocketClient.ts","webpack://@brandembassy/chat-web-sdk/./src/attachment/UploadAttachmentError.ts","webpack://@brandembassy/chat-web-sdk/./src/attachment/sendAttachments.ts","webpack://@brandembassy/chat-web-sdk/./src/attachment/createPayloadForAttachmentUpload.ts","webpack://@brandembassy/chat-web-sdk/./src/attachment/localFileReader.ts","webpack://@brandembassy/chat-web-sdk/./src/attachment/uploadAttachment.ts","webpack://@brandembassy/chat-web-sdk/./src/contact/isContactStatusChangedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/contact/isContactCreatedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/contact/isContactToRoutingQueueAssignmentChangedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/contact/isContactRecipientsChangedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/message/createMessageData.ts","webpack://@brandembassy/chat-web-sdk/./src/message/loadMoreMessagesEventData.ts","webpack://@brandembassy/chat-web-sdk/./src/message/loadMoreMessagesPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/AbortablePromise.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/ArchiveThreadFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/GetMetadataFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/isLoadMetadataSuccessPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/isRecoverSuccessPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/isThreadArchivedSuccessPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/LoadMoreMessagesFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/recoverThreadPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/SetThreadNameFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/ThreadRecoverFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/Thread.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/assertNonEmptyTextMessageContent.ts","webpack://@brandembassy/chat-web-sdk/./src/message/sendMessage.ts","webpack://@brandembassy/chat-web-sdk/./src/message/sendMessagePayload.ts","webpack://@brandembassy/chat-web-sdk/./src/message/getTextMessageContent.ts","webpack://@brandembassy/chat-web-sdk/./src/message/getPostbackMessageContent.ts","webpack://@brandembassy/chat-web-sdk/./src/message/sendOutboundMessage.ts","webpack://@brandembassy/chat-web-sdk/./src/message/sendOutboundMessagePayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/lastMessageSeenPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/typingEvents.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/metadata.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/threadEventHandler.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/setThreadCustomFieldsPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/archiveThread.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/updateThread.ts","webpack://@brandembassy/chat-web-sdk/./src/message/sendMessagePreviewPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/transcript.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/livechatThread/recoverLivechatThreadPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/livechatThread/LivechatThread.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/livechatThread/createEndThreadPayloadData.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/isThreadListFetchedPostbackData.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/storeContactId.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/storeContactIdMiddleware.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/storeThreadScrollData.ts","webpack://@brandembassy/chat-web-sdk/./node_modules/lodash-es/last.js","webpack://@brandembassy/chat-web-sdk/./src/thread/storeThreadScrollDataMiddleware.ts","webpack://@brandembassy/chat-web-sdk/./src/ChatSdk.ts","webpack://@brandembassy/chat-web-sdk/./src/utils/getPromiseWithResolvers.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/createRefreshTokenPayload.ts","webpack://@brandembassy/chat-web-sdk/./src/env/appName.ts","webpack://@brandembassy/chat-web-sdk/./src/customer/setCustomerIdFromOptions.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/authorizationReconnect.ts","webpack://@brandembassy/chat-web-sdk/./src/channel/handleBasicChannelInfo.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/authorizationPayloadData.ts","webpack://@brandembassy/chat-web-sdk/./src/customer/isCustomerIdentityIdValid.ts","webpack://@brandembassy/chat-web-sdk/./src/message/sendOfflineMessage.ts","webpack://@brandembassy/chat-web-sdk/./src/message/sendOfflineMessagePayload.ts","webpack://@brandembassy/chat-web-sdk/./src/agent/isAssignedAgentChangedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/agent/isAgentTypingStartedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/agent/isAgentTypingEndedEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/securedSession/getTransactionToken.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/isIpAddressBlockedError.ts","webpack://@brandembassy/chat-web-sdk/./src/message/getMessageFullContent.ts","webpack://@brandembassy/chat-web-sdk/./src/request/messageHandler.ts","webpack://@brandembassy/chat-web-sdk/./src/thread/livechatThread/isSetPositionInQueueEvent.ts","webpack://@brandembassy/chat-web-sdk/./src/groupChat/CreateInvitationFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/groupChat/createInvitation.ts","webpack://@brandembassy/chat-web-sdk/./src/error/isChatSDKError.ts","webpack://@brandembassy/chat-web-sdk/./src/groupChat/JoinGroupChatFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/groupChat/joinGroupChat.ts","webpack://@brandembassy/chat-web-sdk/./src/groupChat/leaveGroupChat.ts","webpack://@brandembassy/chat-web-sdk/./src/groupChat/SendEmailInvitationFailedError.ts","webpack://@brandembassy/chat-web-sdk/./src/groupChat/sendEmailInvitation.ts","webpack://@brandembassy/chat-web-sdk/./src/storage/CacheStorageError.ts","webpack://@brandembassy/chat-web-sdk/./src/storage/CacheStorage.ts","webpack://@brandembassy/chat-web-sdk/./src/authorization/CustomerReconnectSuccessPayloadData.ts","webpack://@brandembassy/chat-web-sdk/./src/channel/getChannelInfo.ts","webpack://@brandembassy/chat-web-sdk/./src/channel/getChannelAvailability.ts","webpack://@brandembassy/chat-web-sdk/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"ua-parser-js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"ua-parser-js\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"ua-parser-js\")) : factory(root[\"ua-parser-js\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, (__WEBPACK_EXTERNAL_MODULE__198__) => {\nreturn ","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PushUpdateEventType = void 0;\nvar PushUpdateEventType;\n(function (PushUpdateEventType) {\n    PushUpdateEventType[\"AUTHORIZE_CONSUMER\"] = \"AuthorizeConsumer\";\n    /** @deprecated use CONTACT_CREATED */\n    PushUpdateEventType[\"CASE_CREATED\"] = \"CaseCreated\";\n    /** @deprecated use ASSIGNED_AGENT_CHANGED */\n    PushUpdateEventType[\"CASE_INBOX_ASSIGNEE_CHANGED\"] = \"CaseInboxAssigneeChanged\";\n    /** @deprecated use CONTACT_STATUS_CHANGED */\n    PushUpdateEventType[\"CASE_STATUS_CHANGED\"] = \"CaseStatusChanged\";\n    /** @deprecated use CONTACT_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED */\n    PushUpdateEventType[\"CASE_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED\"] = \"CaseToRoutingQueueAssignmentChanged\";\n    PushUpdateEventType[\"CONTACT_CREATED\"] = \"CaseCreated\";\n    PushUpdateEventType[\"ASSIGNED_AGENT_CHANGED\"] = \"CaseInboxAssigneeChanged\";\n    PushUpdateEventType[\"CONTACT_STATUS_CHANGED\"] = \"CaseStatusChanged\";\n    PushUpdateEventType[\"CONTACT_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED\"] = \"CaseToRoutingQueueAssignmentChanged\";\n    PushUpdateEventType[\"CONTACT_PREFERRED_USER_CHANGED\"] = \"ContactPreferredUserChanged\";\n    PushUpdateEventType[\"CONTACT_PROFICIENCY_CHANGED\"] = \"ContactProficiencyChanged\";\n    PushUpdateEventType[\"CONTACT_PRIORITY_CHANGED\"] = \"ContactPriorityChanged\";\n    PushUpdateEventType[\"CONTACT_SYNC\"] = \"ContactSync\";\n    PushUpdateEventType[\"CHANNEL_CREATED\"] = \"ChannelCreated\";\n    PushUpdateEventType[\"CHANNEL_DELETED\"] = \"ChannelDeleted\";\n    PushUpdateEventType[\"CHANNEL_UPDATED\"] = \"ChannelUpdated\";\n    PushUpdateEventType[\"MESSAGE_ADDED_INTO_CASE\"] = \"MessageAddedIntoCase\";\n    PushUpdateEventType[\"MESSAGE_CREATED\"] = \"MessageCreated\";\n    PushUpdateEventType[\"MESSAGE_DELIVERED_TO_END_USER\"] = \"MessageDeliveredToEndUser\";\n    PushUpdateEventType[\"MESSAGE_DELIVERED_TO_USER\"] = \"MessageDeliveredToUser\";\n    PushUpdateEventType[\"MESSAGE_DELIVERY_STATUS_CHANGED\"] = \"MessageDeliveryStatusChanged\";\n    PushUpdateEventType[\"MESSAGE_NOTE_CREATED\"] = \"MessageNoteCreated\";\n    PushUpdateEventType[\"MESSAGE_NOTE_UPDATED\"] = \"MessageNoteUpdated\";\n    PushUpdateEventType[\"MESSAGE_NOTE_DELETED\"] = \"MessageNoteDeleted\";\n    PushUpdateEventType[\"MESSAGE_READ_CHANGED\"] = \"MessageReadChanged\";\n    PushUpdateEventType[\"MESSAGE_SEEN_BY_END_USER\"] = \"MessageSeenByEndUser\";\n    PushUpdateEventType[\"MESSAGE_SEEN_BY_USER\"] = \"MessageSeenByUser\";\n    PushUpdateEventType[\"MESSAGE_SEEN_CHANGED\"] = \"MessageSeenChanged\";\n    PushUpdateEventType[\"MESSAGE_SENT\"] = \"MessageSent\";\n    PushUpdateEventType[\"MESSAGE_UPDATED\"] = \"MessageUpdated\";\n    PushUpdateEventType[\"PAGE_VIEW_CREATED\"] = \"PageViewCreated\";\n    PushUpdateEventType[\"ROUTING_QUEUE_CREATED\"] = \"RoutingQueueCreated\";\n    PushUpdateEventType[\"ROUTING_QUEUE_DELETED\"] = \"RoutingQueueDeleted\";\n    PushUpdateEventType[\"ROUTING_QUEUE_UPDATED\"] = \"RoutingQueueUpdated\";\n    PushUpdateEventType[\"SUBQUEUE_ASSIGNED_TO_ROUTING_QUEUE\"] = \"SubqueueAssignedToRoutingQueue\";\n    PushUpdateEventType[\"SUBQUEUE_UNASSIGNED_TO_ROUTING_QUEUE\"] = \"SubqueueUnassignedFromRoutingQueue\";\n    PushUpdateEventType[\"USER_ASSIGNED_TO_ROUTING_QUEUE\"] = \"UserAssignedToRoutingQueue\";\n    PushUpdateEventType[\"USER_STATUS_CHANGED\"] = \"UserStatusChanged\";\n    PushUpdateEventType[\"USER_UNASSIGNED_FROM_ROUTING_QUEUE\"] = \"UserUnassignedFromRoutingQueue\";\n    PushUpdateEventType[\"AGENT_CONTACT_STARTED\"] = \"AgentContactStarted\";\n    PushUpdateEventType[\"AGENT_CONTACT_ENDED\"] = \"AgentContactEnded\";\n    PushUpdateEventType[\"SENDER_TYPING_STARTED\"] = \"SenderTypingStarted\";\n    PushUpdateEventType[\"SENDER_TYPING_ENDED\"] = \"SenderTypingEnded\";\n    PushUpdateEventType[\"FIRE_PROACTIVE\"] = \"FireProactiveAction\";\n    PushUpdateEventType[\"CONTACT_INBOX_PRE_ASSIGNEE_CHANGED\"] = \"ConsumerContactInboxPreAssigneeChanged\";\n    PushUpdateEventType[\"CONTACT_RECIPIENTS_CHANGED\"] = \"ContactRecipientsChanged\";\n    PushUpdateEventType[\"MESSAGE_PREVIEW_CREATED\"] = \"MessagePreviewCreated\";\n    PushUpdateEventType[\"EVENT_IN_S3\"] = \"EventInS3\";\n})(PushUpdateEventType || (exports.PushUpdateEventType = PushUpdateEventType = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createQueryParametersAsString = void 0;\nfunction createQueryParametersAsString(queryParameters) {\n    return Object.keys(queryParameters)\n        .filter(function (key) { return queryParameters[key] !== null; })\n        .map(function (key) {\n        return [key, queryParameters[key]].map(encodeURIComponent).join('=');\n    })\n        .join('&');\n}\nexports.createQueryParametersAsString = createQueryParametersAsString;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ContactStatus = void 0;\nvar CaseStatus_1 = require(\"../post/case/CaseStatus\");\nObject.defineProperty(exports, \"ContactStatus\", { enumerable: true, get: function () { return CaseStatus_1.CaseStatus; } });\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setupSocketConnection = exports.WebSocketClientEvent = exports.WebSocketClient = exports.EventTargetPolyfill = exports.HeartBeatState = void 0;\nvar HeartBeatState_1 = require(\"./websocket/HeartBeatState\");\nObject.defineProperty(exports, \"HeartBeatState\", { enumerable: true, get: function () { return HeartBeatState_1.HeartBeatState; } });\nvar EventTargetPolyfill_1 = require(\"./eventTargetPolyfill/EventTargetPolyfill\");\nObject.defineProperty(exports, \"EventTargetPolyfill\", { enumerable: true, get: function () { return EventTargetPolyfill_1.EventTargetPolyfill; } });\nvar WebSocketClient_1 = require(\"./websocket/WebSocketClient\");\nObject.defineProperty(exports, \"WebSocketClient\", { enumerable: true, get: function () { return WebSocketClient_1.WebSocketClient; } });\nvar WebSocketClientEvent_1 = require(\"./websocket/WebSocketClientEvent\");\nObject.defineProperty(exports, \"WebSocketClientEvent\", { enumerable: true, get: function () { return WebSocketClientEvent_1.WebSocketClientEvent; } });\nvar pushUpdateWebSocket_1 = require(\"./pushUpdate/pushUpdateWebSocket\");\nObject.defineProperty(exports, \"setupSocketConnection\", { enumerable: true, get: function () { return pushUpdateWebSocket_1.setupSocketConnection; } });\n//# sourceMappingURL=index.js.map","module.exports = __WEBPACK_EXTERNAL_MODULE__198__;","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketClient = exports.HEART_BEAT_CHECK_TIMEOUT = exports.HEART_BEAT_INTERVAL = void 0;\nvar Logger_1 = require(\"../Logger\");\nvar ReconnectingWebSocket_1 = require(\"./ReconnectingWebSocket\");\nvar EventTargetPolyfill_1 = require(\"../eventTargetPolyfill/EventTargetPolyfill\");\nvar HeartBeatState_1 = require(\"./HeartBeatState\");\nvar WebSocketClientEvent_1 = require(\"./WebSocketClientEvent\");\nexports.HEART_BEAT_INTERVAL = 15000;\nexports.HEART_BEAT_CHECK_TIMEOUT = exports.HEART_BEAT_INTERVAL * 3;\nvar HEART_BEAT_RESPONSE = 'pong';\nvar HEART_BEAT_ACTION_NAME = 'heartbeat';\nvar WebSocketClient = (function (_super) {\n    __extends(WebSocketClient, _super);\n    function WebSocketClient(url, protocols, options) {\n        var _this = _super.call(this) || this;\n        _this.heartBeatTimeout = null;\n        _this.heartBeatCheckTimeout = null;\n        _this.enableDebugMode = function () {\n            if (!_this.debugMode) {\n                _this.log(Logger_1.LogLevels.INFO, 'websocket-push-updates--loggerEnabled');\n            }\n            _this.debugMode = true;\n        };\n        _this.disableDebugMode = function () {\n            _this.debugMode = false;\n        };\n        _this.log = function (level, message, args) {\n            if (_this.debugMode && _this.logger) {\n                _this.logger[level](message, args);\n            }\n        };\n        _this.sendHeartBeat = function () {\n            _this.log(Logger_1.LogLevels.INFO, 'websocket-push-updates--sendHeartBeat');\n            _this.send(JSON.stringify({ action: HEART_BEAT_ACTION_NAME }));\n        };\n        _this.handleHeartBeatResponse = function () {\n            if (_this.heartBeatState === HeartBeatState_1.HeartBeatState.DYING) {\n                _this.heartBeatState = HeartBeatState_1.HeartBeatState.LIVING;\n                _this.dispatchHeartBeatState();\n            }\n            _this.setHeartBeatCheckTimeout();\n        };\n        _this.setHeartBeatCheckTimeout = function () {\n            if (_this.heartBeatCheckTimeout !== null) {\n                clearTimeout(_this.heartBeatCheckTimeout);\n            }\n            _this.heartBeatCheckTimeout = setTimeout(function () {\n                _this.heartBeatState = HeartBeatState_1.HeartBeatState.DYING;\n                _this.dispatchHeartBeatState();\n            }, exports.HEART_BEAT_CHECK_TIMEOUT);\n        };\n        _this.dispatchHeartBeatState = function () {\n            _this.log(Logger_1.LogLevels.INFO, 'websocket-push-updates--dispatchHeartBeatState', [\n                { heartbeatState: _this.heartBeatState },\n            ]);\n            if (_this.heartBeatState !== null) {\n                _this.dispatchEvent(new CustomEvent(_this.heartBeatState));\n            }\n        };\n        _this.isHeartBeatActive = function () { return _this.heartBeatState !== null; };\n        _this.heartBeatState = null;\n        _this.debugMode = false;\n        _this.socket = new ReconnectingWebSocket_1.ReconnectingWebSocket(url, protocols, options);\n        _this.socket.onopen = function () {\n            _this.dispatchEvent(new CustomEvent(WebSocketClientEvent_1.WebSocketClientEvent.OPEN));\n        };\n        if (options === null || options === void 0 ? void 0 : options.logger) {\n            _this.logger = options.logger;\n        }\n        _this.socket.onclose = function (closeEvent) {\n            if (_this.socket.retryCount === (options === null || options === void 0 ? void 0 : options.maxRetries)) {\n                _this.heartBeatState = HeartBeatState_1.HeartBeatState.DIED;\n            }\n            else {\n                _this.heartBeatState = HeartBeatState_1.HeartBeatState.DYING;\n            }\n            _this.dispatchHeartBeatState();\n            _this.dispatchEvent(new CustomEvent(WebSocketClientEvent_1.WebSocketClientEvent.CLOSE, { detail: closeEvent }));\n        };\n        _this.socket.onmessage = function (event) {\n            _this.handleHeartBeatResponse();\n            if (JSON.parse(event.data) !== HEART_BEAT_RESPONSE) {\n                _this.log(Logger_1.LogLevels.INFO, 'websocket-push-updates--onmessage', [event]);\n                _this.dispatchEvent(new CustomEvent(WebSocketClientEvent_1.WebSocketClientEvent.MESSAGE, { detail: event }));\n            }\n        };\n        _this.socket.onerror = function (event) {\n            _this.log(Logger_1.LogLevels.ERROR, 'websocket-push-updates--onError', [event]);\n            _this.dispatchEvent(new CustomEvent(WebSocketClientEvent_1.WebSocketClientEvent.ERROR, { detail: event }));\n        };\n        return _this;\n    }\n    WebSocketClient.prototype.send = function (data) {\n        this.socket.send(data);\n    };\n    WebSocketClient.prototype.startHeartBeat = function () {\n        var _this = this;\n        this.log(Logger_1.LogLevels.INFO, 'websocket-push-updates--startHeartBeat', [\n            { interval: exports.HEART_BEAT_INTERVAL },\n        ]);\n        var heartBeatCallback = function () {\n            _this.log(Logger_1.LogLevels.INFO, 'websocket-push-updates--heartBeatCallback');\n            _this.sendHeartBeat();\n            _this.heartBeatTimeout = setTimeout(heartBeatCallback, exports.HEART_BEAT_INTERVAL);\n        };\n        this.setHeartBeatCheckTimeout();\n        heartBeatCallback();\n        this.heartBeatState = HeartBeatState_1.HeartBeatState.LIVING;\n    };\n    WebSocketClient.prototype.stopHeartBeat = function () {\n        this.log(Logger_1.LogLevels.INFO, 'websocket-push-updates--stopHeartBeat');\n        if (this.heartBeatTimeout !== null) {\n            clearTimeout(this.heartBeatTimeout);\n        }\n        if (this.heartBeatCheckTimeout !== null) {\n            clearTimeout(this.heartBeatCheckTimeout);\n        }\n        this.heartBeatState = null;\n    };\n    return WebSocketClient;\n}(EventTargetPolyfill_1.EventTargetPolyfill));\nexports.WebSocketClient = WebSocketClient;\n//# sourceMappingURL=WebSocketClient.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CaseStatus = void 0;\nvar CaseStatus;\n(function (CaseStatus) {\n    CaseStatus[\"NEW\"] = \"new\";\n    CaseStatus[\"OPEN\"] = \"open\";\n    CaseStatus[\"PENDING\"] = \"pending\";\n    CaseStatus[\"ESCALATED\"] = \"escalated\";\n    CaseStatus[\"RESOLVED\"] = \"resolved\";\n    CaseStatus[\"CLOSED\"] = \"closed\";\n    CaseStatus[\"TRASHED\"] = \"trashed\";\n})(CaseStatus || (exports.CaseStatus = CaseStatus = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ChannelAvailability = void 0;\nvar ChannelAvailability;\n(function (ChannelAvailability) {\n    ChannelAvailability[\"ONLINE\"] = \"online\";\n    ChannelAvailability[\"OFFLINE\"] = \"offline\";\n})(ChannelAvailability || (exports.ChannelAvailability = ChannelAvailability = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EventTargetPolyfill = void 0;\nvar EventTargetPolyfill = (function () {\n    function EventTargetPolyfill() {\n        this.listeners = {};\n    }\n    EventTargetPolyfill.prototype.addEventListener = function (type, callback) {\n        if (!(type in this.listeners)) {\n            this.listeners[type] = [];\n        }\n        this.listeners[type].push(callback);\n    };\n    EventTargetPolyfill.prototype.removeEventListener = function (type, callback) {\n        if (!(type in this.listeners)) {\n            return;\n        }\n        var stack = this.listeners[type];\n        for (var i = 0, l = stack.length; i < l; i++) {\n            if (stack[i] === callback) {\n                stack.splice(i, 1);\n                return;\n            }\n        }\n    };\n    EventTargetPolyfill.prototype.dispatchEvent = function (event) {\n        if (!(event.type in this.listeners)) {\n            return true;\n        }\n        var stack = this.listeners[event.type].slice();\n        for (var i = 0, l = stack.length; i < l; i++) {\n            stack[i].call(this, event);\n        }\n        return !event.defaultPrevented;\n    };\n    return EventTargetPolyfill;\n}());\nexports.EventTargetPolyfill = EventTargetPolyfill;\n//# sourceMappingURL=EventTargetPolyfill.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketClientEvent = void 0;\nvar WebSocketClientEvent;\n(function (WebSocketClientEvent) {\n    WebSocketClientEvent[\"CLOSE\"] = \"close\";\n    WebSocketClientEvent[\"ERROR\"] = \"error\";\n    WebSocketClientEvent[\"MESSAGE\"] = \"message\";\n    WebSocketClientEvent[\"OPEN\"] = \"open\";\n    WebSocketClientEvent[\"AUTHORIZATION_FAILED\"] = \"authorizationFailed\";\n})(WebSocketClientEvent = exports.WebSocketClientEvent || (exports.WebSocketClientEvent = {}));\n//# sourceMappingURL=WebSocketClientEvent.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MessageType = void 0;\nvar MessageType;\n(function (MessageType) {\n    MessageType[\"TEXT\"] = \"TEXT\";\n    MessageType[\"FILE\"] = \"FILE\";\n    MessageType[\"FORM\"] = \"FORM\";\n    MessageType[\"PLUGIN\"] = \"PLUGIN\";\n    MessageType[\"POSTBACK\"] = \"POSTBACK\";\n    MessageType[\"QUICK_REPLIES\"] = \"QUICK_REPLIES\";\n    MessageType[\"RICH_LINK\"] = \"RICH_LINK\";\n    MessageType[\"LIST_PICKER\"] = \"LIST_PICKER\";\n    MessageType[\"ADAPTIVE_CARD\"] = \"ADAPTIVE_CARD\";\n    MessageType[\"TIME_PICKER\"] = \"TIME_PICKER\";\n})(MessageType || (exports.MessageType = MessageType = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ApplicationType = exports.DeviceType = void 0;\nvar DeviceType;\n(function (DeviceType) {\n    DeviceType[\"DESKTOP\"] = \"desktop\";\n    DeviceType[\"MOBILE\"] = \"mobile\";\n    DeviceType[\"OTHER\"] = \"other\";\n    DeviceType[\"TABLET\"] = \"tablet\";\n})(DeviceType || (exports.DeviceType = DeviceType = {}));\nvar ApplicationType;\n(function (ApplicationType) {\n    ApplicationType[\"BROWSER\"] = \"browser\";\n})(ApplicationType || (exports.ApplicationType = ApplicationType = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AwsResponseEventType = exports.AwsInputEventType = void 0;\nvar AwsInputEventType;\n(function (AwsInputEventType) {\n    AwsInputEventType[\"SENDER_TYPING_STARTED\"] = \"SenderTypingStarted\";\n    AwsInputEventType[\"SENDER_TYPING_ENDED\"] = \"SenderTypingEnded\";\n    AwsInputEventType[\"LOAD_MORE_MESSAGES\"] = \"LoadMoreMessages\";\n    AwsInputEventType[\"RECOVER_LIVECHAT\"] = \"RecoverLivechat\";\n    AwsInputEventType[\"RECOVER_THREAD\"] = \"RecoverThread\";\n    AwsInputEventType[\"SEND_MESSAGE\"] = \"SendMessage\";\n    AwsInputEventType[\"SEND_OUTBOUND\"] = \"SendOutbound\";\n    AwsInputEventType[\"SEND_OFFLINE_MESSAGE\"] = \"SendOfflineMessage\";\n    AwsInputEventType[\"SEND_PAGE_VIEWS\"] = \"SendPageViews\";\n    AwsInputEventType[\"SEND_CONSUMER_CUSTOM_FIELDS\"] = \"SetConsumerCustomFields\";\n    AwsInputEventType[\"SET_CONSUMER_CONTACT_CUSTOM_FIELD\"] = \"SetConsumerContactCustomFields\";\n    AwsInputEventType[\"MESSAGE_SEEN\"] = \"MessageSeenByConsumer\";\n    AwsInputEventType[\"SEND_TRANSCRIPT\"] = \"SendTranscript\";\n    AwsInputEventType[\"FETCH_THREAD_LIST\"] = \"FetchThreadList\";\n    AwsInputEventType[\"END_CONTACT\"] = \"EndContact\";\n    AwsInputEventType[\"EXECUTE_TRIGGER\"] = \"ExecuteTrigger\";\n    AwsInputEventType[\"AUTHORIZE_CONSUMER\"] = \"AuthorizeConsumer\";\n    AwsInputEventType[\"AUTHORIZE_CUSTOMER\"] = \"AuthorizeCustomer\";\n    AwsInputEventType[\"RECONNECT_CONSUMER\"] = \"ReconnectConsumer\";\n    AwsInputEventType[\"UPDATE_THREAD\"] = \"UpdateThread\";\n    AwsInputEventType[\"ARCHIVE_THREAD\"] = \"ArchiveThread\";\n    AwsInputEventType[\"LOAD_THREAD_METADATA\"] = \"LoadThreadMetadata\";\n    AwsInputEventType[\"REFRESH_TOKEN\"] = \"RefreshToken\";\n    AwsInputEventType[\"STORE_VISITOR\"] = \"StoreVisitor\";\n    AwsInputEventType[\"STORE_VISITOR_EVENTS\"] = \"StoreVisitorEvents\";\n    AwsInputEventType[\"CREATE_GROUP_CHAT_INVITE\"] = \"CreateInvitationToGroupChat\";\n    AwsInputEventType[\"SEND_EMAIL_INVITE_TO_GROUP_CHAT\"] = \"SendEmailInvitationToGroupChat\";\n    AwsInputEventType[\"JOIN_GROUP_CHAT\"] = \"JoinGroupChat\";\n    AwsInputEventType[\"LEAVE_GROUP_CHAT\"] = \"LeaveGroupChat\";\n    AwsInputEventType[\"GENERATE_AUTHORIZATION_TOKEN\"] = \"GenerateAuthorizationToken\";\n    AwsInputEventType[\"ADD_VISITOR_TAGS\"] = \"AddVisitorTags\";\n    AwsInputEventType[\"REMOVE_VISITOR_TAGS\"] = \"RemoveVisitorTags\";\n    AwsInputEventType[\"SEND_MESSAGE_PREVIEW\"] = \"SendMessagePreview\";\n})(AwsInputEventType || (exports.AwsInputEventType = AwsInputEventType = {}));\nvar AwsResponseEventType;\n(function (AwsResponseEventType) {\n    AwsResponseEventType[\"LIVECHAT_RECOVERED\"] = \"LivechatRecovered\";\n    AwsResponseEventType[\"MORE_MESSAGES_LOADED\"] = \"MoreMessagesLoaded\";\n    AwsResponseEventType[\"OFFLINE_MESSAGE_SENT\"] = \"OfflineMessageSent\";\n    AwsResponseEventType[\"THREAD_LIST_FETCHED\"] = \"ThreadListFetched\";\n    AwsResponseEventType[\"THREAD_RECOVERED\"] = \"ThreadRecovered\";\n    AwsResponseEventType[\"TRANSCRIPT_SENT\"] = \"TranscriptSent\";\n    AwsResponseEventType[\"CONSUMER_AUTHORIZED\"] = \"ConsumerAuthorized\";\n    AwsResponseEventType[\"THREAD_METADATA_LOADED\"] = \"ThreadMetadataLoaded\";\n    AwsResponseEventType[\"SET_POSITION_IN_QUEUE\"] = \"SetPositionInQueue\";\n    AwsResponseEventType[\"GROUP_CHAT_INVITE_CREATED\"] = \"InvitationToGroupChatCreated\";\n    AwsResponseEventType[\"GROUP_CHAT_INVITE_SENT\"] = \"EmailInvitationToGroupChatSent\";\n    AwsResponseEventType[\"GROUP_CHAT_JOINED\"] = \"GroupChatJoined\";\n    AwsResponseEventType[\"TOKEN_REFRESHED\"] = \"TokenRefreshed\";\n    AwsResponseEventType[\"AUTHORIZATION_TOKEN_GENERATED\"] = \"AuthorizationTokenGenerated\";\n    AwsResponseEventType[\"THREAD_ARCHIVED\"] = \"ThreadArchived\";\n})(AwsResponseEventType || (exports.AwsResponseEventType = AwsResponseEventType = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.removeEmptyValuesFromObject = void 0;\nfunction removeEmptyValuesFromObject(objectData) {\n    return Object.entries(objectData)\n        .filter(function (_a) {\n        var key = _a[0], value = _a[1];\n        return value !== undefined && value !== null;\n    })\n        .reduce(function (result, _a) {\n        var key = _a[0], value = _a[1];\n        result[key] = value;\n        return result;\n    }, {});\n}\nexports.removeEmptyValuesFromObject = removeEmptyValuesFromObject;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HeartBeatState = void 0;\nvar HeartBeatState;\n(function (HeartBeatState) {\n    HeartBeatState[\"DIED\"] = \"died\";\n    HeartBeatState[\"DYING\"] = \"dying\";\n    HeartBeatState[\"LIVING\"] = \"living\";\n})(HeartBeatState = exports.HeartBeatState || (exports.HeartBeatState = {}));\n//# sourceMappingURL=HeartBeatState.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AwsChatWindowEventActionRoute = void 0;\nvar AwsChatWindowEventActionRoute;\n(function (AwsChatWindowEventActionRoute) {\n    AwsChatWindowEventActionRoute[\"CHAT_WINDOW_EVENT\"] = \"chatWindowEvent\";\n    AwsChatWindowEventActionRoute[\"REGISTER\"] = \"register\";\n})(AwsChatWindowEventActionRoute || (exports.AwsChatWindowEventActionRoute = AwsChatWindowEventActionRoute = {}));\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getPushUpdateWebSocket = exports.setupSocketConnection = void 0;\nvar queryParameters_1 = require(\"@brandembassy/be-javascript-utils/dist/query/queryParameters\");\nvar initializeHeartbeat_1 = require(\"../websocket/initializeHeartbeat\");\nvar object_1 = require(\"@brandembassy/be-javascript-utils/dist/collection/object\");\nvar WebSocketClient_1 = require(\"../websocket/WebSocketClient\");\nvar socket = null;\nfunction createWebSocketUrlWithProtocol(webSocketUrlWithoutProtocol, forceSecureProtocol, query) {\n    if (query === void 0) { query = {}; }\n    var queryString = (0, queryParameters_1.createQueryParametersAsString)((0, object_1.removeEmptyValuesFromObject)(query));\n    var protocol = forceSecureProtocol || window.location.protocol === 'https:'\n        ? \"wss:\"\n        : 'ws:';\n    if (queryString.length === 0) {\n        return \"\".concat(protocol, \"//\").concat(webSocketUrlWithoutProtocol);\n    }\n    var url = new URL(\"\".concat(protocol, \"//\").concat(webSocketUrlWithoutProtocol));\n    if (url.search.length > 0) {\n        return \"\".concat(protocol, \"//\").concat(webSocketUrlWithoutProtocol, \"&\").concat(queryString);\n    }\n    return \"\".concat(protocol, \"//\").concat(webSocketUrlWithoutProtocol, \"?\").concat(queryString);\n}\nvar defaultConnectionOptions = {\n    forceSecureProtocol: false,\n    heartbeatAfterAuthorize: false,\n    maxRetries: 20,\n    maxReconnectionDelay: 1000,\n};\nvar setupSocketConnection = function (urlProvider, options) {\n    if (options === void 0) { options = {}; }\n    if (typeof options !== 'object') {\n        throw new TypeError(\"Options parameter must be an object not a \".concat(typeof options));\n    }\n    var connectionOptions = __assign(__assign({}, defaultConnectionOptions), options);\n    var forceSecureProtocol = connectionOptions.forceSecureProtocol, heartbeatAfterAuthorize = connectionOptions.heartbeatAfterAuthorize, tenantId = connectionOptions.tenantId, userId = connectionOptions.userId, brandId = connectionOptions.brandId, wscOptions = __rest(connectionOptions, [\"forceSecureProtocol\", \"heartbeatAfterAuthorize\", \"tenantId\", \"userId\", \"brandId\"]);\n    if (typeof urlProvider === 'string') {\n        urlProvider = createWebSocketUrlWithProtocol(urlProvider, forceSecureProtocol, { tenantId: tenantId, userId: userId, brandId: brandId });\n    }\n    socket = new WebSocketClient_1.WebSocketClient(urlProvider, undefined, wscOptions);\n    (0, initializeHeartbeat_1.initializeHeartbeat)(heartbeatAfterAuthorize, socket, options);\n    return socket;\n};\nexports.setupSocketConnection = setupSocketConnection;\nvar getPushUpdateWebSocket = function () { return socket; };\nexports.getPushUpdateWebSocket = getPushUpdateWebSocket;\n//# sourceMappingURL=pushUpdateWebSocket.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.initializeHeartbeat = void 0;\nvar WebSocketClientEvent_1 = require(\"./WebSocketClientEvent\");\nfunction initializeHeartbeat(heartbeatAfterAuthorize, socket, connectionOptions) {\n    if (!heartbeatAfterAuthorize) {\n        socket.startHeartBeat();\n        return;\n    }\n    var handleMessage = function (event) {\n        var _a;\n        try {\n            var payload = JSON.parse(event.detail.data);\n            if ((payload === null || payload === void 0 ? void 0 : payload.authorizationStatus) === 'authorized') {\n                socket.startHeartBeat();\n                socket.removeEventListener(WebSocketClientEvent_1.WebSocketClientEvent.MESSAGE, handleMessage);\n            }\n        }\n        catch (error) {\n            (_a = connectionOptions === null || connectionOptions === void 0 ? void 0 : connectionOptions.logger) === null || _a === void 0 ? void 0 : _a.warn('JSON cannot be parsed during the heartbeat initialization process.');\n        }\n    };\n    socket.addEventListener(WebSocketClientEvent_1.WebSocketClientEvent.MESSAGE, handleMessage);\n}\nexports.initializeHeartbeat = initializeHeartbeat;\n//# sourceMappingURL=initializeHeartbeat.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.USER_AGENT = exports.TRANSACTION_ID = exports.TRACE_ID = exports.CALLER_SERVICE_ID = void 0;\nexports.CALLER_SERVICE_ID = 'X-Caller-Service-ID';\nexports.TRACE_ID = 'X-Trace-ID';\nexports.TRANSACTION_ID = 'X-Transaction-ID';\nexports.USER_AGENT = 'User-Agent';\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LogLevels = void 0;\nvar LogLevels;\n(function (LogLevels) {\n    LogLevels[\"ERROR\"] = \"error\";\n    LogLevels[\"INFO\"] = \"info\";\n    LogLevels[\"WARN\"] = \"warn\";\n})(LogLevels = exports.LogLevels || (exports.LogLevels = {}));\n//# sourceMappingURL=Logger.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createQueryParametersAsString = void 0;\nfunction createQueryParametersAsString(queryParameters) {\n    return Object.keys(queryParameters)\n        .filter(function (key) { return queryParameters[key] !== null; })\n        .map(function (key) {\n        return [key, queryParameters[key]].map(encodeURIComponent).join('=');\n    })\n        .join('&');\n}\nexports.createQueryParametersAsString = createQueryParametersAsString;\n","\"use strict\";\n/*!\n * Reconnecting WebSocket\n * by Pedro Ladaria <pedro.ladaria@gmail.com>\n * https://github.com/pladaria/reconnecting-websocket\n * License MIT\n */\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ReconnectingWebSocket = void 0;\nvar DEFAULT = {\n    maxReconnectionDelay: 10000,\n    minReconnectionDelay: 1000 + Math.random() * 4000,\n    minUptime: 5000,\n    reconnectionDelayGrowFactor: 1.3,\n    connectionTimeout: 4000,\n    maxRetries: Infinity,\n    maxEnqueuedMessages: Infinity,\n    startClosed: false,\n    debug: false,\n};\nvar ReconnectingWebSocket = (function () {\n    function ReconnectingWebSocket(url, protocols, options) {\n        if (options === void 0) { options = {}; }\n        var _this = this;\n        this.onclose = null;\n        this.onerror = null;\n        this.onmessage = null;\n        this.onopen = null;\n        this._listeners = {\n            error: [],\n            message: [],\n            open: [],\n            close: [],\n        };\n        this._shouldReconnect = true;\n        this._connectLock = false;\n        this._closeCalled = false;\n        this._messageQueue = [];\n        this._retryCount = -1;\n        this._binaryType = 'blob';\n        this._handleOpen = function (event) {\n            _this._debug('open event');\n            var _a = _this._options.minUptime, minUptime = _a === void 0 ? DEFAULT.minUptime : _a;\n            clearTimeout(_this._connectTimeout);\n            _this._uptimeTimeout = window.setTimeout(function () { return _this._acceptOpen(); }, minUptime);\n            _this._ws.binaryType = _this._binaryType;\n            _this._messageQueue.forEach(function (message) { var _a; return (_a = _this._ws) === null || _a === void 0 ? void 0 : _a.send(message); });\n            _this._messageQueue = [];\n            if (_this.onopen) {\n                _this.onopen(event);\n            }\n            _this._listeners.open.forEach(function (listener) {\n                return _this._callEventListener(event, listener);\n            });\n        };\n        this._handleMessage = function (event) {\n            _this._debug('message event');\n            if (_this.onmessage) {\n                _this.onmessage(event);\n            }\n            _this._listeners.message.forEach(function (listener) {\n                return _this._callEventListener(event, listener);\n            });\n        };\n        this._handleError = function (event) {\n            _this._debug('error event', event);\n            _this._disconnect();\n            if (_this.onerror) {\n                _this.onerror(event);\n            }\n            _this._debug('exec error listeners');\n            _this._listeners.error.forEach(function (listener) {\n                return _this._callEventListener(event, listener);\n            });\n            _this._connect();\n        };\n        this._handleClose = function (event) {\n            _this._debug('close event');\n            _this._clearTimeouts();\n            if (_this._shouldReconnect) {\n                _this._connect();\n            }\n            if (_this.onclose) {\n                _this.onclose(event);\n            }\n            _this._listeners.close.forEach(function (listener) {\n                return _this._callEventListener(event, listener);\n            });\n        };\n        this._url = url;\n        this._protocols = protocols;\n        this._options = options;\n        this._maxRetries =\n            typeof options.maxRetries === 'number'\n                ? options.maxRetries\n                : DEFAULT.maxRetries;\n        if (this._options.startClosed) {\n            this._shouldReconnect = false;\n        }\n        this._connect();\n    }\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"retryCount\", {\n        get: function () {\n            return Math.max(this._retryCount, 0);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"binaryType\", {\n        get: function () {\n            return this._ws ? this._ws.binaryType : this._binaryType;\n        },\n        set: function (value) {\n            this._binaryType = value;\n            if (this._ws) {\n                this._ws.binaryType = value;\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"bufferedAmount\", {\n        get: function () {\n            var bytes = this._messageQueue.reduce(function (acc, message) {\n                if (typeof message === 'string') {\n                    acc += message.length;\n                }\n                else if (message instanceof Blob) {\n                    acc += message.size;\n                }\n                else {\n                    acc += message.byteLength;\n                }\n                return acc;\n            }, 0);\n            return bytes + (this._ws ? this._ws.bufferedAmount : 0);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"extensions\", {\n        get: function () {\n            return this._ws ? this._ws.extensions : '';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"protocol\", {\n        get: function () {\n            return this._ws ? this._ws.protocol : '';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"readyState\", {\n        get: function () {\n            if (this._ws) {\n                return this._ws.readyState;\n            }\n            return this._options.startClosed ? WebSocket.CLOSED : WebSocket.CONNECTING;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"url\", {\n        get: function () {\n            return this._ws ? this._ws.url : '';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ReconnectingWebSocket.prototype.close = function (code, reason) {\n        if (code === void 0) { code = 1000; }\n        this._closeCalled = true;\n        this._shouldReconnect = false;\n        this._clearTimeouts();\n        if (!this._ws) {\n            this._debug('close enqueued: no ws instance');\n            return;\n        }\n        if (this._ws.readyState === WebSocket.CLOSED) {\n            this._debug('close: already closed');\n            return;\n        }\n        this._ws.close(code, reason);\n    };\n    ReconnectingWebSocket.prototype.reconnect = function (code, reason) {\n        this._shouldReconnect = true;\n        this._closeCalled = false;\n        this._retryCount = -1;\n        if (!this._ws || this._ws.readyState === WebSocket.CLOSED) {\n            this._connect();\n        }\n        else {\n            this._disconnect(code, reason);\n            this._connect();\n        }\n    };\n    ReconnectingWebSocket.prototype.send = function (data) {\n        if (this._ws && this._ws.readyState === WebSocket.OPEN) {\n            this._debug('send', data);\n            this._ws.send(data);\n        }\n        else {\n            var _a = this._options.maxEnqueuedMessages, maxEnqueuedMessages = _a === void 0 ? DEFAULT.maxEnqueuedMessages : _a;\n            if (this._messageQueue.length < maxEnqueuedMessages) {\n                this._debug('enqueue', data);\n                this._messageQueue.push(data);\n            }\n        }\n    };\n    ReconnectingWebSocket.prototype.addEventListener = function (type, listener) {\n        if (this._listeners[type]) {\n            this._listeners[type].push(listener);\n        }\n    };\n    ReconnectingWebSocket.prototype.dispatchEvent = function (event) {\n        var e_1, _a;\n        var listeners = this._listeners[event.type];\n        if (listeners) {\n            try {\n                for (var listeners_1 = __values(listeners), listeners_1_1 = listeners_1.next(); !listeners_1_1.done; listeners_1_1 = listeners_1.next()) {\n                    var listener = listeners_1_1.value;\n                    this._callEventListener(event, listener);\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (listeners_1_1 && !listeners_1_1.done && (_a = listeners_1.return)) _a.call(listeners_1);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n        }\n        return true;\n    };\n    ReconnectingWebSocket.prototype.removeEventListener = function (type, listener) {\n        if (this._listeners[type]) {\n            this._listeners[type] = this._listeners[type].filter(function (l) { return l !== listener; });\n        }\n    };\n    ReconnectingWebSocket.prototype.setMaxRetires = function (maxRetries) {\n        this._maxRetries = maxRetries;\n    };\n    ReconnectingWebSocket.prototype._debug = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this._options.debug) {\n            console.log.apply(console, __spreadArray(['RWS>'], __read(args), false));\n        }\n    };\n    ReconnectingWebSocket.prototype._getNextDelay = function () {\n        var _a = this._options, _b = _a.reconnectionDelayGrowFactor, reconnectionDelayGrowFactor = _b === void 0 ? DEFAULT.reconnectionDelayGrowFactor : _b, _c = _a.minReconnectionDelay, minReconnectionDelay = _c === void 0 ? DEFAULT.minReconnectionDelay : _c, _d = _a.maxReconnectionDelay, maxReconnectionDelay = _d === void 0 ? DEFAULT.maxReconnectionDelay : _d;\n        var delay = 0;\n        if (this._retryCount > 0) {\n            delay =\n                minReconnectionDelay *\n                    Math.pow(reconnectionDelayGrowFactor, this._retryCount - 1);\n            if (delay > maxReconnectionDelay) {\n                delay = maxReconnectionDelay;\n            }\n        }\n        this._debug('next delay', delay);\n        return delay;\n    };\n    ReconnectingWebSocket.prototype._wait = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            setTimeout(resolve, _this._getNextDelay());\n        });\n    };\n    ReconnectingWebSocket.prototype._getNextUrl = function (urlProvider) {\n        if (typeof urlProvider === 'string') {\n            return Promise.resolve(urlProvider);\n        }\n        if (typeof urlProvider === 'function') {\n            var url = urlProvider();\n            if (typeof url === 'string') {\n                return Promise.resolve(url);\n            }\n            if (typeof url.then !== 'undefined') {\n                return url;\n            }\n        }\n        throw Error('Invalid URL');\n    };\n    ReconnectingWebSocket.prototype._connect = function () {\n        var _this = this;\n        if (this._connectLock || !this._shouldReconnect) {\n            return;\n        }\n        this._connectLock = true;\n        var _a = this._options.connectionTimeout, connectionTimeout = _a === void 0 ? DEFAULT.connectionTimeout : _a;\n        if (this._retryCount >= this._maxRetries) {\n            this._debug('max retries reached', this._retryCount, '>=', this._maxRetries);\n            return;\n        }\n        this._retryCount++;\n        this._debug('connect', this._retryCount);\n        this._removeListeners();\n        this._wait()\n            .then(function () { return _this._getNextUrl(_this._url); })\n            .then(function (url) {\n            if (_this._closeCalled) {\n                _this._connectLock = false;\n                return;\n            }\n            _this._debug('connect', { url: url, protocols: _this._protocols });\n            _this._ws = _this._protocols\n                ? new WebSocket(url, _this._protocols)\n                : new WebSocket(url);\n            _this._ws.binaryType = _this._binaryType;\n            _this._connectLock = false;\n            _this._addListeners();\n            _this._connectTimeout = window.setTimeout(function () { return _this._handleTimeout(); }, connectionTimeout);\n        })\n            .catch(function (err) {\n            _this._connectLock = false;\n            _this._handleError(new ErrorEvent(err.message, { error: err }));\n        });\n    };\n    ReconnectingWebSocket.prototype._handleTimeout = function () {\n        this._debug('timeout event');\n        this._handleError(new ErrorEvent('TIMEOUT'));\n    };\n    ReconnectingWebSocket.prototype._disconnect = function (code, reason) {\n        if (code === void 0) { code = 1000; }\n        this._clearTimeouts();\n        if (!this._ws) {\n            return;\n        }\n        this._removeListeners();\n        try {\n            this._ws.close(code, reason);\n            this._handleClose(new CloseEvent('CLOSE', { code: code, reason: reason }));\n        }\n        catch (error) {\n        }\n    };\n    ReconnectingWebSocket.prototype._acceptOpen = function () {\n        this._debug('accept open');\n        this._retryCount = 0;\n    };\n    ReconnectingWebSocket.prototype._callEventListener = function (event, listener) {\n        if ('handleEvent' in listener) {\n            listener.handleEvent(event);\n        }\n        else {\n            listener(event);\n        }\n    };\n    ReconnectingWebSocket.prototype._removeListeners = function () {\n        if (!this._ws) {\n            return;\n        }\n        this._debug('removeListeners');\n        this._ws.removeEventListener('open', this._handleOpen);\n        this._ws.removeEventListener('close', this._handleClose);\n        this._ws.removeEventListener('message', this._handleMessage);\n        this._ws.removeEventListener('error', this._handleError);\n    };\n    ReconnectingWebSocket.prototype._addListeners = function () {\n        if (!this._ws) {\n            return;\n        }\n        this._debug('addListeners');\n        this._ws.addEventListener('open', this._handleOpen);\n        this._ws.addEventListener('close', this._handleClose);\n        this._ws.addEventListener('message', this._handleMessage);\n        this._ws.addEventListener('error', this._handleError);\n    };\n    ReconnectingWebSocket.prototype._clearTimeouts = function () {\n        clearTimeout(this._connectTimeout);\n        clearTimeout(this._uptimeTimeout);\n    };\n    return ReconnectingWebSocket;\n}());\nexports.ReconnectingWebSocket = ReconnectingWebSocket;\n//# sourceMappingURL=ReconnectingWebSocket.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MessageDirection = void 0;\nvar MessageDirection;\n(function (MessageDirection) {\n    MessageDirection[\"INBOUND\"] = \"inbound\";\n    MessageDirection[\"OUTBOUND\"] = \"outbound\";\n})(MessageDirection || (exports.MessageDirection = MessageDirection = {}));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Checks if `value` is `null`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `null`, else `false`.\n * @example\n *\n * _.isNull(null);\n * // => true\n *\n * _.isNull(void 0);\n * // => false\n */\nfunction isNull(value) {\n  return value === null;\n}\n\nexport default isNull;\n","import { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\n\nimport { NetworkRequestMetadata } from '../request/NetworkRequestMetadata';\nimport { SecureSessionsType } from '../securedSession/SecureSessionsType';\nimport { ThirdPartyToken } from '../securedSession/ThirdPartyToken';\nimport { ICacheStorage } from '../storage/CacheStorage';\nimport { IStorage } from '../storage/Storage';\n\nexport interface ThreadData {\n  contactId?: string;\n  oldestMessageDatetime?: string;\n  scrollToken?: string;\n}\n\nexport interface ChatSDKVariableStorage {\n  ACCESS_TOKEN: string;\n  ACCESS_TOKEN_EXPIRES_IN: number;\n  APP_NAME: string;\n  APP_VERSION: string;\n  AUTHORIZATION_CODE?: string;\n  BRAND_ID: BrandId;\n  CACHE_STORAGE?: ICacheStorage;\n  CHANNEL_ID: ChannelId;\n  DESTINATION?: string;\n  ENDPOINT_AUTHORIZE: string;\n  ENDPOINT_CHAT: string;\n  ENDPOINT_GATEWAY: string;\n  IDENTITY_TOKEN?: string;\n  LANGUAGE: string;\n  REQUEST_METADATA: NetworkRequestMetadata;\n  SECURED_SESSION: SecureSessionsType;\n  STORAGE?: IStorage;\n  THIRD_PARTY_TOKEN?: ThirdPartyToken;\n  THREAD_DATA: ThreadData;\n  VISITOR_ID?: string;\n  VISIT_ID?: string;\n}\n\nexport const SDKVariableStorage: Partial<ChatSDKVariableStorage> = {};\n\nexport const clearVariableStorage = (): void => {\n  Object.keys(SDKVariableStorage).forEach((key) => {\n    delete SDKVariableStorage[key as keyof ChatSDKVariableStorage];\n  });\n};\n","import { AccessToken } from '@brandembassy/ts-types-chat/dist/authorization/AccessToken';\n\nimport { isNull } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nexport function setAccessToken(accessToken: AccessToken): void {\n  SDKVariableStorage.ACCESS_TOKEN = accessToken.token;\n  SDKVariableStorage.ACCESS_TOKEN_EXPIRES_IN = accessToken.expiresIn;\n}\n\n/**\n * @deprecated Use ThirdParty Token instead\n */\nexport function getAccessToken(): AccessToken | null {\n  const token = SDKVariableStorage.ACCESS_TOKEN ?? null;\n  const expiresIn = SDKVariableStorage.ACCESS_TOKEN_EXPIRES_IN ?? null;\n\n  if (isNull(token) || isNull(expiresIn)) {\n    return null;\n  }\n\n  return {\n    token,\n    expiresIn: Number(expiresIn),\n  };\n}\n\nexport function resetAccessToken(): void {\n  SDKVariableStorage.ACCESS_TOKEN = undefined;\n  SDKVariableStorage.ACCESS_TOKEN_EXPIRES_IN = undefined;\n}\n","export interface ChatSDKErrorData {\n  [key: string]: unknown;\n  /**\n   * Use for wrap original error cased by this error\n   */\n  error?: unknown;\n}\n\nexport class ChatSDKError extends Error {\n  name: string = 'ChatSDKError';\n  data: unknown;\n  additionalInfo?: unknown;\n\n  constructor(error: unknown, data?: ChatSDKErrorData) {\n    super();\n\n    if (error instanceof ChatSDKError) {\n      this.message = error.message;\n      this.stack = error.stack;\n      this.cause = error.cause;\n      this.data = error.data;\n      this.additionalInfo = data;\n\n      return;\n    }\n\n    this.data = data;\n\n    if (typeof error === 'string') {\n      this.message = `[${this.name}]: ${error}`;\n    }\n\n    if (error instanceof Error) {\n      this.message = `[${this.name}]: ${error.message}`;\n      this.cause = error;\n      this.stack = error.stack;\n      this.additionalInfo = data;\n    }\n\n    if (data?.error instanceof Error) {\n      this.cause = data.error;\n      this.message = `${this.message} (caused by: ${data.error.message})`;\n    }\n  }\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { MessageFailedEventData } from '../message/MessageSuccessEventData';\n\nexport class AuthorizationError extends ChatSDKError {\n  data: MessageFailedEventData['error'] | undefined;\n\n  constructor(\n    message: string,\n    data: MessageFailedEventData['error'] | undefined,\n  ) {\n    super(message, data);\n\n    if (data !== undefined) {\n      this.message = `${message} because of (${data.errorMessage})`;\n    }\n  }\n}\n","export const CHAT_SDK_VERSION: string = process.env.PACKAGE_VERSION ?? '0';\n","export function generateId(): string {\n  return crypto.randomUUID ? crypto.randomUUID() : generateUuidFallback();\n}\n\nexport function generateUuidFallback(): string {\n  const randomValues = new Uint8Array(16);\n\n  // Convert each byte to a hexadecimal string and join it to form the UUID\n  return crypto.getRandomValues(randomValues).reduce((uuid, value, index) => {\n    if ([4, 6, 8, 10].includes(index)) {\n      uuid += '-';\n    }\n\n    return (\n      uuid +\n      (index === 6\n        ? // eslint-disable-next-line no-bitwise\n          (value & 0x0f) | 0x40\n        : index === 8\n        ? // eslint-disable-next-line no-bitwise\n          (value & 0x3f) | 0x80\n        : value\n      )\n        .toString(16)\n        .padStart(2, '0')\n    );\n  }, '');\n}\n","import { VisitorInput } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsInputEvent';\nimport { VisitorId } from '@brandembassy/ts-types-platform/dist/visitor/VisitorId';\n\nexport interface VisitorPayload {\n  visitor: VisitorInput;\n}\n\nexport function createVisitorPayload(visitorId: VisitorId): VisitorPayload {\n  return {\n    visitor: {\n      id: visitorId,\n    },\n  };\n}\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nexport default isPrototype;\n","import overArg from './_overArg.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nexport default nativeKeys;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import isPrototype from './_isPrototype.js';\nimport nativeKeys from './_nativeKeys.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeys;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView');\n\nexport default DataView;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Promise = getNative(root, 'Promise');\n\nexport default Promise;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Set = getNative(root, 'Set');\n\nexport default Set;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar WeakMap = getNative(root, 'WeakMap');\n\nexport default WeakMap;\n","import DataView from './_DataView.js';\nimport Map from './_Map.js';\nimport Promise from './_Promise.js';\nimport Set from './_Set.js';\nimport WeakMap from './_WeakMap.js';\nimport baseGetTag from './_baseGetTag.js';\nimport toSource from './_toSource.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    setTag = '[object Set]',\n    weakMapTag = '[object WeakMap]';\n\nvar dataViewTag = '[object DataView]';\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = baseGetTag(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : '';\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\nexport default getTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nexport default baseIsArguments;\n","import baseIsArguments from './_baseIsArguments.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nexport default isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nexport default isLength;\n","import root from './_root.js';\nimport stubFalse from './stubFalse.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nexport default isBuffer;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nexport default stubFalse;\n","import baseGetTag from './_baseGetTag.js';\nimport isLength from './isLength.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nexport default baseIsTypedArray;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import baseIsTypedArray from './_baseIsTypedArray.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nexport default isTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","import baseKeys from './_baseKeys.js';\nimport getTag from './_getTag.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isArrayLike from './isArrayLike.js';\nimport isBuffer from './isBuffer.js';\nimport isPrototype from './_isPrototype.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]',\n    setTag = '[object Set]';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if `value` is an empty object, collection, map, or set.\n *\n * Objects are considered empty if they have no own enumerable string keyed\n * properties.\n *\n * Array-like values such as `arguments` objects, arrays, buffers, strings, or\n * jQuery-like collections are considered empty if they have a `length` of `0`.\n * Similarly, maps and sets are considered empty if they have a `size` of `0`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is empty, else `false`.\n * @example\n *\n * _.isEmpty(null);\n * // => true\n *\n * _.isEmpty(true);\n * // => true\n *\n * _.isEmpty(1);\n * // => true\n *\n * _.isEmpty([1, 2, 3]);\n * // => false\n *\n * _.isEmpty({ 'a': 1 });\n * // => false\n */\nfunction isEmpty(value) {\n  if (value == null) {\n    return true;\n  }\n  if (isArrayLike(value) &&\n      (isArray(value) || typeof value == 'string' || typeof value.splice == 'function' ||\n        isBuffer(value) || isTypedArray(value) || isArguments(value))) {\n    return !value.length;\n  }\n  var tag = getTag(value);\n  if (tag == mapTag || tag == setTag) {\n    return !value.size;\n  }\n  if (isPrototype(value)) {\n    return !baseKeys(value).length;\n  }\n  for (var key in value) {\n    if (hasOwnProperty.call(value, key)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport default isEmpty;\n","import isFunction from './isFunction.js';\nimport isLength from './isLength.js';\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nexport default isArrayLike;\n","import { ChatEventData } from '../event/ChatEvent';\n\nexport const requestQueue = new Map<string, (value: ChatEventData) => void>();\n","import { AwsInputEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsInputEvent';\n\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { ChatEventData } from '../event/ChatEvent';\nimport { Event } from '../sockets/EventPayload';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\nimport { generateId } from '../utils/generateId';\nimport { isEmpty, isNull } from '../utils/is';\n\nimport { requestQueue } from './requestQueue';\n\nexport const makeRequest = async (\n  event: Event<AwsInputEventData>,\n  wsClient: WebSocketClient | null,\n): Promise<ChatEventData> => {\n  if (isNull(wsClient)) {\n    throw new ChatSDKError('WebSocketClient is not initialized');\n  }\n  if (isEmpty(event.eventId)) {\n    event.eventId = generateId();\n  }\n\n  return new Promise<ChatEventData>((resolve) => {\n    requestQueue.set(event.eventId, resolve);\n    wsClient?.send(event);\n  });\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\n\nconst MAXIMUM_REQUEST_COUNT: number = 100;\nconst TIME_SLOT_IN_SECONDS: number = 5;\nlet requestRateLimitCounter: number = 0;\nlet requestCounterIntervalId: ReturnType<typeof setInterval> | null = null;\n\nexport class MaximumRequestCountReachError extends Error {\n  name = 'MaximumRequestCountReached';\n  message = 'Maximum request count reached';\n}\n\nexport function resetLimitCounter(): void {\n  requestRateLimitCounter = 0;\n}\n\nexport function requestRateLimit(): void {\n  requestRateLimitCounter += 1;\n\n  if (requestCounterIntervalId === null) {\n    requestCounterIntervalId = setInterval(\n      resetLimitCounter,\n      TIME_SLOT_IN_SECONDS * 1000,\n    );\n  }\n\n  if (requestRateLimitCounter > MAXIMUM_REQUEST_COUNT) {\n    throw new ChatSDKError(new MaximumRequestCountReachError());\n  }\n}\n","export function splitName(name: string): [string, string] {\n  const [firstName, ...names] = name.split(' ');\n  const lastName = names.join(' ');\n\n  return [firstName, lastName];\n}\n","export const ERROR_AUTHORIZE_HOSTNAME_NOT_SET = 'Authorize hostname is not set';\nexport const ERROR_CANNOT_REFRESH_THIRD_PARTY_TOKEN =\n  'Cannot refresh ThirdParty token';\n\nexport const ERROR_CANNOT_FETCH_TRANSACTION_TOKEN =\n  'Failed to fetch transaction token';\n\nexport const ERROR_IP_ADDRESS_BLOCKED = 'Your IP address is blocked.';\n\nexport const getCustomFieldMaxLengthErrorMessage = (\n  ident: string,\n  maxLength: number,\n): string =>\n  `Value of custom field \"${ident}\" exceeds maximum length of ${maxLength} characters`;\n","/**\n * Checks if `value` is `undefined`.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `undefined`, else `false`.\n * @example\n *\n * _.isUndefined(void 0);\n * // => true\n *\n * _.isUndefined(null);\n * // => false\n */\nfunction isUndefined(value) {\n  return value === undefined;\n}\n\nexport default isUndefined;\n","import { CustomField } from '@brandembassy/ts-types-platform/dist/customField/CustomField';\n\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { getCustomFieldMaxLengthErrorMessage } from '../error/errorMessages';\nimport { isUndefined } from '../utils/is';\n\ntype Ident = CustomField['ident'];\ntype Value = CustomField['value'];\n\nexport type CustomFieldsObject = Record<Ident, Value>;\nexport type CustomFieldsMap = Map<Ident, Value>;\n\nconst MAX_CUSTOM_FIELD_LENGTH = 1024;\n\nexport function setCustomFields(\n  fields: CustomFieldsMap,\n  set: CustomFieldsObject = {},\n): void {\n  for (const ident of Object.keys(set)) {\n    validateCustomField(ident, set[ident]);\n    fields.set(ident, set[ident]);\n  }\n}\n\nexport function setCustomFieldsFromArray(\n  fields: CustomFieldsMap,\n  set: Array<CustomField> = [],\n): void {\n  for (const { ident, value } of set) {\n    validateCustomField(ident, value);\n    fields.set(ident, value);\n  }\n}\n\nexport function setCustomField(\n  fields: CustomFieldsMap,\n  ident: Ident,\n  value: CustomField['value'],\n): void {\n  validateCustomField(ident, value);\n  fields.set(ident, value);\n}\n\nexport function getCustomFields(fields: CustomFieldsMap): CustomFieldsObject {\n  return Object.fromEntries(fields);\n}\n\nexport function getCustomFieldsArray(\n  fields: CustomFieldsMap,\n): Array<CustomField> {\n  return Array.from(fields).map<CustomField>(([ident, value]) => ({\n    ident,\n    value,\n  }));\n}\n\nexport function removeCustomField(fields: CustomFieldsMap, ident: Ident): void {\n  fields.delete(ident);\n}\n\nexport function getCustomFieldsFromArray(\n  fields: Array<CustomField>,\n): CustomFieldsObject {\n  return Object.fromEntries(fields.map((field) => [field.ident, field.value]));\n}\n\nfunction validateCustomField(ident: Ident, value: Value): void {\n  if (isUndefined(ident) || isUndefined(value)) {\n    throw new ChatSDKError('Custom field name and value must be set');\n  }\n\n  if (!isCustomFieldValueValid(value)) {\n    throw new ChatSDKError(\n      getCustomFieldMaxLengthErrorMessage(ident, MAX_CUSTOM_FIELD_LENGTH),\n    );\n  }\n}\n\nfunction isCustomFieldValueValid(value: Value): boolean {\n  if (value === null) {\n    return true;\n  }\n  if (typeof value === 'string') {\n    return value.length <= MAX_CUSTOM_FIELD_LENGTH;\n  }\n\n  return false;\n}\n","import { CustomField } from '@brandembassy/ts-types-platform/dist/customField/CustomField';\nimport { CustomerIdentityIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/endUser/EndUserIdentityId';\n\nimport {\n  CustomFieldsMap,\n  CustomFieldsObject,\n  getCustomFields,\n  getCustomFieldsArray,\n  setCustomFields,\n  setCustomFieldsFromArray,\n} from '../customField/CustomFields';\nimport { ChatEventData } from '../event/ChatEvent';\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { CustomerIdentity } from '../securedSession/TransactionToken';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\nimport { generateId } from '../utils/generateId';\nimport { isArray } from '../utils/is';\n\nimport { createSetCustomerCustomFieldsPayloadData } from './setCustomerCustomFieldsPayload';\n\nexport function setCustomerIdentity(\n  customer: Customer,\n  customerIdentity: CustomerIdentity,\n): void {\n  const {\n    idOnExternalPlatform,\n    firstName = '',\n    lastName = '',\n    image,\n    customFields,\n  } = customerIdentity;\n  customer.setId(idOnExternalPlatform);\n\n  if (firstName || lastName) {\n    customer.setName(`${firstName ?? ''} ${lastName ?? ''}`.trim());\n  }\n\n  if (image) {\n    customer.setImage(image);\n  }\n\n  if (isArray(customFields)) {\n    customer.setCustomFieldsFromArray(customFields);\n  }\n}\n\nexport class Customer {\n  #websocketClient: WebSocketClient | null;\n  #customFields: CustomFieldsMap = new Map();\n  #exists = false;\n  id: CustomerIdentityIdOnExternalPlatform | null = null;\n  name: string | null = null;\n  image: string | null = null;\n\n  constructor(\n    id?: CustomerIdentityIdOnExternalPlatform,\n    name?: string,\n    image?: string,\n    websocketClient?: WebSocketClient | null,\n  ) {\n    this.#websocketClient = websocketClient ?? null;\n\n    if (id) {\n      this.setId(id);\n    }\n    if (name) {\n      this.setName(name);\n    }\n    if (image) {\n      this.setImage(image);\n    }\n  }\n\n  public getIdOrCreateNewOne(): CustomerIdentityIdOnExternalPlatform {\n    let customerId = this.getId();\n\n    if (!customerId) {\n      customerId = generateId();\n      this.id = customerId;\n    }\n\n    return customerId;\n  }\n\n  public destroy(): void {\n    this.id = null;\n    this.name = null;\n    this.image = null;\n    this.#customFields = new Map();\n  }\n\n  public getId(): CustomerIdentityIdOnExternalPlatform | null {\n    return this.id ?? null;\n  }\n\n  /**\n   * Set Customer Identity ID on external Platform\n   * @param customerIdentityIdOnExternalPlatform - Customer ID\n   */\n  public setId(\n    customerIdentityIdOnExternalPlatform: CustomerIdentityIdOnExternalPlatform,\n  ): void {\n    this.id = customerIdentityIdOnExternalPlatform.toString();\n  }\n\n  public getName(): string | null {\n    return this.name;\n  }\n\n  public setName(name: string): void {\n    this.name = name;\n  }\n\n  public getImage(): string | null {\n    return this.image ?? null;\n  }\n\n  public setImage(image: string): void {\n    this.image = image;\n  }\n\n  public setExists(exists: boolean): void {\n    this.#exists = exists;\n  }\n\n  public setWebsocketClient(websocketClient: WebSocketClient): void {\n    this.#websocketClient = websocketClient;\n  }\n\n  /**\n   * Set Customer Custom field\n   * @param name - Custom field name\n   * @param value - Custom field value\n   */\n  public setCustomField(\n    name: CustomField['ident'],\n    value: CustomField['value'],\n  ): Promise<ChatEventData> | undefined {\n    return this.setCustomFields({ [name]: value });\n  }\n\n  /**\n   * Set Customer Custom fields\n   * @param customFields - custom fields object\n   * @example setCustomFields(\\{ identName: 'value', identName2: 'value2' \\})\n   */\n  public setCustomFields(\n    customFields: CustomFieldsObject,\n  ): Promise<ChatEventData> | undefined {\n    setCustomFields(this.#customFields, customFields);\n\n    if (this.#exists) {\n      return this.sendCustomFields();\n    }\n  }\n\n  /**\n   * Get Customer Custom fields (as object)\n   */\n  public getCustomFields(): CustomFieldsObject {\n    return getCustomFields(this.#customFields);\n  }\n\n  /**\n   * Set Customer Custom fields from an array of custom fields\n   * @param customFields - custom fields array\n   */\n  public setCustomFieldsFromArray(customFields: Array<CustomField>): void {\n    setCustomFieldsFromArray(this.#customFields, customFields);\n  }\n\n  /**\n   * Get Customer Custom fields (as array of CustomField)\n   */\n  public getCustomFieldsArray(): Array<CustomField> {\n    return getCustomFieldsArray(this.#customFields);\n  }\n\n  /**\n   * Send Customer Custom fields\n   * - call this only after the first message or recover event\n   * @returns Promise<ChatEventData>\n   */\n  public async sendCustomFields(): Promise<ChatEventData> {\n    const payloadData = createSetCustomerCustomFieldsPayloadData(\n      getCustomFieldsArray(this.#customFields),\n    );\n\n    return sendChatEvent(payloadData, this.#websocketClient);\n  }\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SendConsumerCustomFieldsEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendConsumerCustomFields';\nimport { CustomField } from '@brandembassy/ts-types-platform/dist/customField/CustomField';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\ntype SendCustomerCustomFieldsEventData = SendConsumerCustomFieldsEventData;\n\nexport function createSetCustomerCustomFieldsPayloadData(\n  customFields: Array<CustomField>,\n): EventPayloadData<SendCustomerCustomFieldsEventData> {\n  return {\n    eventType: AwsInputEventType.SEND_CONSUMER_CUSTOM_FIELDS,\n    data: {\n      customFields,\n    },\n  };\n}\n","import { Customer } from './Customer';\n\nexport class CustomerInstance {\n  private static instance: Customer;\n\n  public static getInstance(): Customer {\n    if (!CustomerInstance.instance) {\n      CustomerInstance.instance = new Customer();\n    }\n\n    return CustomerInstance.instance;\n  }\n}\n","import { ConsumerIdentityInput } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsInputEvent';\n\nimport { splitName } from '../utils/splitName';\n\nimport { CustomerInstance } from './CustomerInstance';\n\nexport type ConsumerIdentityPayload = ConsumerIdentityInput;\n\nexport function createCustomerIdentityPayload(\n  name?: string,\n  image?: string,\n): ConsumerIdentityPayload {\n  const customer = CustomerInstance.getInstance();\n  const storedName = name ?? customer.getName();\n  const storedImage = image ?? customer.getImage();\n\n  let customerIdentityNamePayload: Partial<ConsumerIdentityPayload> = {};\n  if (typeof storedName === 'string' && storedName.length > 0) {\n    const [firstName, lastName] = splitName(storedName);\n    customerIdentityNamePayload = { firstName, lastName };\n  }\n\n  if (storedImage) {\n    customerIdentityNamePayload.image = storedImage;\n  }\n\n  return {\n    idOnExternalPlatform: customer.getIdOrCreateNewOne(),\n    ...customerIdentityNamePayload,\n  };\n}\n","/**\n * Checks if `value` is `null` or `undefined`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is nullish, else `false`.\n * @example\n *\n * _.isNil(null);\n * // => true\n *\n * _.isNil(void 0);\n * // => true\n *\n * _.isNil(NaN);\n * // => false\n */\nfunction isNil(value) {\n  return value == null;\n}\n\nexport default isNil;\n","import { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\n\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { isNil } from './is';\n\nexport function getBrandIdAndChannelId(): {\n  brandId: BrandId;\n  channelId: ChannelId;\n} {\n  const brandId = SDKVariableStorage.BRAND_ID;\n  const channelId = SDKVariableStorage.CHANNEL_ID;\n\n  if (isNil(brandId) || isNaN(brandId) || isNil(channelId)) {\n    throw new ChatSDKError(\n      `Cannot get BrandId and ChannelId from SDKVariableStorage\n      brandId (${brandId}) |\n      channelId (${channelId})`,\n    );\n  }\n\n  return {\n    brandId,\n    channelId,\n  };\n}\n","import { AwsChatWindowEventActionRoute } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsChatWindowEvent';\nimport { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport {\n  AwsInputEvent,\n  AwsInputEventData,\n  ConsumerIdentityInput,\n  DestinationInput,\n  VisitInput,\n  VisitorInput,\n} from '@brandembassy/ts-types-chat/dist/awsEvents/AwsInputEvent';\n\nimport { createCustomerIdentityPayload } from '../customer/customerIdentityPayload';\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { generateId } from '../utils/generateId';\nimport { getBrandIdAndChannelId } from '../utils/getBrandIdAndChannelId';\nimport { isUndefined } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nexport type EventActionRoute = AwsChatWindowEventActionRoute;\nexport type EventPayload<D extends AwsInputEventData> = AwsInputEvent<\n  AwsInputEventType,\n  D\n>;\n\nexport interface Event<D extends AwsInputEventData> {\n  action: EventActionRoute;\n  eventId: string;\n  payload: EventPayload<D>;\n}\n\nexport interface EventPayloadData<D extends AwsInputEventData> {\n  consumerIdentity?: ConsumerIdentityInput;\n  data: D;\n  destination?: DestinationInput;\n  eventType: AwsInputEventType;\n  visit?: VisitInput;\n  visitor?: VisitorInput;\n}\n\nexport function createEventPayload<D extends AwsInputEventData>(\n  eventPayloadData: EventPayloadData<D>,\n): EventPayload<D> {\n  const storedDestinationId = SDKVariableStorage.DESTINATION;\n  const storedVisitId = SDKVariableStorage.VISIT_ID;\n  const storedVisitorId = SDKVariableStorage.VISITOR_ID;\n\n  const {\n    eventType,\n    data,\n    consumerIdentity = createCustomerIdentityPayload(),\n    destination = storedDestinationId ? { id: storedDestinationId } : {},\n    visitor = storedVisitorId ? { id: storedVisitorId } : {},\n    visit = storedVisitId ? { id: storedVisitId } : {},\n  } = eventPayloadData;\n  const { brandId, channelId } = getBrandIdAndChannelId();\n\n  if (isUndefined(eventType)) {\n    throw new ChatSDKError(\n      `Cannot create an event payload because of missing eventType (${eventType})`,\n    );\n  }\n\n  return {\n    eventType,\n    brand: {\n      id: Number(brandId),\n    },\n    channel: {\n      id: channelId,\n    },\n    consumerIdentity,\n    data,\n    destination,\n    visitor,\n    visit,\n  };\n}\n\nexport function createEvent<D extends AwsInputEventData>(\n  payload: EventPayload<D>,\n  eventId: string = generateId(),\n  actionRoute: EventActionRoute = AwsChatWindowEventActionRoute.CHAT_WINDOW_EVENT,\n): Event<D> {\n  return {\n    action: actionRoute,\n    eventId,\n    payload,\n  };\n}\n","import { AwsInputEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsInputEvent';\n\nimport { makeRequest } from '../request/makeRequest';\nimport { requestRateLimit } from '../request/requestRateLimit';\nimport {\n  createEvent,\n  createEventPayload,\n  EventPayloadData,\n} from '../sockets/EventPayload';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport { ChatEventData } from './ChatEvent';\n\n/**\n * Send chat event\n * @param payloadData - payload data\n * @param webSocketClient - websocket client\n */\nexport async function sendChatEvent<D extends AwsInputEventData>(\n  payloadData: EventPayloadData<D>,\n  webSocketClient: WebSocketClient | null,\n): Promise<ChatEventData> {\n  requestRateLimit();\n\n  const event = createEvent(createEventPayload(payloadData));\n\n  return makeRequest(event, webSocketClient);\n}\n","import { AccessToken } from '@brandembassy/ts-types-chat/dist/authorization/AccessToken';\nimport { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { ReconnectConsumerData } from '@brandembassy/ts-types-chat/dist/awsEvents/ReconnectConsumer';\nimport { VisitorId } from '@brandembassy/ts-types-platform/dist/visitor/VisitorId';\n\nimport { createCustomerIdentityPayload } from '../customer/customerIdentityPayload';\nimport { EventPayloadData } from '../sockets/EventPayload';\nimport { createVisitorPayload } from '../visitor/createVisitorPayload';\n\nexport function createReconnectPayloadData(\n  accessToken: AccessToken,\n  visitorId?: string,\n): EventPayloadData<ReconnectConsumerData> {\n  return {\n    ...createVisitorPayload(visitorId as VisitorId),\n    ...createCustomerIdentityPayload(),\n    eventType: AwsInputEventType.RECONNECT_CONSUMER,\n    data: {\n      accessToken: {\n        token: accessToken.token,\n      },\n    },\n  };\n}\n","let refreshTokenTimeoutId: NodeJS.Timeout | null = null;\n\nexport function getIdealTimeInSecondsForIssueRefreshToken(\n  accessTokenExpiresIn: number,\n): number {\n  const idealTimeToRefreshAccessToken = Math.round(accessTokenExpiresIn * 0.9);\n\n  if (idealTimeToRefreshAccessToken < 20) {\n    return 20;\n  }\n\n  return idealTimeToRefreshAccessToken;\n}\n\nexport function handleRefreshToken(\n  token: { expiresIn: number },\n  refreshTokenAction: () => Promise<void>,\n): void {\n  if (refreshTokenTimeoutId !== null) {\n    clearTimeout(refreshTokenTimeoutId);\n  }\n\n  refreshTokenTimeoutId = setTimeout(\n    refreshTokenAction,\n    getIdealTimeInSecondsForIssueRefreshToken(token.expiresIn) * 1000,\n  );\n}\n","import { AuthorizationToken } from '@brandembassy/ts-types-chat/dist/authorization/AuthorizationToken';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport { createGenerateAuthorizationTokenPayloadData } from './generateAuthorizationTokenPayload';\nimport { isAuthorizationTokenGeneratedPostbackData } from './isAuthorizationTokenGeneratedPostbackData';\n\nexport async function getAuthorizationTokenForUrl(\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n  url: string,\n  websocketClient: WebSocketClient,\n): Promise<AuthorizationToken> {\n  const result = await sendChatEvent(\n    createGenerateAuthorizationTokenPayloadData(\n      threadIdOnExternalPlatform,\n      url,\n    ),\n    websocketClient,\n  );\n\n  if (!isAuthorizationTokenGeneratedPostbackData(result?.data)) {\n    throw new ChatSDKError(\n      'Invalid response from generate authorization token (generateAuthorizationToken)',\n      { result },\n    );\n  }\n\n  const { authorizationToken } = result.data;\n\n  return authorizationToken;\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { GenerateAuthorizationTokenData } from '@brandembassy/ts-types-chat/dist/awsEvents/GenerateAuthorizationToken';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createGenerateAuthorizationTokenPayloadData(\n  threadId: ThreadIdOnExternalPlatform,\n  url: string,\n): EventPayloadData<GenerateAuthorizationTokenData> {\n  return {\n    eventType: AwsInputEventType.GENERATE_AUTHORIZATION_TOKEN,\n    data: {\n      thread: {\n        idOnExternalPlatform: threadId,\n      },\n      url,\n    },\n  };\n}\n","import { AuthorizationTokenGeneratedPostbackData } from '@brandembassy/ts-types-chat/dist/awsEvents/AuthorizationTokenGenerated';\n\nimport { isObject } from '../utils/is';\n\nexport const isAuthorizationTokenGeneratedPostbackData = (\n  data: unknown,\n): data is AuthorizationTokenGeneratedPostbackData =>\n  isObject(data) &&\n  'authorizationToken' in (data as AuthorizationTokenGeneratedPostbackData);\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nimport { AuthorizeConsumerEventSuccessResponse } from './AuthorizeConsumerEventResponse';\n\nexport const isAuthSuccessEvent = (\n  payload: ChatEventData,\n): payload is AuthorizeConsumerEventSuccessResponse => {\n  const status = (payload as AuthorizeConsumerEventSuccessResponse)?.data\n    ?.status;\n  const type = payload?.type;\n\n  return (\n    type === AwsResponseEventType.CONSUMER_AUTHORIZED && status === 'success'\n  );\n};\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { TokenRefreshedPostbackData } from '@brandembassy/ts-types-chat/dist/awsEvents/TokenRefreshed';\n\nexport interface TokenRefreshedSuccessResponse {\n  data: TokenRefreshedPostbackData;\n  type: AwsResponseEventType.TOKEN_REFRESHED;\n}\n\nexport function isTokenRefreshedSuccessResponse(\n  response: unknown,\n): response is TokenRefreshedSuccessResponse {\n  return (\n    (response as TokenRefreshedSuccessResponse)?.type ===\n      AwsResponseEventType.TOKEN_REFRESHED &&\n    (response as TokenRefreshedSuccessResponse).data?.accessToken?.token !==\n      undefined\n  );\n}\n","import UAParser from 'ua-parser-js';\n\nimport {\n  ApplicationType,\n  BrowserFingerprint,\n  DeviceType,\n} from '@brandembassy/ts-types-chat/dist/user/BrowserFingerprint';\n\nexport interface BrowserFingerprintOptions {\n  country?: string | null;\n  ip?: string | null;\n  language?: string;\n  location?: string | null;\n}\n\nexport const DEFAULT_LANGUAGE = 'en-US';\n\nexport const getBrowserLanguage = (): string => navigator.language;\n\nexport const getBrowserLocation = (): string =>\n  Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n/**\n * Get Device type\n * @param deviceType - device type\n */\nexport function getDeviceType(deviceType?: string): DeviceType {\n  switch (deviceType) {\n    case 'mobile':\n      return DeviceType.MOBILE;\n    case 'tablet':\n      return DeviceType.TABLET;\n    default:\n      return DeviceType.DESKTOP;\n  }\n}\n\n/**\n * Get Customer Browser fingerprint\n * @param options - options\n */\nexport const getBrowserFingerprint = (\n  options: BrowserFingerprintOptions = {},\n): BrowserFingerprint => {\n  const deviceInfoFromUserAgent = new UAParser(navigator.userAgent);\n\n  const {\n    country = '',\n    location = getBrowserLocation(),\n    language = getBrowserLanguage(),\n    ip = null,\n  } = options;\n\n  return {\n    browser: deviceInfoFromUserAgent.getBrowser().name ?? null,\n    browserVersion: deviceInfoFromUserAgent.getBrowser().version ?? null,\n    country,\n    ip,\n    language,\n    location,\n    os: deviceInfoFromUserAgent.getOS().name ?? null,\n    osVersion: deviceInfoFromUserAgent.getOS().version ?? null,\n    deviceType: getDeviceType(deviceInfoFromUserAgent.getDevice().type),\n    applicationType: ApplicationType.BROWSER,\n  };\n};\n\nexport const getValidLanguage = (language: string): string => {\n  const cleanedLanguage = language.replace(/_/g, '-').split(/[^a-z0-9-]/i)[0];\n\n  try {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    if (typeof Intl.getCanonicalLocales === 'function') {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      return Intl.getCanonicalLocales(cleanedLanguage)[0];\n    }\n\n    return new Intl.Locale(cleanedLanguage).baseName;\n  } catch (error) {\n    return DEFAULT_LANGUAGE;\n  }\n};\n","import { CALLER_SERVICE_ID } from '@brandembassy/ts-types-platform/dist/http/headers';\n\nimport { CHAT_SDK_VERSION } from '../env/version';\nimport { generateId } from '../utils/generateId';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { NetworkRequestMetadata } from './NetworkRequestMetadata';\n\ninterface DefaultHeaders {\n  Accept: string;\n  [CALLER_SERVICE_ID]: string;\n  'Content-Type': string;\n  'X-Trace-ID': string;\n  'x-sdk-platform': string;\n  'x-sdk-version': string;\n}\n\nexport const getDefaultHeaders = (\n  requestMetadata: NetworkRequestMetadata['httpHeaders'],\n  callerServiceId?: string,\n): DefaultHeaders => {\n  const requestMetadataHeaders = requestMetadata ?? {};\n\n  return {\n    ...requestMetadataHeaders,\n    // Default headers for the fetch requests\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n    [CALLER_SERVICE_ID]: callerServiceId ?? SDKVariableStorage.APP_NAME ?? '',\n    'X-Trace-ID': requestMetadataHeaders['x-trace-id'] ?? generateId(),\n    'x-sdk-platform': 'web',\n    'x-sdk-version': CHAT_SDK_VERSION,\n  };\n};\n","import { ChatSDKError } from './ChatSDKError';\n\nexport class AbortError extends ChatSDKError {\n  constructor(message: string = 'Aborted') {\n    super(message);\n    this.name = 'AbortError';\n  }\n}\n","export const ERROR_CODE_SDK_VERSION_NOT_SUPPORTED = 'SdkVersionNotSupported';\n\nexport class SdkVersionNotSupported extends Error {\n  name = ERROR_CODE_SDK_VERSION_NOT_SUPPORTED;\n  message = 'Please update to the latest ChatSDK version';\n}\n","import {\n  ERROR_CODE_SDK_VERSION_NOT_SUPPORTED,\n  SdkVersionNotSupported,\n} from '../../error/SdkVersionNotSupported';\nimport { ChatEventData } from '../ChatEvent';\n\nexport function isSdkVersionNotSupportedEvent(event: unknown): boolean {\n  return (\n    (event as ChatEventData)?.error?.errorCode ===\n    ERROR_CODE_SDK_VERSION_NOT_SUPPORTED\n  );\n}\n\nexport function sdkVersionCheck(event: ChatEventData): ChatEventData | null {\n  if (isSdkVersionNotSupportedEvent(event)) {\n    throw new SdkVersionNotSupported();\n  }\n\n  return event;\n}\n","export function getNetworkInfo(): Record<string, unknown> | undefined {\n  // @ts-expect-error navigator.connection to be available in modern browsers\n  const connection = navigator?.connection;\n\n  if (!connection) {\n    return undefined;\n  }\n\n  return {\n    type: connection?.type || 'unknown',\n    effectiveType: connection?.effectiveType || 'unknown',\n    downlink: connection?.downlink || 0,\n    rtt: connection?.rtt || 0,\n    online: navigator.onLine,\n  };\n}\n","let isPageUnloading = false;\n\nexport function isWindowClosing(): boolean {\n  return isPageUnloading;\n}\n\nfunction unloadHandler() {\n  isPageUnloading = true;\n  window.removeEventListener('beforeunload', unloadHandler);\n}\n\nexport const registerWindowUnload = (): void => {\n  if (isPageUnloading) {\n    return;\n  }\n\n  window.addEventListener('beforeunload', unloadHandler);\n};\n","export enum SecureSessions {\n  ANONYMOUS = 'anonymous',\n  SECURED_COOKIES = 'securedCookies',\n  THIRD_PARTY = 'thirdParty',\n}\n\nexport type SecureSessionsType = SecureSessions | null;\n","import { AbortError } from '../error/AbortError';\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { SdkVersionNotSupported } from '../error/SdkVersionNotSupported';\nimport { isSdkVersionNotSupportedEvent } from '../event/middleware/sdkVersionCheck';\nimport { getDefaultHeaders } from '../request/defaultHeaders';\nimport { getErrorResponseData } from '../request/getErrorResponseData';\n\nimport { getNetworkInfo } from './getNetworkInfo';\nimport { isWindowClosing } from './isWindowClosing';\n\nexport interface FetchOptions extends Omit<RequestInit, 'headers'> {\n  /**\n   * Additional headers\n   */\n  headers?: Record<string, string>;\n}\n\nasync function abortableFetch(\n  resource: RequestInfo,\n  options?: FetchOptions,\n  callerServiceId?: string,\n): Promise<Response> {\n  const { signal, headers, ...restOptions } = options || {};\n\n  const abortController = new AbortController();\n  const onAbort = () => {\n    abortController.abort(new AbortError('Fetch aborted by signal'));\n  };\n\n  if (signal) {\n    signal.addEventListener('abort', onAbort, { once: true });\n  }\n\n  const requestInit = {\n    headers: {\n      ...getDefaultHeaders(headers, callerServiceId),\n    },\n    signal: abortController.signal,\n    ...restOptions,\n  };\n\n  if (isWindowClosing()) {\n    throw new AbortError('Fetch aborted because the window is closing');\n  }\n\n  const unloadHandler = () => {\n    abortController.abort(\n      new AbortError('Fetch aborted because the window is closing'),\n    );\n  };\n  window?.addEventListener('beforeunload', () => unloadHandler);\n  const requestTimeStart = Date.now();\n\n  try {\n    const response = await fetch(resource, requestInit);\n\n    if (response.ok) {\n      return response;\n    }\n\n    const errorResponseData = await getErrorResponseData(response);\n\n    if (isSdkVersionNotSupportedEvent(errorResponseData)) {\n      throw new SdkVersionNotSupported();\n    }\n\n    throw new ChatSDKError(`Request failed with status ${response.status}`, {\n      requestDuration: Date.now() - requestTimeStart,\n      requestUrl: resource,\n      requestOptions: requestInit,\n      responseStatus: response.status,\n      responseStatusText: response.statusText,\n      networkInfo: getNetworkInfo(),\n      errorResponseData,\n    });\n  } catch (error) {\n    if (abortController.signal.aborted || isWindowClosing()) {\n      throw new AbortError('Fetch aborted');\n    }\n\n    if (error instanceof ChatSDKError) {\n      throw error;\n    }\n\n    throw new ChatSDKError(error, {\n      requestDuration: Date.now() - requestTimeStart,\n      requestUrl: resource,\n      requestOptions: requestInit,\n      networkInfo: getNetworkInfo(),\n    });\n  } finally {\n    window?.removeEventListener('beforeunload', unloadHandler);\n    signal?.removeEventListener('abort', onAbort);\n  }\n}\n\n/**\n * Make a request and parse the response as JSON, otherwise throws the response or error\n *\n * @throws Response - If the response status is not ok\n * @throws AbortError - The request was aborted\n * @throws NotAllowedError\n * @throws TypeError\n * @throws DOMException - The request was aborted\n * @throws SyntaxError - The response body cannot be parsed as JSON\n */\nexport async function fetchJSON<T = unknown>(\n  resource: RequestInfo,\n  options?: FetchOptions,\n  callerServiceId?: string,\n): Promise<T> {\n  const response = await abortableFetch(resource, options, callerServiceId);\n\n  return response.json();\n}\n\n/**\n * Make a GET request\n *\n * @throws Response - If the response status is not ok\n * @throws AbortError - The request was aborted\n * @throws NotAllowedError\n * @throws TypeError\n * @throws DOMException - The request was aborted\n * @throws SyntaxError - The response body cannot be parsed as JSON\n */\nexport async function getJSON<T = unknown>(\n  resource: RequestInfo,\n  options?: FetchOptions,\n  callerServiceId?: string,\n): Promise<T> {\n  return fetchJSON(resource, { method: 'GET', ...options }, callerServiceId);\n}\n\n/**\n * Make a POST request with JSON body\n *\n * @throws Response - If the response status is not ok\n * @throws AbortError - The request was aborted\n * @throws NotAllowedError\n * @throws TypeError\n * @throws DOMException - The request was aborted\n * @throws SyntaxError - The response body cannot be parsed as JSON\n */\nexport async function postJSON<T = unknown>(\n  resource: RequestInfo,\n  body: unknown,\n  options?: FetchOptions,\n  callerServiceId?: string,\n): Promise<T> {\n  return fetchJSON(\n    resource,\n    {\n      method: 'POST',\n      body: JSON.stringify(body ?? {}),\n      ...options,\n    },\n    callerServiceId,\n  );\n}\n","export async function getErrorResponseData(\n  response: Response,\n): Promise<unknown> {\n  let errorResponseData: unknown;\n  let rawDataAsString: string | undefined;\n\n  try {\n    rawDataAsString = await response.text();\n    errorResponseData = JSON.parse(rawDataAsString);\n  } catch (error) {\n    errorResponseData = rawDataAsString;\n  }\n\n  if (!errorResponseData) {\n    errorResponseData = response.statusText;\n  }\n\n  return errorResponseData;\n}\n","import { ChannelAvailability } from '@brandembassy/ts-types-chat/dist/channel/ChannelInfo';\nimport { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\n\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { getDefaultHeaders } from '../request/defaultHeaders';\nimport { NetworkRequestMetadata } from '../request/NetworkRequestMetadata';\nimport { getJSON } from '../utils/fetchJSON';\n\nexport interface ChannelAvailabilityResponse {\n  status: ChannelAvailability;\n}\n\nexport async function fetchChannelAvailability(\n  brandId: BrandId,\n  channelId: ChannelId,\n  chatEndpoint: string,\n  requestMetadataHttpHeaders: NetworkRequestMetadata['httpHeaders'] = {},\n  callerServiceId?: string,\n): Promise<ChannelAvailabilityResponse> {\n  const resource = `${chatEndpoint}/chat/1.0/brand/${brandId}/channel/${channelId}/availability`;\n  const options = {\n    headers: {\n      ...getDefaultHeaders(requestMetadataHttpHeaders, callerServiceId),\n    },\n  };\n\n  try {\n    return getJSON<ChannelAvailabilityResponse>(\n      resource,\n      options,\n      callerServiceId,\n    );\n  } catch (error) {\n    throw new ChatSDKError('Failed to fetch channel availability.', { error });\n  }\n}\n","import { ChannelInfo } from '@brandembassy/ts-types-chat/dist/channel/ChannelInfo';\nimport { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\n\nimport { getBrowserLanguage } from '../browserFingerprint/getBrowserFingerprint';\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { getDefaultHeaders } from '../request/defaultHeaders';\nimport { NetworkRequestMetadata } from '../request/NetworkRequestMetadata';\nimport { FetchOptions, getJSON } from '../utils/fetchJSON';\n\nexport async function fetchChannelInfo(\n  brandId: BrandId,\n  channelId: ChannelId,\n  language = getBrowserLanguage(),\n  chatEndpoint: string,\n  requestMetadataHttpHeaders: NetworkRequestMetadata['httpHeaders'] = {},\n  callerServiceId?: string,\n): Promise<ChannelInfo> {\n  const languageLocale = `${language}`.split('-').join('_');\n  const resource = `${chatEndpoint}/chat/1.0/brand/${brandId}/channel/${channelId}?locale=${languageLocale}`;\n\n  const options: FetchOptions = {\n    headers: {\n      ...getDefaultHeaders(requestMetadataHttpHeaders, callerServiceId),\n    },\n  };\n\n  try {\n    return getJSON<ChannelInfo>(resource, options, callerServiceId);\n  } catch (error) {\n    throw new ChatSDKError('Failed to fetch channel info.', { error });\n  }\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { isNil } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { SecureSessions, SecureSessionsType } from './SecureSessionsType';\n\nexport const getSecuredSessionType = (): SecureSessionsType =>\n  SDKVariableStorage.SECURED_SESSION ?? null;\n\nexport const shouldHandleCustomerIdForSecureSessions = (): boolean =>\n  SDKVariableStorage.SECURED_SESSION === SecureSessions.ANONYMOUS;\n\nexport const isSecureSessions = (): boolean => getSecuredSessionType() !== null;\n\nexport const getSecureSessionsTypeFromOptions = (\n  secureSessionsOption: unknown,\n): SecureSessionsType => {\n  if (isNil(secureSessionsOption)) {\n    return null;\n  }\n\n  const secureSessionType = Object.values(SecureSessions).includes(\n    secureSessionsOption as SecureSessions,\n  );\n\n  if (secureSessionType === false) {\n    throw new ChatSDKError(\n      `Expected a SecureSessions value, got ${secureSessionsOption}`,\n    );\n  }\n\n  return secureSessionsOption as SecureSessions;\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\n\nexport enum EnvironmentName {\n  AE1 = 'AE1',\n  AU1 = 'AU1',\n  AU2 = 'AU2',\n  CA1 = 'CA1',\n  EU1 = 'EU1',\n  EU2 = 'EU2',\n  JO1 = 'JO1',\n  JP1 = 'JP1',\n  KR1 = 'KR1',\n  NA1 = 'NA1',\n  NA2 = 'NA2',\n  UK1 = 'UK1',\n  UK2 = 'UK2',\n  ZA1 = 'ZA1',\n  custom = 'custom',\n}\n\nconst EnvironmentToPublicDNS: Record<EnvironmentName, string> = {\n  [EnvironmentName.AE1]: 'nicecxone.com',\n  [EnvironmentName.AU1]: 'niceincontact.com',\n  [EnvironmentName.AU2]: 'nicecxone-sov1.au',\n  [EnvironmentName.CA1]: 'niceincontact.com',\n  [EnvironmentName.EU1]: 'niceincontact.com',\n  [EnvironmentName.EU2]: 'nicecxone-sov1.eu',\n  [EnvironmentName.JO1]: 'nicecxone.com',\n  [EnvironmentName.JP1]: 'niceincontact.com',\n  [EnvironmentName.KR1]: 'nicecxone.com',\n  [EnvironmentName.NA1]: 'niceincontact.com',\n  [EnvironmentName.NA2]: 'nicecxone-gov.com',\n  [EnvironmentName.UK1]: 'niceincontact.com',\n  [EnvironmentName.UK2]: 'nicecxone-sov1.uk',\n  [EnvironmentName.ZA1]: 'nicecxone.com',\n  [EnvironmentName.custom]: '',\n};\n\nexport interface EnvironmentEndpoints {\n  authorize: string;\n  chat: string;\n  gateway: string;\n  name: string;\n}\n\nexport function buildEnvironmentEndpoints(\n  environment: EnvironmentName,\n): EnvironmentEndpoints {\n  if (!(environment in EnvironmentName)) {\n    throw new ChatSDKError(`Unknown environment: ${environment}`);\n  }\n\n  if (environment === EnvironmentName.custom) {\n    throw new ChatSDKError(\n      'The custom environment cannot be constructed using the built-in configuration',\n    );\n  }\n\n  const publicDNS = EnvironmentToPublicDNS[environment];\n  const chat = `https://channels-de-${environment}.${publicDNS}`.toLowerCase();\n  const gateway =\n    `wss://chat-gateway-de-${environment}.${publicDNS}`.toLowerCase();\n  const name = environment;\n  const authorize =\n    `https://digital-oauth-de-${environment}.${publicDNS}`.toLowerCase();\n\n  return {\n    chat,\n    name,\n    gateway,\n    authorize,\n  };\n}\n","import { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { EnvironmentEndpoints } from './Environments';\n\nexport const setEnvironmentEndpoints = (\n  endpoints: EnvironmentEndpoints,\n): void => {\n  assertEndpoint(endpoints.gateway, 'gateway');\n  assertEndpoint(endpoints.chat, 'chat');\n  assertEndpoint(endpoints.authorize, 'authorize');\n\n  SDKVariableStorage.ENDPOINT_GATEWAY = endpoints.gateway;\n  SDKVariableStorage.ENDPOINT_CHAT = endpoints.chat;\n  SDKVariableStorage.ENDPOINT_AUTHORIZE = endpoints.authorize;\n};\n\nconst validateEndpoint = (endpoint: string): boolean => {\n  try {\n    new URL(endpoint);\n  } catch (error) {\n    return false;\n  }\n\n  return true;\n};\n\nconst assertEndpoint = (endpoint: string, endpointName: string): void => {\n  if (!validateEndpoint(endpoint)) {\n    throw new Error(\n      `Invalid ${endpointName} endpoint: ${endpoint}. Must be a valid URL.`,\n    );\n  }\n};\n","export const ERROR_CODE_IP_ADDRESS_BLOCKED = 'ipAddressBlocked';\n\nexport class IpAddressBlockedError extends Error {\n  name = ERROR_CODE_IP_ADDRESS_BLOCKED;\n}\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { PushUpdateContext } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateContext';\nimport { PushUpdateEventType } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventType';\n\nimport { MessageFailedEventData } from '../message/MessageSuccessEventData';\n\nexport const ChatEvent = {\n  ...PushUpdateEventType,\n  ...AwsResponseEventType,\n  AGENT_TYPING_STARTED: 'AgentTypingStarted',\n  AGENT_TYPING_ENDED: 'AgentTypingEnded',\n  ASSIGNED_AGENT_CHANGED: 'AssignedAgentChanged',\n  CONTACT_CREATED: 'ContactCreated',\n  CONTACT_STATUS_CHANGED: 'ContactStatusChanged',\n  CONTACT_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED:\n    'ContactToRoutingQueueAssignmentChanged',\n} as const;\n\nexport class ChatCustomEvent<\n  T extends ChatEventData = ChatEventData,\n> extends CustomEvent<T> {}\n\nexport interface ChatEventData {\n  context?: [] | PushUpdateContext;\n  createdAt: string;\n  createdAtWithMilliseconds?: string;\n  data: unknown;\n  error?: MessageFailedEventData['error'];\n  id: string;\n  type?: ChatEventType;\n}\n\nexport type ChatEventKey = keyof typeof ChatEvent;\nexport type ChatEventType = typeof ChatEvent[ChatEventKey];\n","import { isNil } from '../utils/is';\n\nimport { ChatEventData } from './ChatEvent';\n\nexport type EventMiddleware = (\n  eventData: ChatEventData,\n) => ChatEventData | null;\n\nexport class ChatEventMiddleware {\n  middlewares: Array<EventMiddleware> = [];\n\n  register(middleware: EventMiddleware): void {\n    this.middlewares.push(middleware);\n  }\n\n  process(event: ChatEventData | null): ChatEventData | null {\n    if (isNil(event)) {\n      return null;\n    }\n\n    let processedEvent: ChatEventData | null = event;\n\n    for (const middleware of this.middlewares) {\n      if (processedEvent === null) {\n        return null;\n      }\n      processedEvent = middleware(processedEvent);\n    }\n\n    return processedEvent;\n  }\n}\n","import { ChatCustomEvent, ChatEventType } from './ChatEvent';\n\nexport interface IChatEventTarget extends EventTarget {\n  addEventListener<K extends ChatEventType>(\n    type: K,\n    listener: (event: ChatCustomEvent) => void,\n    options?: boolean | AddEventListenerOptions,\n  ): void;\n  addEventListener(\n    type: string,\n    callback: EventListenerOrEventListenerObject | null,\n    options?: EventListenerOptions | boolean,\n  ): void;\n\n  dispatchEvent(event: ChatCustomEvent): boolean;\n\n  removeEventListener(\n    type: string,\n    callback: EventListenerOrEventListenerObject | null,\n    options?: boolean | EventListenerOptions | undefined,\n  ): void;\n  removeEventListener<K extends ChatEventType>(\n    type: K,\n    callback: (event: ChatCustomEvent) => void,\n    options?: boolean | EventListenerOptions | undefined,\n  ): void;\n}\n\nexport const ChatEventTarget = EventTarget as {\n  new (): IChatEventTarget;\n  prototype: IChatEventTarget;\n};\n","import { TypingEventData } from '@brandembassy/ts-types-platform/dist/user/typing/TypingEventData';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nfunction isOutbound(data: unknown): boolean {\n  return (data as TypingEventData)?.direction === 'outbound';\n}\n\nexport function agentTypingStarted(event: ChatEventData): ChatEventData {\n  if (isOutbound(event.data)) {\n    return {\n      ...event,\n      type: ChatEvent.AGENT_TYPING_STARTED,\n    };\n  }\n\n  return event;\n}\n\nexport function agentTypingEnded(event: ChatEventData): ChatEventData {\n  if (isOutbound(event.data)) {\n    return {\n      ...event,\n      type: ChatEvent.AGENT_TYPING_ENDED,\n    };\n  }\n\n  return event;\n}\n","import { PushUpdateContext } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateContext';\n\nimport { MessageFailedEventData } from '../message/MessageSuccessEventData';\nimport { isEmpty } from '../utils/is';\n\nimport { ChatEventData, ChatEventType } from './ChatEvent';\n\ninterface EventBase {\n  createdAt: string;\n}\n\ninterface EventDataWithPostback extends EventBase {\n  postback: {\n    data: Record<string, unknown>;\n    eventType: ChatEventType;\n  };\n}\n\ninterface EventWithEventId extends EventBase {\n  eventId: string;\n}\n\ninterface EventWithData extends EventBase {\n  context?: [] | PushUpdateContext;\n  data: Record<string, unknown>;\n}\ninterface EventWithType extends EventBase {\n  eventType: ChatEventType;\n}\n\nconst EMPTY_EVENT = {\n  id: '',\n  data: null,\n  type: undefined,\n  createdAt: new Date().toISOString(),\n};\n\nconst hasData = (event: unknown): event is EventWithData =>\n  'data' in (event as EventWithData);\n\nconst hasError = (event: unknown): event is MessageFailedEventData =>\n  'error' in (event as MessageFailedEventData);\n\nconst hasEventId = (event: unknown): event is EventWithEventId =>\n  'eventId' in (event as EventWithEventId);\n\nconst hasEventType = (event: unknown): event is EventWithType =>\n  'eventType' in (event as EventWithType);\n\nconst isDataWithPostback = (\n  eventDetailData: unknown,\n): eventDetailData is EventDataWithPostback => {\n  const postback = (eventDetailData as EventDataWithPostback)?.postback;\n\n  return isEmpty(postback) === false;\n};\n\nexport function normalizeEvent(event: unknown): ChatEventData {\n  if (!hasEventId(event)) {\n    return EMPTY_EVENT;\n  }\n\n  if (hasError(event)) {\n    return {\n      createdAt: event.createdAt,\n      data: null,\n      error: event.error,\n      id: event.eventId,\n    };\n  }\n\n  const eventType = hasEventType(event) ? event.eventType : undefined;\n\n  if (hasData(event)) {\n    return {\n      createdAt: event.createdAt,\n      context: event.context,\n      data: event.data,\n      id: event.eventId,\n      type: eventType,\n    };\n  }\n\n  if (isDataWithPostback(event)) {\n    const {\n      postback: { data: postbackData, eventType: postbackEventType },\n      eventId: rawEventId,\n      ...restEventData\n    } = event;\n\n    return {\n      type: postbackEventType,\n      data: {\n        ...restEventData,\n        ...postbackData,\n      },\n      createdAt: event.createdAt,\n      id: rawEventId,\n    };\n  }\n\n  const { eventId, ...eventRest } = event;\n\n  return {\n    data: undefined,\n    ...eventRest,\n    id: eventId,\n    type: eventType,\n    createdAt: event.createdAt,\n  };\n}\n","import { agentTypingEnded, agentTypingStarted } from '../../agent/agentTyping';\nimport { assignedAgentChanged } from '../../agent/assignedAgentChanged';\nimport { contactCreated } from '../../contact/contactCreated';\nimport { contactStatusChanged } from '../../contact/contactStatusChanged';\nimport { contactToRoutingQueueAssignmentChanged } from '../../contact/contactToRoutingQueueAssignmentChanged';\nimport { livechatRecovered } from '../../thread/livechatThread/livechatRecovered';\nimport { threadRecovered } from '../../thread/threadRecovered';\nimport { ChatEvent, ChatEventData } from '../ChatEvent';\nimport { EventMiddleware } from '../ChatEventMiddleware';\n\nconst eventTypeMap: Record<string, EventMiddleware> = {\n  [ChatEvent.SENDER_TYPING_STARTED]: agentTypingStarted,\n  [ChatEvent.SENDER_TYPING_ENDED]: agentTypingEnded,\n  [ChatEvent.CASE_INBOX_ASSIGNEE_CHANGED]: assignedAgentChanged,\n  [ChatEvent.CASE_CREATED]: contactCreated,\n  [ChatEvent.CASE_STATUS_CHANGED]: contactStatusChanged,\n  [ChatEvent.CASE_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED]:\n    contactToRoutingQueueAssignmentChanged,\n  [ChatEvent.LIVECHAT_RECOVERED]: livechatRecovered,\n  [ChatEvent.THREAD_RECOVERED]: threadRecovered,\n} as const;\n\nexport function chatEventMapper(event: ChatEventData): ChatEventData | null {\n  if (event.type && eventTypeMap[event.type] !== undefined) {\n    return eventTypeMap[event.type](event);\n  }\n\n  return event;\n}\n","import { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport function assignedAgentChanged(event: ChatEventData): ChatEventData {\n  return {\n    ...event,\n    type: ChatEvent.ASSIGNED_AGENT_CHANGED,\n  };\n}\n","import { CaseCreatedData } from '@brandembassy/ts-types-platform/dist/post/case/CaseCreatedEvent';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport type ContactCreatedData = CaseCreatedData;\n\nexport interface ContactCreatedChatEvent extends ChatEventData {\n  data: ContactCreatedData;\n  type: typeof ChatEvent.CONTACT_CREATED;\n}\n\nexport function contactCreated(event: ChatEventData): ChatEventData {\n  return {\n    ...event,\n    type: ChatEvent.CONTACT_CREATED,\n  };\n}\n","import { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport function contactStatusChanged(event: ChatEventData): ChatEventData {\n  return {\n    ...event,\n    type: ChatEvent.CONTACT_STATUS_CHANGED,\n  };\n}\n","import { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nimport { ContactToRoutingQueueAssignmentChangedChatEvent } from './isContactToRoutingQueueAssignmentChangedEvent';\n\nexport function contactToRoutingQueueAssignmentChanged(\n  event: ChatEventData,\n): ContactToRoutingQueueAssignmentChangedChatEvent {\n  return {\n    ...(event as ContactToRoutingQueueAssignmentChangedChatEvent),\n    type: ChatEvent.CONTACT_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED,\n  };\n}\n","import { PushUpdateEventFields } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventFields';\n\nimport { ChatEventData } from '../../event/ChatEvent';\nimport { chatEventMapper } from '../../event/middleware/ChatEventMapper';\nimport { normalizeEvent } from '../../event/normalizeEvent';\n\nexport function livechatRecovered(event: ChatEventData): ChatEventData {\n  const normalizedContactHistoryItems = (\n    (event.data as Record<string, unknown>)\n      .contactHistory as Array<PushUpdateEventFields>\n  )\n    .map(normalizeEvent)\n    // to apply new event types for all contact history items\n    .map(chatEventMapper)\n    .filter((item): item is ChatEventData => Boolean(item));\n\n  return {\n    ...event,\n    data: {\n      ...(event.data as Record<string, unknown>),\n      contactHistory: normalizedContactHistoryItems,\n    },\n  };\n}\n","import { ThreadRecoveredPostbackData } from '@brandembassy/ts-types-chat/dist/awsEvents/ThreadRecovered';\nimport { PushUpdateEventFields } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventFields';\n\nimport { ChatEventData } from '../event/ChatEvent';\nimport { chatEventMapper } from '../event/middleware/ChatEventMapper';\nimport { normalizeEvent } from '../event/normalizeEvent';\n\nimport { ThreadRecoveredChatEvent } from './isRecoverSuccessPayload';\n\nexport function threadRecovered(\n  event: ChatEventData,\n): ThreadRecoveredChatEvent {\n  const normalizedContactHistoryItems = (\n    (event.data as ThreadRecoveredPostbackData)\n      .contactHistory as Array<PushUpdateEventFields>\n  )\n    .map(normalizeEvent)\n    // to apply new event types for all contact history items\n    .map(chatEventMapper)\n    .filter((item): item is ChatEventData => Boolean(item));\n\n  return {\n    ...event,\n    data: {\n      ...(event.data as ThreadRecoveredPostbackData),\n      contactHistory: normalizedContactHistoryItems,\n    },\n  };\n}\n","export function assertNonNullable<T>(\n  value: T,\n): asserts value is NonNullable<T> {\n  if (typeof value === 'undefined' || value === null) {\n    throw Error(`Expected non-nullish value, got ${value}`);\n  }\n}\n\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function assertIsCallable<T extends (...args: Array<any>) => any>(\n  value: T,\n): asserts value is T {\n  if (typeof value !== 'function') {\n    throw Error(`Expected a callable function, got ${value}`);\n  }\n}\n","import { getBrowserLanguage } from './browserFingerprint/getBrowserFingerprint';\nimport type { ChatSDKOptions } from './ChatSDKOptions';\nimport { APP_NAME } from './env/appName';\nimport { NetworkRequestMetadata } from './request/NetworkRequestMetadata';\nimport { validateAndFilterHttpHeaders } from './request/validateAndFilterHttpHeaders';\nimport { validateAndFilterWebSocketQuery } from './request/validateAndFilterWebSocketQuery';\nimport { getSecureSessionsTypeFromOptions } from './securedSession/getSecuredSessionType';\nimport { assertIsCallable } from './utils/assert';\nimport { SDKVariableStorage } from './variables/VariableStorage';\n\nexport function initializeSdkVariables(options: ChatSDKOptions): void {\n  SDKVariableStorage.AUTHORIZATION_CODE = options.authorizationCode;\n  SDKVariableStorage.BRAND_ID = options.brandId;\n  SDKVariableStorage.CHANNEL_ID = options.channelId;\n  SDKVariableStorage.APP_NAME = options.appName ?? APP_NAME;\n  SDKVariableStorage.APP_VERSION = `${options.appVersion ?? 0}`;\n  // Store the destinationId, visitId, and visitorId for payload data use\n  SDKVariableStorage.DESTINATION = options.destinationId;\n  SDKVariableStorage.VISIT_ID = options.visitId;\n  SDKVariableStorage.VISITOR_ID = options.visitorId;\n  SDKVariableStorage.LANGUAGE = options.language ?? getBrowserLanguage();\n  SDKVariableStorage.SECURED_SESSION = getSecureSessionsTypeFromOptions(\n    options.securedSession,\n  );\n  SDKVariableStorage.IDENTITY_TOKEN = options.identityToken;\n  SDKVariableStorage.REQUEST_METADATA = initializeRequestMetadata(options);\n\n  if (options.storage) {\n    assertIsCallable(options.storage.getItem);\n    assertIsCallable(options.storage.setItem);\n    assertIsCallable(options.storage.removeItem);\n    SDKVariableStorage.STORAGE = options.storage;\n  }\n\n  if (options.cacheStorage) {\n    assertIsCallable(options.cacheStorage.getItem);\n    assertIsCallable(options.cacheStorage.setItem);\n    assertIsCallable(options.cacheStorage.removeItem);\n    SDKVariableStorage.CACHE_STORAGE = options.cacheStorage;\n  }\n}\n\nexport const initializeRequestMetadata = (\n  options: ChatSDKOptions,\n): NetworkRequestMetadata => {\n  const onError = options.onError;\n\n  // validate http headers\n  const httpHeaders = validateAndFilterHttpHeaders(\n    options.networkRequestMetadata?.httpHeaders,\n    onError,\n  );\n\n  // validate websocket query params\n  const websocketQuery = validateAndFilterWebSocketQuery(\n    options.networkRequestMetadata?.websocketQuery,\n    onError,\n  );\n\n  return {\n    httpHeaders,\n    websocketQuery,\n  };\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\n\nexport const validateAndFilterHttpHeaders = (\n  httpHeaders: Record<string | number, unknown> | undefined,\n  onError?: (error: Error) => void,\n): Record<string, string> => {\n  if (!httpHeaders) {\n    return {};\n  }\n\n  const validHttpHeaders = Object.entries(httpHeaders).reduce(\n    (acc, entry) => validateAndFilterHeader(acc, entry, onError),\n    {} as Record<string, string>,\n  );\n\n  return validHttpHeaders;\n};\n\nexport const validateAndFilterHeader = (\n  acc: Record<string, string>,\n  [key, value]: [unknown, unknown],\n  onError?: (error: Error) => void,\n): Record<string, string> => {\n  if (\n    (typeof key !== 'string' && typeof key !== 'number') ||\n    (typeof value !== 'string' && typeof value !== 'number')\n  ) {\n    onError?.(\n      new ChatSDKError(\n        `Invalid HTTP header: key \"${key}\" and value \"${value}\" must be strings or numbers.`,\n      ),\n    );\n\n    return acc;\n  }\n\n  // Convert key to string\n  const headerKey = String(key);\n\n  // check for empty key\n  if (headerKey.trim() === '') {\n    onError?.(\n      new ChatSDKError(\n        `Invalid HTTP header: key \"${headerKey}\" must not be an empty string.`,\n      ),\n    );\n\n    return acc;\n  }\n\n  const headerObject = new Headers();\n  try {\n    headerObject.append(headerKey, String(value));\n  } catch (e) {\n    onError?.(\n      new ChatSDKError(\n        `Invalid HTTP header: key \"${headerKey}\" and value \"${value}\" cannot be added to Headers.`,\n      ),\n    );\n\n    return acc;\n  }\n\n  acc[headerKey] = String(value);\n\n  return acc;\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\n\nexport const validateAndFilterWebSocketQuery = (\n  websocketQuery: Record<string | number, unknown> | undefined,\n  onError?: (error: Error) => void,\n): Record<string, string> => {\n  if (!websocketQuery) {\n    return {};\n  }\n\n  const validWebSocketQuery = Object.entries(websocketQuery).reduce(\n    (acc, entry) => validateAndFilterQueryParam(acc, entry, onError),\n    {} as Record<string, string>,\n  );\n\n  return validWebSocketQuery;\n};\n\nconst validateAndFilterQueryParam = (\n  acc: Record<string, string>,\n  [key, value]: [unknown, unknown],\n  onError?: (error: Error) => void,\n): Record<string, string> => {\n  if (\n    (typeof key !== 'string' && typeof key !== 'number') ||\n    (typeof value !== 'string' && typeof value !== 'number')\n  ) {\n    onError?.(\n      new ChatSDKError(\n        `Invalid WebSocket query parameter: key \"${key}\" and value \"${value}\" must be strings or numbers.`,\n      ),\n    );\n\n    return acc;\n  }\n\n  // Convert key to string\n  const queryKey = String(key);\n\n  // check for empty key\n  if (queryKey.trim() === '') {\n    onError?.(\n      new ChatSDKError(\n        `Invalid WebSocket query parameter: key \"${queryKey}\" must not be an empty string.`,\n      ),\n    );\n\n    return acc;\n  }\n\n  const searchParams = new URLSearchParams();\n\n  try {\n    searchParams.append(queryKey, String(value));\n    searchParams.toString(); // This will throw error if searchParams is invalid\n  } catch (e) {\n    onError?.(\n      new ChatSDKError(\n        `Invalid WebSocket query parameter: key \"${queryKey}\" and value \"${value}\" must not be empty strings.`,\n      ),\n    );\n\n    return acc;\n  }\n\n  acc[queryKey] = String(value);\n\n  return acc;\n};\n","import { ChatEventData } from '../event/ChatEvent';\nimport { isUndefined } from '../utils/is';\n\nexport interface MessageSuccessEventData extends ChatEventData {\n  id: string;\n}\nexport interface MessageFailedEventData extends MessageSuccessEventData {\n  error: {\n    errorCode: string;\n    errorMessage: string;\n    transactionId: string;\n  };\n  id: string;\n}\n\nexport function isSendMessageSuccessEventData(\n  event: ChatEventData,\n): event is MessageSuccessEventData {\n  const hasEventId =\n    isUndefined((event as MessageSuccessEventData)?.id) === false;\n\n  const hasError =\n    isUndefined((event as MessageFailedEventData).error) === false;\n\n  return hasError === false && hasEventId;\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\n\ninterface SendMessageFailedErrorData {\n  response: unknown;\n}\n\nexport class SendMessageFailedError extends ChatSDKError {\n  data: SendMessageFailedErrorData | undefined;\n\n  constructor(message: string, data?: SendMessageFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { Message } from '@brandembassy/ts-types-platform/dist/message/Message';\nimport { MessageDirection } from '@brandembassy/ts-types-platform/dist/message/MessageDirection';\n\n/**\n * Get message author name of given message\n * @param message - message\n * @returns message author name\n */\nexport const getAuthor = (message: Message): string =>\n  message.direction === MessageDirection.INBOUND\n    ? message.authorEndUserIdentity?.fullName ?? ''\n    : `${message.authorUser?.firstName ?? ''} ${\n        message.authorUser?.surname ?? ''\n      }`.trim();\n","import { Message } from '@brandembassy/ts-types-platform/dist/message/Message';\n\nimport { isUndefined } from '../utils/is';\n\nexport function isMessage(item: unknown): item is Message {\n  const hasId = isUndefined((item as Message).id) === false;\n  const hasDirection = isUndefined((item as Message).direction) === false;\n  const hasMessageContent =\n    isUndefined((item as Message).messageContent) === false;\n\n  return hasId && hasDirection && hasMessageContent;\n}\n","import { MessageCreatedData } from '@brandembassy/ts-types-platform/dist/message/MessageCreatedEvent';\nimport { PushUpdateEventType } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventType';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface MessageCreatedEvent extends ChatEventData {\n  data: MessageCreatedData;\n  type: PushUpdateEventType.MESSAGE_CREATED;\n}\n\nexport function isMessageCreatedEvent(\n  event: unknown,\n): event is MessageCreatedEvent {\n  return (\n    (event as MessageCreatedEvent).type === PushUpdateEventType.MESSAGE_CREATED\n  );\n}\n","import { MessageSentData } from '@brandembassy/ts-types-platform/dist/message/MessageSentEvent';\nimport { PushUpdateEventType } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventType';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface MessageSentEvent extends ChatEventData {\n  data: MessageSentData;\n  type: PushUpdateEventType.MESSAGE_SENT;\n}\n\nexport function isMessageSentEvent(event: unknown): event is MessageSentEvent {\n  return (event as MessageSentEvent).type === PushUpdateEventType.MESSAGE_SENT;\n}\n","import { MessageReadChangedData } from '@brandembassy/ts-types-platform/dist/message/MessageReadChangedEvent';\nimport { PushUpdateEventType } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventType';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface MessageReadChangedEvent extends ChatEventData {\n  data: MessageReadChangedData;\n  type: PushUpdateEventType.MESSAGE_READ_CHANGED;\n}\n\nexport function isMessageReadChangedEvent(\n  event: unknown,\n): event is MessageReadChangedEvent {\n  return (\n    (event as MessageReadChangedEvent).type ===\n    PushUpdateEventType.MESSAGE_READ_CHANGED\n  );\n}\n","import { AuthorizationToken } from '@brandembassy/ts-types-chat/dist/authorization/AuthorizationToken';\nimport { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { Message } from '@brandembassy/ts-types-platform/dist/message/Message';\nimport { MessageId } from '@brandembassy/ts-types-platform/dist/message/MessageId';\n\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { getDefaultHeaders } from '../request/defaultHeaders';\nimport { FetchOptions, getJSON } from '../utils/fetchJSON';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nexport function getUrlPathForMessageWithFullContent(\n  brandId: BrandId,\n  messageId: MessageId,\n): string {\n  return `/chat/1.0/brand/${brandId}/messages/${messageId}`;\n}\n\nexport async function fetchMessageWithFullContent(\n  message: Message,\n  brandId: BrandId,\n  authorizationToken: AuthorizationToken,\n): Promise<Message> {\n  const resource = `${\n    SDKVariableStorage.ENDPOINT_CHAT\n  }${getUrlPathForMessageWithFullContent(brandId, message.id)}`;\n\n  const requestMetadataHttpHeaders =\n    SDKVariableStorage.REQUEST_METADATA?.httpHeaders || {};\n\n  const options: FetchOptions = {\n    headers: {\n      ...getDefaultHeaders(requestMetadataHttpHeaders),\n      Authorization: `Bearer ${authorizationToken.token}`,\n    },\n  };\n\n  try {\n    return getJSON<Message>(resource, options);\n  } catch (error) {\n    throw new ChatSDKError('Failed to fetch message content.', { error });\n  }\n}\n","import { S3EventData } from '@brandembassy/ts-types-platform/dist/largeEvent/S3Event';\nimport { PushUpdateEventType } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventType';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport interface S3ChatEvent extends ChatEventData {\n  data: S3EventData;\n  type: typeof ChatEvent.EVENT_IN_S3;\n}\n\nexport function isS3ChatEvent(event: unknown): event is S3ChatEvent {\n  return (event as S3ChatEvent).type === PushUpdateEventType.EVENT_IN_S3;\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { ChatEventData } from '../event/ChatEvent';\nimport { normalizeEvent } from '../event/normalizeEvent';\nimport { isMessageCreatedEvent } from '../message';\nimport { getMessageWithFullContent } from '../message/getMessageFullContent';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\nimport { getJSON } from '../utils/fetchJSON';\nimport { isNil } from '../utils/is';\n\nimport { isS3ChatEvent } from './isS3ChatEvent';\n\nexport const getEventData = async (\n  eventData: ChatEventData | undefined,\n  websocketClient: WebSocketClient | null,\n): Promise<ChatEventData | null> => {\n  if (isNil(eventData)) {\n    return null;\n  }\n\n  if (!isS3ChatEvent(eventData) && !isMessageCreatedEvent(eventData)) {\n    return eventData;\n  }\n\n  if (isMessageCreatedEvent(eventData)) {\n    return getMessageWithFullContent(eventData, websocketClient);\n  }\n\n  if (isS3ChatEvent(eventData)) {\n    const response = await getJSON<ChatEventData>(eventData.data.s3Object.url);\n\n    return normalizeEvent(response);\n  }\n\n  throw new ChatSDKError('Failed to fetch additional data for event');\n};\n","import { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { TransactionTokenResponse } from './TransactionToken';\n\nconst TRANSACTION_TOKEN_CACHE_KEY = 'TTR';\n\nexport const getCachedTransactionTokenResponse =\n  (): TransactionTokenResponse | null => {\n    if (!SDKVariableStorage.CACHE_STORAGE) {\n      return null;\n    }\n\n    return SDKVariableStorage.CACHE_STORAGE.getItem(\n      TRANSACTION_TOKEN_CACHE_KEY,\n    );\n  };\n\nexport const cacheTransactionTokenResponse = (\n  response: TransactionTokenResponse,\n  expiresIn: number,\n): void => {\n  if (!SDKVariableStorage.CACHE_STORAGE) {\n    return;\n  }\n\n  SDKVariableStorage.CACHE_STORAGE.setItem(\n    TRANSACTION_TOKEN_CACHE_KEY,\n    response,\n    expiresIn * 1000,\n  );\n};\n\nexport const clearCachedTransactionTokenResponse = (): void => {\n  if (!SDKVariableStorage.CACHE_STORAGE) {\n    return;\n  }\n\n  SDKVariableStorage.CACHE_STORAGE.removeItem(TRANSACTION_TOKEN_CACHE_KEY);\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { ERROR_AUTHORIZE_HOSTNAME_NOT_SET } from '../error/errorMessages';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nexport function getAuthorizeUrl(storageFallback: boolean): string {\n  if (!SDKVariableStorage.ENDPOINT_AUTHORIZE) {\n    throw new ChatSDKError(ERROR_AUTHORIZE_HOSTNAME_NOT_SET);\n  }\n\n  const authorizeUrl = new URL(SDKVariableStorage.ENDPOINT_AUTHORIZE);\n  authorizeUrl.pathname = '/oauth/token';\n  authorizeUrl.searchParams.append(\n    'brandId',\n    String(SDKVariableStorage.BRAND_ID),\n  );\n  authorizeUrl.searchParams.append(\n    'channelId',\n    SDKVariableStorage.CHANNEL_ID ?? '',\n  );\n  authorizeUrl.searchParams.append(\n    'visitorId',\n    SDKVariableStorage.VISITOR_ID ?? '',\n  );\n\n  if (storageFallback) {\n    authorizeUrl.searchParams.append('storageFallback', '1');\n  }\n\n  return authorizeUrl.toString();\n}\n","import { SDKVariableStorage } from '../variables/VariableStorage';\n\n// The same key as identity cookie name\nconst IDENTITY_TOKEN_KEY = 'cx_digital_wi';\n\nexport function storeIdentityToken(token: string): void {\n  SDKVariableStorage.IDENTITY_TOKEN = token;\n  if (SDKVariableStorage.STORAGE) {\n    SDKVariableStorage.STORAGE.setItem(IDENTITY_TOKEN_KEY, token);\n  }\n}\n\nexport function getIdentityToken(): string | null {\n  if (SDKVariableStorage.IDENTITY_TOKEN) {\n    return SDKVariableStorage.IDENTITY_TOKEN;\n  }\n\n  if (SDKVariableStorage.STORAGE) {\n    return SDKVariableStorage.STORAGE.getItem(IDENTITY_TOKEN_KEY);\n  }\n\n  return null;\n}\n\nexport function removeIdentityToken(): void {\n  SDKVariableStorage.IDENTITY_TOKEN = undefined;\n\n  if (SDKVariableStorage.STORAGE) {\n    SDKVariableStorage.STORAGE.removeItem(IDENTITY_TOKEN_KEY);\n  }\n}\n","import { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { ThirdPartyToken } from './ThirdPartyToken';\n\nexport function setThirdPartyToken(token: ThirdPartyToken): void {\n  SDKVariableStorage.THIRD_PARTY_TOKEN = token;\n}\nexport function getThirdPartyToken(): ThirdPartyToken | null {\n  return SDKVariableStorage.THIRD_PARTY_TOKEN ?? null;\n}\nexport function resetThirdPartyToken(): void {\n  SDKVariableStorage.THIRD_PARTY_TOKEN = undefined;\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { ERROR_CANNOT_REFRESH_THIRD_PARTY_TOKEN } from '../error/errorMessages';\nimport { postJSON } from '../utils/fetchJSON';\nimport { isNull } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { getAuthorizeUrl } from './getAuthorizeUrl';\nimport { handleNewThirdPartyToken } from './handleNewThirdPartyToken';\nimport { getThirdPartyToken } from './thirdPartyTokenStorage';\nimport { RefreshTokenResponse } from './TransactionToken';\n\nexport async function refreshThirdPartyToken(): Promise<void> {\n  const token = getThirdPartyToken();\n  if (isNull(token)) {\n    throw new ChatSDKError(ERROR_CANNOT_REFRESH_THIRD_PARTY_TOKEN);\n  }\n\n  const refreshUrl = getAuthorizeUrl(false);\n  try {\n    const { thirdParty } = await postJSON<RefreshTokenResponse>(\n      refreshUrl,\n      {\n        thirdParty: {\n          grant_type: 'refresh_token',\n          refresh_token: token.refresh_token,\n        },\n      },\n      {\n        credentials: 'include',\n        headers: {\n          ...SDKVariableStorage.REQUEST_METADATA?.httpHeaders,\n        },\n      },\n    );\n\n    if (!thirdParty) {\n      throw new ChatSDKError(ERROR_CANNOT_REFRESH_THIRD_PARTY_TOKEN);\n    }\n\n    return handleNewThirdPartyToken(thirdParty);\n  } catch (error) {\n    if (error instanceof ChatSDKError) {\n      throw error;\n    }\n\n    throw new ChatSDKError(ERROR_CANNOT_REFRESH_THIRD_PARTY_TOKEN, { error });\n  }\n}\n","import { handleRefreshToken } from '../authorization/handleRefreshToken';\n\nimport { refreshThirdPartyToken } from './refreshThirdPartyToken';\nimport { ThirdPartyToken } from './ThirdPartyToken';\nimport { setThirdPartyToken } from './thirdPartyTokenStorage';\n\nexport function handleNewThirdPartyToken(token: ThirdPartyToken): void {\n  setThirdPartyToken(token);\n  handleRefreshToken({ expiresIn: token.expires_in }, refreshThirdPartyToken);\n}\n","export class WebSocketClientError extends Error {\n  name: string = 'WebSocketClientError';\n\n  constructor(message: string, reason: string = '') {\n    const reasonMessage = reason ? ` (${reason})` : '';\n    super(`[WebSocketClientError]: ${message}${reasonMessage}`);\n  }\n}\n","import { WebSocketClient as PushUpdateWSClient } from '@brandembassy/push-updates-sdk';\n\nexport type IWsEventTarget = PushUpdateWSClient;\n\nexport const WsEventTarget = EventTarget as {\n  new (): IWsEventTarget;\n  prototype: IWsEventTarget;\n};\n","import {\n  WebSocketClient as PushUpdateWSClient,\n  WebSocketClientEvent as PushUpdatesWebSocketClientEvent,\n  setupSocketConnection,\n} from '@brandembassy/push-updates-sdk';\nimport { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\nimport { CustomerIdentityIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/endUser/EndUserIdentityId';\nimport { VisitorId } from '@brandembassy/ts-types-platform/dist/visitor/VisitorId';\n\nimport { ChatCustomEvent } from '../event/ChatEvent';\nimport { isSecureSessions } from '../securedSession/getSecuredSessionType';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { WebSocketClientError } from './WebSocketClientError';\nimport { IWsEventTarget, WsEventTarget } from './WsEventTarget';\n\nexport interface SocketQueryParameters {\n  [key: string]: string | number | undefined;\n  brandId: BrandId;\n  channelId: ChannelId;\n  consumerId: CustomerIdentityIdOnExternalPlatform;\n  token?: string;\n  visitorId: VisitorId;\n}\n\nconst MAX_SOCKET_RECONNECT_RETRIES = 20;\n\n/**\n * Websocket client\n */\nexport class WebSocketClient {\n  #connection: PushUpdateWSClient | null = null;\n  #eventTarget: IWsEventTarget;\n  #alreadyConnected: boolean = false;\n\n  constructor(\n    private onError: ((error: Error) => void) | undefined,\n    private socketURLGetter: () => Promise<string>,\n  ) {\n    this.#eventTarget = new WsEventTarget();\n  }\n\n  /**\n   * Connect websocket\n   */\n  async connect(): Promise<void> {\n    this.#setupConnection();\n\n    this.#connection?.socket?.reconnect();\n  }\n\n  /**\n   * Disconnect websocket\n   */\n  disconnect(): void {\n    this.#connection?.socket.close();\n  }\n\n  /**\n   * Reconnect websocket\n   */\n  reconnect(): void {\n    this.#setupConnection();\n    this.#connection?.socket.reconnect();\n  }\n\n  /**\n   * Send data to active connection\n   * @param data - data to send\n   */\n  send(data: unknown): void {\n    const stringData = JSON.stringify(data);\n    this.#connection?.send(stringData);\n  }\n\n  /**\n   * Register event handler to websocket event\n   * @param eventType - websocket event\n   * @param handlerCallback - event handler\n   */\n  on(\n    eventType: PushUpdatesWebSocketClientEvent,\n    handlerCallback: (event: ChatCustomEvent) => void,\n  ): void {\n    this.#eventTarget.addEventListener(eventType, handlerCallback);\n  }\n\n  /**\n   * Unregister event handler to websocket event\n   * @param eventType - websocket event\n   * @param handlerCallback - event handler\n   */\n  off(\n    eventType: PushUpdatesWebSocketClientEvent,\n    handlerCallback: (event: CustomEvent) => void,\n  ): void {\n    this.#eventTarget.removeEventListener(eventType, handlerCallback);\n  }\n\n  /**\n   * Handle error from event listeners with onError callback or throw error\n   */\n  private _errorHandler(\n    event: CustomEvent<CloseEvent | ErrorEvent | Event>,\n  ): void {\n    const eventError = event.detail;\n    let error: WebSocketClientError | undefined;\n\n    if (eventError instanceof ErrorEvent) {\n      error = new WebSocketClientError('Connection error', eventError.message);\n    }\n    if (eventError instanceof CloseEvent) {\n      error = new WebSocketClientError('Connection closed', eventError.reason);\n    }\n    if (typeof error === 'undefined') {\n      error = new WebSocketClientError('Unknown error', eventError.type);\n    }\n\n    if (typeof this.onError === 'function') {\n      this.onError(error);\n    } else {\n      throw error;\n    }\n  }\n\n  #setupConnection(): void {\n    // if secured session is ON; start the heartbeat right away because there is no authorization response from lambda\n    const heartbeatAfterAuthorize = !isSecureSessions();\n\n    const endpoint = SDKVariableStorage.ENDPOINT_GATEWAY ?? '';\n    const forceSecureProtocol = endpoint.startsWith('wss');\n\n    this.#connection = setupSocketConnection(this.socketURLGetter, {\n      forceSecureProtocol,\n      startClosed: true,\n      heartbeatAfterAuthorize,\n      maxRetries: 0, // Disable reconnection attempts on the initial connection to avoid retrying in case of an authorization error. Configure maxRetries later once the connection is successfully established.\n    });\n\n    const errorHandlerBound = this._errorHandler.bind(this);\n    this.#connection?.addEventListener(\n      PushUpdatesWebSocketClientEvent.CLOSE,\n      errorHandlerBound,\n    );\n    this.#connection?.addEventListener(\n      PushUpdatesWebSocketClientEvent.ERROR,\n      errorHandlerBound,\n    );\n\n    this.#connection?.addEventListener(\n      PushUpdatesWebSocketClientEvent.OPEN,\n      (event: CustomEvent<Event>) => {\n        this.#connection?.socket.setMaxRetires(MAX_SOCKET_RECONNECT_RETRIES);\n        this.#alreadyConnected = true;\n        this.#socketEventHandler(event);\n      },\n    );\n    this.#connection?.addEventListener(\n      PushUpdatesWebSocketClientEvent.CLOSE,\n      (event: CustomEvent<CloseEvent>) => {\n        if (!this.#alreadyConnected) {\n          // if the connection was not establish before close event.\n          // It is most probably because of the Authorization failed\n          this.#eventTarget.dispatchEvent(\n            new CustomEvent(\n              PushUpdatesWebSocketClientEvent.AUTHORIZATION_FAILED,\n            ),\n          );\n        }\n\n        this.#socketEventHandler(event);\n      },\n    );\n    this.#connection?.addEventListener(\n      PushUpdatesWebSocketClientEvent.MESSAGE,\n      this.#socketEventHandler,\n    );\n  }\n\n  #socketEventHandler = (\n    event: CustomEvent<CloseEvent | ErrorEvent | Event>,\n  ): void => {\n    this.#eventTarget.dispatchEvent(event);\n  };\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\n\nimport { UploadFailResponse } from './uploadAttachment';\n\ninterface UploadAttachmentErrorData {\n  response: UploadFailResponse;\n}\n\nexport class UploadAttachmentError extends ChatSDKError {\n  data: UploadAttachmentErrorData;\n\n  constructor(message: string, data: UploadAttachmentErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\nimport { AttachmentUpload } from '@brandembassy/ts-types-chat/dist/message/AttachmentUpload';\nimport { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\nimport { MessageType } from '@brandembassy/ts-types-platform/dist/message/MessageType';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { getBrowserFingerprint } from '../browserFingerprint/getBrowserFingerprint';\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { SendMessageOptions } from '../thread/SendMessageOptions';\nimport { generateId } from '../utils/generateId';\nimport { getBrandIdAndChannelId } from '../utils/getBrandIdAndChannelId';\n\nimport { createPayloadForAttachmentUpload } from './createPayloadForAttachmentUpload';\nimport {\n  isUploadFailResponse,\n  isUploadSuccessResponse,\n  uploadAttachment,\n} from './uploadAttachment';\nimport { UploadAttachmentError } from './UploadAttachmentError';\n\nexport const createAttachmentPayload = async (\n  file: File,\n  brandId: BrandId,\n  channelId: ChannelId,\n  abortSignal?: AbortSignal,\n): Promise<AttachmentUpload> => {\n  const attachment = await createPayloadForAttachmentUpload(file);\n  const uploadAttachmentResponse = await uploadAttachment(\n    brandId,\n    channelId,\n    attachment,\n    abortSignal,\n  );\n\n  if (isUploadSuccessResponse(uploadAttachmentResponse)) {\n    return {\n      url: uploadAttachmentResponse.fileUrl,\n      friendlyName: attachment.name,\n    };\n  }\n\n  if (isUploadFailResponse(uploadAttachmentResponse)) {\n    throw new UploadAttachmentError('Upload attachment failed', {\n      response: uploadAttachmentResponse,\n    });\n  }\n\n  throw new ChatSDKError(\n    `Unknown file upload response (${uploadAttachmentResponse})`,\n  );\n};\n\nexport const isAttachmentUpload = (\n  files: FileList | Array<File> | Array<AttachmentUpload>,\n): files is Array<AttachmentUpload> => {\n  const filesToTest: Array<File | AttachmentUpload> = Array.from<\n    File | AttachmentUpload\n  >(files);\n\n  return (filesToTest as Array<AttachmentUpload>).every(\n    (file) => 'url' in file && 'friendlyName' in file,\n  );\n};\n\nexport const createTemporaryAttachmentsUpload = async (\n  files: FileList | Array<File>,\n  brandId: BrandId,\n  channelId: ChannelId,\n  abortSignal?: AbortSignal,\n): Promise<Array<AttachmentUpload>> =>\n  Promise.all<AttachmentUpload>(\n    Array.from(files).map((file) =>\n      createAttachmentPayload(file, brandId, channelId, abortSignal),\n    ),\n  );\n\nexport const createAttachmentUploadMessageData = async (\n  files: FileList | Array<File> | Array<AttachmentUpload>,\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n  options: SendMessageOptions = {},\n): Promise<SendMessageEventData> => {\n  const { brandId, channelId } = getBrandIdAndChannelId();\n\n  try {\n    const attachments = isAttachmentUpload(files)\n      ? files\n      : await createTemporaryAttachmentsUpload(files, brandId, channelId);\n\n    const {\n      messageId = generateId(),\n      browserFingerprint = getBrowserFingerprint(),\n    } = options;\n\n    return {\n      messageContent: {\n        type: MessageType.TEXT,\n        payload: {\n          text: '',\n        },\n      },\n      attachments,\n      browserFingerprint,\n      thread: {\n        idOnExternalPlatform: threadIdOnExternalPlatform,\n      },\n      idOnExternalPlatform: messageId,\n      consumer: {\n        customFields: [],\n      },\n      consumerContact: {\n        customFields: [],\n      },\n    };\n  } catch (error: unknown) {\n    if (error instanceof UploadAttachmentError) {\n      throw error;\n    }\n\n    if (error instanceof Error) {\n      throw new ChatSDKError(\n        `Send attachment failed because of (${error.message})`,\n      );\n    }\n\n    throw new ChatSDKError(`Unknown error during file upload`);\n  }\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\n\nimport { createLocalFileReader } from './localFileReader';\n\nexport interface AttachmentPayload {\n  mimeType: string;\n  name: string;\n  url: string;\n}\n\nexport const createPayloadForAttachmentUpload = async (\n  file: File,\n): Promise<AttachmentPayload> => {\n  const reader = await createLocalFileReader(file);\n\n  if (reader.error !== null) {\n    throw new ChatSDKError(\n      `Cannot create payload for attachment upload because of error (${reader.error.message})`,\n    );\n  }\n\n  if (typeof reader.result !== 'string') {\n    throw new ChatSDKError(\n      `Cannot create payload for attachment upload because of missing:\n      reader result (${reader.result})`,\n    );\n  }\n\n  return {\n    url: reader.result,\n    name: file.name,\n    mimeType: file.type,\n  };\n};\n","export function createLocalFileReader(file: File): Promise<FileReader> {\n  return new Promise((resolve, reject): void => {\n    const reader = new FileReader();\n    reader.onloadend = (): void => {\n      resolve(reader);\n    };\n    reader.onerror = (errorEvent: ProgressEvent<FileReader>): void =>\n      reject(errorEvent.target?.error?.message);\n    reader.readAsDataURL(file);\n  });\n}\n","import { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\n\nimport { getDefaultHeaders } from '../request/defaultHeaders';\nimport { FetchOptions, postJSON } from '../utils/fetchJSON';\nimport { isUndefined } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { AttachmentPayload } from './createPayloadForAttachmentUpload';\n\nexport interface UploadSuccessResponse {\n  fileUrl: string;\n}\n\nexport interface UploadFailResponse {\n  allowedFileSize: string;\n  allowedFileTypes: Array<{\n    description: string;\n    mimeType: string;\n  }>;\n}\n\nexport function isUploadSuccessResponse(\n  data: unknown,\n): data is UploadSuccessResponse {\n  return isUndefined((data as UploadSuccessResponse)?.fileUrl) === false;\n}\n\nexport function isUploadFailResponse(\n  data: unknown,\n): data is UploadFailResponse {\n  return isUndefined((data as UploadFailResponse)?.allowedFileSize) === false;\n}\n\nexport async function uploadAttachment(\n  brandId: BrandId,\n  channelId: string,\n  attachment: AttachmentPayload,\n  abortSignal?: AbortSignal,\n): Promise<UploadSuccessResponse | UploadFailResponse> {\n  const { url, name: fileName, mimeType } = attachment;\n  const content = url.split(';base64,')[1];\n  const requestBody = { content, fileName, mimeType };\n  const headers = {\n    ...SDKVariableStorage.REQUEST_METADATA?.httpHeaders,\n  };\n\n  const resource = `${SDKVariableStorage.ENDPOINT_CHAT}/chat/1.0/brand/${brandId}/channel/${channelId}/attachment`;\n\n  const fetchOptions: FetchOptions = {\n    headers: {\n      ...getDefaultHeaders(headers, SDKVariableStorage.APP_NAME),\n    },\n    signal: abortSignal,\n  };\n\n  return postJSON(resource, requestBody, fetchOptions);\n}\n","import { CaseStatusChangedData } from '@brandembassy/ts-types-platform/dist/post/case/CaseStatusChangedEvent';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport type ContactStatusChangedData = CaseStatusChangedData;\n\nexport interface ContactStatusChangedChatEvent extends ChatEventData {\n  data: ContactStatusChangedData;\n  type: typeof ChatEvent.CONTACT_STATUS_CHANGED;\n}\n\nexport function isContactStatusChangedEvent(\n  event: ChatEventData,\n): event is ContactStatusChangedChatEvent {\n  return (\n    event.type === ChatEvent.CONTACT_STATUS_CHANGED &&\n    (event as ContactStatusChangedChatEvent).data?.case?.id !== undefined\n  );\n}\n","import { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nimport { ContactCreatedChatEvent } from './contactCreated';\n\nexport function isContactCreatedEvent(\n  event: ChatEventData,\n): event is ContactCreatedChatEvent {\n  return (\n    event.type === ChatEvent.CONTACT_CREATED &&\n    (event as ContactCreatedChatEvent).data?.case?.id !== undefined\n  );\n}\n","import { ContactToRoutingQueueAssignmentChangedData } from '@brandembassy/ts-types-platform/dist/post/case/CaseToRoutingQueueAssignmentChangedEvent';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport interface ContactToRoutingQueueAssignmentChangedChatEvent\n  extends ChatEventData {\n  data: ContactToRoutingQueueAssignmentChangedData;\n  type: typeof ChatEvent.CONTACT_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED;\n}\n\nexport function isContactToRoutingQueueAssignmentChangedEvent(\n  event: ChatEventData,\n): event is ContactToRoutingQueueAssignmentChangedChatEvent {\n  return (\n    event.type === ChatEvent.CONTACT_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED &&\n    (event as ContactToRoutingQueueAssignmentChangedChatEvent).data?.case\n      ?.id !== undefined\n  );\n}\n","import { ContactRecipientsChangedData } from '@brandembassy/ts-types-platform/dist/groupChat/ContactRecipientsChangedEvent';\nimport { PushUpdateEventType } from '@brandembassy/ts-types-platform/dist/pushUpdate/PushUpdateEventType';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface ContactRecipientsChangedChatEvent extends ChatEventData {\n  data: ContactRecipientsChangedData;\n  type: PushUpdateEventType.CONTACT_RECIPIENTS_CHANGED;\n}\n\nexport function isContactRecipientsChangedEvent(\n  event: unknown,\n): event is ContactRecipientsChangedChatEvent {\n  return (\n    (event as ContactRecipientsChangedChatEvent).type ===\n    PushUpdateEventType.CONTACT_RECIPIENTS_CHANGED\n  );\n}\n","import { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\nimport { BrowserFingerprint } from '@brandembassy/ts-types-chat/dist/user/BrowserFingerprint';\nimport { MessageId } from '@brandembassy/ts-types-platform/dist/message/MessageId';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { getBrowserFingerprint } from '../browserFingerprint/getBrowserFingerprint';\n\nexport type MessageContent = SendMessageEventData['messageContent'];\n\nexport const createMessageData = (\n  messageContent: MessageContent,\n  messageId: MessageId,\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n  browserFingerprint: BrowserFingerprint = getBrowserFingerprint(),\n): SendMessageEventData => ({\n  messageContent,\n  browserFingerprint,\n  idOnExternalPlatform: messageId,\n  thread: {\n    idOnExternalPlatform: threadIdOnExternalPlatform,\n  },\n  consumer: {\n    customFields: [],\n  },\n  consumerContact: {\n    customFields: [],\n  },\n  attachments: [],\n});\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { MoreMessagesLoadedPostbackData } from '@brandembassy/ts-types-chat/dist/awsEvents/MoreMessagesLoaded';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface MoreMessagesLoadedEvent extends ChatEventData {\n  data: MoreMessagesLoadedPostbackData;\n}\n\nexport function isLoadMoreMessagesEventData(\n  event: ChatEventData,\n): event is MoreMessagesLoadedEvent {\n  return (\n    (event as MoreMessagesLoadedEvent).type ===\n      AwsResponseEventType.MORE_MESSAGES_LOADED &&\n    (event as MoreMessagesLoadedEvent)?.data?.messages !== undefined\n  );\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { LoadMoreMessagesEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/LoadMoreMessages';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport const createLoadMoreMessagesPayloadData = (\n  eventData: LoadMoreMessagesEventData,\n): EventPayloadData<LoadMoreMessagesEventData> => ({\n  eventType: AwsInputEventType.LOAD_MORE_MESSAGES,\n  data: eventData,\n});\n","import { AbortError } from '../error/AbortError';\n\nexport interface Abortable {\n  abort: (reason?: string) => void;\n  readonly abortReason?: string;\n}\n\ntype ExecutorFunction<T> = (\n  resolve: (value: PromiseLike<T> | T) => void,\n  reject: (reason?: unknown) => void,\n) => void;\n\ntype AbortableExecutorFunction<T> = (\n  resolve: (value: PromiseLike<T> | T) => void,\n  reject: (reason?: unknown) => void,\n  abortSignal: AbortSignal,\n) => void;\n\n/**\n * AbortablePromise is a Promise that can be aborted.\n * Source: https://github.com/zzdjk6/simple-abortable-promise, MIT License\n */\nexport class AbortablePromise<T> extends Promise<T> implements Abortable {\n  public abort: Abortable['abort'];\n\n  constructor(executor: AbortableExecutorFunction<T>) {\n    const abortController = new AbortController();\n    const abortSignal = abortController.signal;\n\n    const normalExecutor: ExecutorFunction<T> = (resolve, reject) => {\n      abortSignal.addEventListener('abort', () => {\n        reject(new AbortError(this.abortReason));\n      });\n\n      executor?.(resolve, reject, abortSignal);\n    };\n\n    super(normalExecutor);\n    this.abort = (reason) => {\n      this._abortReason = reason ?? 'Aborted';\n      abortController.abort();\n    };\n  }\n\n  private _abortReason?: string;\n\n  public get abortReason(): string | undefined {\n    return this._abortReason;\n  }\n\n  static from = <P>(promise: Promise<P>): AbortablePromise<P> => {\n    // If promise is already an AbortablePromise, return it directly\n    if (promise instanceof AbortablePromise) {\n      return promise;\n    }\n\n    return new AbortablePromise<P>((resolve, reject) => {\n      promise.then(resolve).catch(reject);\n    });\n  };\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\n\ninterface ArchiveThreadFailedErrorData {\n  response: unknown;\n}\n\nexport class ArchiveThreadFailedError extends ChatSDKError {\n  data: ArchiveThreadFailedErrorData;\n\n  constructor(message: string, data: ArchiveThreadFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\n\ninterface GetMetadataFailedErrorData {\n  response: unknown;\n}\n\nexport class GetMetadataFailedError extends ChatSDKError {\n  data: GetMetadataFailedErrorData;\n\n  constructor(message: string, data: GetMetadataFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { ThreadMetadataLoadedPostbackData } from '@brandembassy/ts-types-chat/dist/awsEvents/ThreadMetadataLoaded';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface LoadThreadMetadataChatEvent extends ChatEventData {\n  data: ThreadMetadataLoadedPostbackData;\n  type: AwsResponseEventType.THREAD_METADATA_LOADED;\n}\n\nexport const isLoadMetadataSuccessPayload = (\n  response: ChatEventData,\n): response is LoadThreadMetadataChatEvent =>\n  (response as LoadThreadMetadataChatEvent).type ===\n    AwsResponseEventType.THREAD_METADATA_LOADED &&\n  (response as LoadThreadMetadataChatEvent).data.lastMessage !== undefined;\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\n\nimport { ChatEventData } from '../event/ChatEvent';\nimport { isNil } from '../utils/is';\n\nimport { ThreadRecoveredData } from './ThreadRecoveredData';\n\nexport interface ThreadRecoveredChatEvent extends ChatEventData {\n  data: ThreadRecoveredData;\n}\n\nexport const isRecoverSuccessPayload = (\n  response: ChatEventData,\n): response is ThreadRecoveredChatEvent => {\n  const testResponseData = response.data as ThreadRecoveredData;\n\n  const hasPostbackData = isNil(testResponseData) === false;\n  if (hasPostbackData === false) {\n    return false;\n  }\n\n  const hasMessages = isNil(testResponseData?.messages) === false;\n  if (hasMessages === false) {\n    return false;\n  }\n\n  const isCorrectEventType =\n    response.type === AwsResponseEventType.THREAD_RECOVERED ||\n    response.type === AwsResponseEventType.LIVECHAT_RECOVERED;\n  if (isCorrectEventType === false) {\n    return false;\n  }\n\n  const hasNoError = isNil(response.error);\n  if (hasNoError === false) {\n    return false;\n  }\n\n  const hasThreadId = isNil(testResponseData?.thread) === false;\n  if (hasThreadId === false) {\n    return false;\n  }\n\n  return true;\n};\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\n\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface ThreadArchivedEvent extends ChatEventData {\n  type: AwsResponseEventType.THREAD_ARCHIVED;\n}\n\nexport function isThreadArchivedSuccessPayload(\n  response: ChatEventData,\n): response is ThreadArchivedEvent {\n  return (\n    (response as ThreadArchivedEvent).type ===\n    AwsResponseEventType.THREAD_ARCHIVED\n  );\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\n\ninterface LoadMoreMessagesFailedErrorData {\n  response: unknown;\n}\n\nexport class LoadMoreMessagesFailedError extends ChatSDKError {\n  data: LoadMoreMessagesFailedErrorData;\n\n  constructor(message: string, data: LoadMoreMessagesFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { RecoverThreadEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/RecoverThread';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createRecoverThreadPayloadData(\n  threadIdOnExternalPlatform?: ThreadIdOnExternalPlatform,\n): EventPayloadData<RecoverThreadEventData> {\n  const emptyData = {\n    eventType: AwsInputEventType.RECOVER_THREAD,\n    data: {},\n  };\n\n  if (!threadIdOnExternalPlatform) {\n    return emptyData;\n  }\n\n  return {\n    ...emptyData,\n    data: {\n      thread: { idOnExternalPlatform: threadIdOnExternalPlatform },\n    },\n  };\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\n\ninterface SetThreadNameFailedErrorData {\n  response: unknown;\n}\n\nexport class SetThreadNameFailedError extends ChatSDKError {\n  data: SetThreadNameFailedErrorData;\n\n  constructor(message: string, data: SetThreadNameFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { ChatEventData } from '../event/ChatEvent';\n\ninterface ThreadRecoverFailedErrorData {\n  response: ChatEventData;\n}\n\nexport class ThreadRecoverFailedError extends ChatSDKError {\n  data: ThreadRecoverFailedErrorData;\n\n  constructor(message: string, data: ThreadRecoverFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { LoadMoreMessagesEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/LoadMoreMessages';\nimport { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\nimport { SendOutboundEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendOutbound';\nimport { AttachmentUpload } from '@brandembassy/ts-types-chat/dist/message/AttachmentUpload';\nimport { ContactNumber } from '@brandembassy/ts-types-platform/dist/contact/ContactNumber';\nimport { ContactStatus } from '@brandembassy/ts-types-platform/dist/contact/ContactStatus';\nimport { CustomField } from '@brandembassy/ts-types-platform/dist/customField/CustomField';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { createAttachmentUploadMessageData } from '../attachment/sendAttachments';\nimport { getAccessToken } from '../authorization/accessTokenStorage';\nimport { getBrowserFingerprint } from '../browserFingerprint/getBrowserFingerprint';\nimport { isContactStatusChangedEvent } from '../contact';\nimport { Customer } from '../customer/Customer';\nimport {\n  CustomFieldsMap,\n  CustomFieldsObject,\n  getCustomFieldsArray,\n  removeCustomField,\n  setCustomFields,\n  setCustomFieldsFromArray,\n} from '../customField/CustomFields';\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport {\n  ChatCustomEvent,\n  ChatEvent,\n  ChatEventData,\n  ChatEventType,\n} from '../event/ChatEvent';\nimport { IChatEventTarget } from '../event/ChatEventTarget';\nimport {\n  EventListenerFunction,\n  RemoveListenerFunction,\n} from '../event/ListenerFunction';\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { createMessageData } from '../message/createMessageData';\nimport { getPostbackMessageContent } from '../message/getPostbackMessageContent';\nimport { getTextMessageContent } from '../message/getTextMessageContent';\nimport {\n  isLoadMoreMessagesEventData,\n  MoreMessagesLoadedEvent,\n} from '../message/loadMoreMessagesEventData';\nimport { createLoadMoreMessagesPayloadData } from '../message/loadMoreMessagesPayload';\nimport { MessageSuccessEventData } from '../message/MessageSuccessEventData';\nimport { sendMessage } from '../message/sendMessage';\nimport { createSendMessagePreviewPayloadData } from '../message/sendMessagePreviewPayload';\nimport { sendOutboundMessage } from '../message/sendOutboundMessage';\nimport { getThirdPartyToken } from '../securedSession/thirdPartyTokenStorage';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\nimport { AbortablePromise } from '../utils/AbortablePromise';\nimport { generateId } from '../utils/generateId';\nimport { isEmpty, isUndefined } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { createArchiveThreadEventPayloadData } from './archiveThread';\nimport { ArchiveThreadFailedError } from './ArchiveThreadFailedError';\nimport { assertNonEmptyTextMessageContent } from './assertNonEmptyTextMessageContent';\nimport { GetMetadataFailedError } from './GetMetadataFailedError';\nimport {\n  isLoadMetadataSuccessPayload,\n  LoadThreadMetadataChatEvent,\n} from './isLoadMetadataSuccessPayload';\nimport { isRecoverSuccessPayload } from './isRecoverSuccessPayload';\nimport { isThreadArchivedSuccessPayload } from './isThreadArchivedSuccessPayload';\nimport { createLastMessageSeenPayloadData } from './lastMessageSeenPayload';\nimport { LoadMoreMessagesFailedError } from './LoadMoreMessagesFailedError';\nimport { createLoadThreadMetadataEventPayloadData } from './metadata';\nimport { createRecoverThreadPayloadData } from './recoverThreadPayload';\nimport { SendMessageOptions } from './SendMessageOptions';\nimport { createSetThreadCustomFieldsPayloadData } from './setThreadCustomFieldsPayload';\nimport { SetThreadNameFailedError } from './SetThreadNameFailedError';\nimport { filterCurrentThreadEventHandler } from './threadEventHandler';\nimport { ThreadRecoveredData } from './ThreadRecoveredData';\nimport { ThreadRecoverFailedError } from './ThreadRecoverFailedError';\nimport { createSendTranscriptPayloadData } from './transcript';\nimport {\n  createStartTypingEventPayloadData,\n  createStopTypingEventPayloadData,\n} from './typingEvents';\nimport {\n  createUpdateThreadPayloadData,\n  isUpdateThreadSuccess,\n} from './updateThread';\n\nexport class Thread {\n  public idOnExternalPlatform: ThreadIdOnExternalPlatform;\n\n  protected _websocketClient: WebSocketClient;\n  protected _existsOnPlatform: boolean = false;\n\n  protected _messageEmitter: IChatEventTarget;\n  protected _typingTimeoutID: ReturnType<typeof setTimeout> | undefined =\n    undefined;\n  protected _isAuthorizationEnabled: boolean = false;\n  protected _customer: Customer | null;\n  protected _customFields: CustomFieldsMap = new Map();\n\n  private _typingForPreviewTimeoutID: ReturnType<typeof setTimeout> | undefined;\n  private _typingPreviewText: string = '';\n\n  constructor(\n    idOnExternalPlatform: ThreadIdOnExternalPlatform,\n    websocketClient: WebSocketClient,\n    messageEmitter: IChatEventTarget,\n    customer: Customer | null,\n    customFields: CustomFieldsObject = {},\n    isAuthorizationEnabled: boolean = false,\n  ) {\n    this.idOnExternalPlatform = idOnExternalPlatform;\n    this._websocketClient = websocketClient;\n    this._messageEmitter = messageEmitter;\n    this._customer = customer;\n    this._isAuthorizationEnabled = isAuthorizationEnabled;\n    this._existsOnPlatform = false;\n\n    setCustomFields(this._customFields, customFields);\n    this._registerEventHandlers();\n  }\n\n  /**\n   * Recover existing chat\n   * @returns AbortablePromise<ThreadRecoveredData>\n   * @throws ThreadRecoverFailedError\n   *  * This exception is thrown when the recover fails or the thread does not exist.\n   */\n  public recover(): AbortablePromise<ThreadRecoveredData> {\n    return new AbortablePromise(async (resolve, reject) => {\n      const response = await sendChatEvent(\n        createRecoverThreadPayloadData(this.idOnExternalPlatform),\n        this._websocketClient,\n      );\n\n      if (isRecoverSuccessPayload(response)) {\n        resolve(response.data);\n      } else {\n        reject(new ThreadRecoverFailedError('Thread not found', { response }));\n      }\n    });\n  }\n\n  /**\n   * Send message\n   * @param messageData - message data\n   * @throws SendMessageFailedError\n   *  * This exception is thrown when a message fails to send. The error can contain (`error.data`) a response from the backend with details.\n   */\n  public async sendMessage(\n    messageData: SendMessageEventData,\n  ): Promise<MessageSuccessEventData> {\n    assertNonEmptyTextMessageContent(messageData);\n\n    const messageDataWithCustomFields =\n      this._mergeCustomFieldsAndAccessTokenWithMessageData(messageData, false);\n\n    return sendMessage(messageDataWithCustomFields, this._websocketClient);\n  }\n\n  /**\n   * Send text message\n   * @param messageText - text of message\n   * @param options - options\n   */\n  public async sendTextMessage(\n    messageText: string,\n    options: SendMessageOptions = {},\n  ): Promise<MessageSuccessEventData> {\n    const {\n      messageId = generateId(),\n      browserFingerprint = getBrowserFingerprint(),\n    } = options;\n\n    const textMessageContent = getTextMessageContent(messageText);\n    const messageData = createMessageData(\n      textMessageContent,\n      messageId,\n      this.idOnExternalPlatform,\n      browserFingerprint,\n    );\n\n    return this.sendMessage(messageData);\n  }\n\n  /**\n   * Send postback message\n   * @param postback - postback\n   * @param messageText - text of message\n   * @param options - options\n   */\n  public async sendPostbackMessage(\n    postback: string,\n    messageText: string,\n    options: SendMessageOptions = {},\n  ): Promise<MessageSuccessEventData> {\n    const {\n      messageId = generateId(),\n      browserFingerprint = getBrowserFingerprint(),\n    } = options;\n\n    const postbackMessageContent = getPostbackMessageContent(\n      postback,\n      messageText,\n    );\n    const messageData = createMessageData(\n      postbackMessageContent,\n      messageId,\n      this.idOnExternalPlatform,\n      browserFingerprint,\n    );\n\n    return this.sendMessage(messageData);\n  }\n\n  /**\n   * Send Outbound Message\n   * @param messageData - message data\n   * @throws SendMessageFailedError\n   *  * This exception is thrown when a message fails to send. The error contains (`error.data`) a response from the backend with details.\n   */\n  public async sendOutboundMessage(\n    messageData: SendOutboundEventData,\n  ): Promise<MessageSuccessEventData> {\n    const outboundEventDataWithCustomFields =\n      this._mergeCustomFieldsAndAccessTokenWithMessageData(messageData, true);\n\n    return sendOutboundMessage(\n      outboundEventDataWithCustomFields,\n      this._websocketClient,\n    );\n  }\n\n  /**\n   * Load previous messages\n   * @returns Promise MoreMessagesLoadedEvent | null\n   * @throws LoadMoreMessagesFailedError\n   *  * This exception is thrown when the attempt to load more messages fails.\n   */\n  public async loadMoreMessages(): Promise<MoreMessagesLoadedEvent | null> {\n    const { scrollToken, oldestMessageDatetime } =\n      SDKVariableStorage.THREAD_DATA ?? {};\n\n    if (isEmpty(scrollToken)) {\n      return null;\n    }\n\n    const loadMoreMessagesEventData: LoadMoreMessagesEventData = {\n      scrollToken: String(scrollToken),\n      // @ts-expect-error oldestMessageDatetime is missing in type definition\n      oldestMessageDatetime,\n      thread: { idOnExternalPlatform: this.idOnExternalPlatform },\n    };\n\n    const response = await sendChatEvent(\n      createLoadMoreMessagesPayloadData(loadMoreMessagesEventData),\n      this._websocketClient,\n    );\n\n    if (isLoadMoreMessagesEventData(response)) {\n      return response;\n    }\n\n    throw new LoadMoreMessagesFailedError('Load more messages failed', {\n      response,\n    });\n  }\n\n  /**\n   * Mark all messages in the thread as seen\n   */\n  public async lastMessageSeen(): Promise<ChatEventData> {\n    const payloadData = createLastMessageSeenPayloadData(\n      this.idOnExternalPlatform,\n    );\n\n    return sendChatEvent(payloadData, this._websocketClient);\n  }\n\n  /**\n   * Send attachment\n   *\n   * Raw function to send attachments\n   * @param files - An object of this type is returned by the files' property of the HTML <input> element; this lets you access the list of files selected with the <input type=\"file\"> element.\n   * @param options - options\n   * @throws UploadAttachmentError\n   *  * This exception is thrown when the file upload fails. The `error.data` contains information about allowed file size and types.\n   */\n  public async sendAttachments(\n    files: FileList | Array<File> | Array<AttachmentUpload>,\n    options: SendMessageOptions = {},\n  ): Promise<MessageSuccessEventData> {\n    if (isUndefined(files) || files.length === 0) {\n      throw new ChatSDKError(\n        'FileList must be provided to sendAttachment method',\n      );\n    }\n\n    const messageData = await createAttachmentUploadMessageData(\n      files,\n      this.idOnExternalPlatform,\n      options,\n    );\n\n    return this.sendMessage(messageData);\n  }\n\n  /**\n   * Send start and stop typing events. It sends stop typing event after the timeout. Repeated calls resets this timeout.\n   * @param timeout - The timeout in milliseconds.\n   * @param onSendCallback - Callback to be called after the stop typing event is sent.\n   */\n  public keystroke(timeout = 1000, onSendCallback?: () => void): void {\n    if (!this._existsOnPlatform) {\n      return;\n    }\n\n    if (!this._typingTimeoutID) {\n      sendChatEvent(\n        createStartTypingEventPayloadData(this.idOnExternalPlatform),\n        this._websocketClient,\n      );\n    }\n\n    clearTimeout(this._typingTimeoutID);\n    this._typingTimeoutID = setTimeout(() => {\n      this._stopTypingCallback(onSendCallback);\n    }, timeout);\n  }\n\n  /**\n   * Manually send the stop typing event and clear the keystroke timeout.\n   */\n  public stopTyping(): void {\n    this._stopTypingCallback();\n  }\n\n  private _stopTypingCallback(onSendCallback?: () => void): void {\n    if (!this._typingTimeoutID) {\n      return;\n    }\n\n    clearTimeout(this._typingTimeoutID);\n    this._typingTimeoutID = undefined;\n    sendChatEvent(\n      createStopTypingEventPayloadData(this.idOnExternalPlatform),\n      this._websocketClient,\n    );\n    if (typeof onSendCallback === 'function') {\n      onSendCallback();\n    }\n  }\n\n  /**\n   * Send typing event for message preview after the timeout.\n   * @param currentText - current text\n   * @param timeout - timeout in milliseconds\n   * @returns void\n   *\n   */\n  keystrokeForPreview(currentText: string, timeout = 1250): void {\n    this._typingPreviewText = currentText;\n    if (this._typingForPreviewTimeoutID) {\n      return;\n    }\n\n    this._typingForPreviewTimeoutID = setTimeout(() => {\n      this.stopTypingForPreview();\n    }, timeout);\n  }\n\n  /**\n   * Manually send the stop typing event for message preview and clear the keystroke timeout.\n   * @param shouldSendPreview - should send preview\n   * @returns void\n   *\n   */\n  stopTypingForPreview(shouldSendPreview = true): void {\n    clearTimeout(this._typingForPreviewTimeoutID);\n    this._typingForPreviewTimeoutID = undefined;\n    const currentPreviewText = this._typingPreviewText;\n    this._typingPreviewText = '';\n\n    if (shouldSendPreview === false) {\n      return;\n    }\n    this.sendMessagePreview(currentPreviewText);\n  }\n\n  /**\n   * Get Thread Metadata\n   * @returns response otherwise throw an error response\n   * @throws GetMetadataFailedError\n   *  * This exception is thrown when getting thread metadata failed.\n   */\n  public async getMetadata(): Promise<LoadThreadMetadataChatEvent> {\n    const response = await sendChatEvent(\n      createLoadThreadMetadataEventPayloadData(this.idOnExternalPlatform),\n      this._websocketClient,\n    );\n\n    if (isLoadMetadataSuccessPayload(response)) {\n      return response;\n    }\n\n    throw new GetMetadataFailedError('Get metadata failed', { response });\n  }\n\n  public onThreadEvent(\n    type: ChatEventType,\n    handler: EventListenerFunction,\n  ): RemoveListenerFunction {\n    const filteredEventHandler = filterCurrentThreadEventHandler(\n      this.idOnExternalPlatform,\n      handler,\n    );\n\n    this._messageEmitter.addEventListener(type, filteredEventHandler);\n\n    return () => {\n      this._messageEmitter.removeEventListener(type, filteredEventHandler);\n    };\n  }\n\n  /**\n   * Send current Custom Fields\n   * @param selectedFieldIdents - it will send only custom fields with these IDs, if provided. Otherwise, it will send all custom fields.\n   */\n  public async sendCustomFields(\n    selectedFieldIdents?: Array<CustomField['ident']>,\n  ): Promise<ChatEventData> {\n    const customFieldsArray = getCustomFieldsArray(this._customFields).filter(\n      (customField) => {\n        if (selectedFieldIdents) {\n          return selectedFieldIdents.includes(customField.ident);\n        }\n\n        return true;\n      },\n    );\n\n    const customFieldsData = createSetThreadCustomFieldsPayloadData(\n      customFieldsArray,\n      this.idOnExternalPlatform,\n    );\n\n    return sendChatEvent(customFieldsData, this._websocketClient);\n  }\n\n  /**\n   * Set thread custom fields and send them\n   * @param customFields - custom fields object\n   * @example \\{ ident: 'value' \\}\n   */\n  public async setCustomFields(\n    customFields: CustomFieldsObject,\n  ): Promise<void> {\n    setCustomFields(this._customFields, customFields);\n\n    if (!this._existsOnPlatform) {\n      return;\n    }\n\n    await this.sendCustomFields(Object.keys(customFields));\n  }\n\n  /**\n   * Remove thread custom fields\n   * @param ident - custom field ident\n   */\n  public removeCustomField(ident: CustomField['ident']): void {\n    removeCustomField(this._customFields, ident);\n  }\n\n  /**\n   * Set thread custom field\n   * @param ident - custom field name\n   * @param value - custom field value\n   */\n  public setCustomField(\n    ident: CustomField['ident'],\n    value: CustomField['value'],\n  ): Promise<void> {\n    return this.setCustomFields({ [ident]: value });\n  }\n\n  /**\n   * Set thread as archived\n   * @returns Promise true\n   * @throws ArchiveThreadFailedError\n   *  * This exception is thrown when the archive thread failed.\n   */\n  public async archive(): Promise<true> {\n    const response = await sendChatEvent(\n      createArchiveThreadEventPayloadData(this.idOnExternalPlatform),\n      this._websocketClient,\n    );\n\n    if (isThreadArchivedSuccessPayload(response)) {\n      return true;\n    }\n\n    throw new ArchiveThreadFailedError('Archive Thread failed', { response });\n  }\n\n  /**\n   * Set thread name\n   * @param name - New name of the Thread\n   * @returns Promise true\n   * @throws SetThreadNameFailedError\n   *  * This exception is thrown when the set thread name failed.\n   */\n  public async setName(name: string): Promise<true> {\n    const updateThreadData = createUpdateThreadPayloadData(\n      this.idOnExternalPlatform,\n      name,\n    );\n\n    const response = await sendChatEvent(\n      updateThreadData,\n      this._websocketClient,\n    );\n\n    if (isUpdateThreadSuccess(response)) {\n      return true;\n    }\n\n    throw new SetThreadNameFailedError('Set Thread name failed', { response });\n  }\n\n  /**\n   * Send message preview\n   * @param text - text\n   */\n  public async sendMessagePreview(text: string): Promise<void> {\n    const payloadData = createSendMessagePreviewPayloadData(\n      this.idOnExternalPlatform,\n      text,\n    );\n\n    if (!this._existsOnPlatform) {\n      return;\n    }\n\n    await sendChatEvent(payloadData, this._websocketClient);\n  }\n\n  /**\n   * Send conversation transcript to email\n   */\n  public async sendTranscript(\n    contactNumber: ContactNumber,\n    email: string,\n  ): Promise<ChatEventData> {\n    const payloadData = createSendTranscriptPayloadData(contactNumber, email);\n\n    return sendChatEvent(payloadData, this._websocketClient);\n  }\n\n  protected _setExistsOnPlatform(value: boolean): void {\n    this._existsOnPlatform = value;\n  }\n\n  protected _setExistsOnPlatformBasedOnContactStatus(\n    event: ChatCustomEvent,\n  ): void {\n    const eventDetail = event.detail;\n\n    if (isRecoverSuccessPayload(eventDetail)) {\n      this._setExistsOnPlatform(\n        eventDetail.data.contact.status !== ContactStatus.CLOSED,\n      );\n    }\n  }\n\n  protected _setCustomerExists(): void {\n    this._customer?.setExists(true);\n  }\n\n  protected _clearCustomFieldsOnContactStatusChangedToClosed(\n    event: ChatCustomEvent,\n  ): void {\n    const eventDetail = event.detail;\n\n    if (!isContactStatusChangedEvent(eventDetail)) {\n      return;\n    }\n\n    if (eventDetail.data.case.status === ContactStatus.CLOSED) {\n      // Delete custom fields after contact closure to prevent sending custom fields from previous contact.\n      this._customFields.clear();\n      this._setExistsOnPlatform(false);\n    }\n  }\n\n  private _mergeCustomFieldsWithMessageData<\n    T extends SendMessageEventData | SendOutboundEventData,\n  >(messageData: T, isOutbound: boolean): T {\n    if (this._existsOnPlatform) {\n      // Do not send custom fields with a message to an existing contact.\n      // They will be sent in a separate event.\n      return {\n        ...messageData,\n        consumer: { customFields: [] },\n        consumerContact: { customFields: [] },\n      };\n    }\n\n    // Update Thread (Contact) custom fields\n    setCustomFieldsFromArray(\n      this._customFields,\n      messageData.consumerContact.customFields,\n    );\n\n    const consumerContact = {\n      customFields: getCustomFieldsArray(this._customFields),\n    };\n\n    // Update Customer custom fields\n    let consumer;\n    if (!isOutbound) {\n      this._customer?.setCustomFieldsFromArray(\n        (messageData as SendMessageEventData).consumer?.customFields ?? [],\n      );\n      consumer = {\n        customFields: this._customer?.getCustomFieldsArray() ?? [],\n      };\n    }\n\n    return {\n      ...messageData,\n      consumer,\n      consumerContact,\n    };\n  }\n\n  private _mergeAccessTokenWithMessageData<\n    T extends SendMessageEventData | SendOutboundEventData,\n  >(messageData: T): T {\n    // Access token\n    let accessToken;\n\n    const storedThirdPartyToken = getThirdPartyToken();\n    const storedAccessToken = getAccessToken();\n\n    if (\n      this._isAuthorizationEnabled &&\n      (storedThirdPartyToken || storedAccessToken)\n    ) {\n      accessToken = {\n        token: storedThirdPartyToken?.access_token ?? storedAccessToken?.token,\n      };\n    }\n\n    return {\n      ...messageData,\n      accessToken,\n    };\n  }\n\n  private _mergeCustomFieldsAndAccessTokenWithMessageData<\n    T extends SendMessageEventData | SendOutboundEventData,\n  >(messageData: T, isOutbound: boolean): T {\n    const messageDataWithCustomFields = this._mergeCustomFieldsWithMessageData(\n      messageData,\n      isOutbound,\n    );\n\n    return this._mergeAccessTokenWithMessageData(messageDataWithCustomFields);\n  }\n\n  private _registerEventHandlers() {\n    this.onThreadEvent(ChatEvent.CASE_CREATED, () => {\n      this._setCustomerExists();\n      this._setExistsOnPlatform(true);\n    });\n    this.onThreadEvent(ChatEvent.CONTACT_CREATED, () => {\n      this._setCustomerExists();\n      this._setExistsOnPlatform(true);\n    });\n    this.onThreadEvent(ChatEvent.THREAD_RECOVERED, (event) => {\n      this._setExistsOnPlatformBasedOnContactStatus(event);\n      this._setCustomerExists();\n    });\n    this.onThreadEvent(ChatEvent.CONTACT_STATUS_CHANGED, (event) =>\n      this._clearCustomFieldsOnContactStatusChangedToClosed(event),\n    );\n  }\n}\n","import { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\nimport { MessageType } from '@brandembassy/ts-types-platform/dist/message/MessageType';\n\nimport { SendMessageFailedError } from '../message';\nimport { isEmpty } from '../utils/is';\n\nexport function assertNonEmptyTextMessageContent(\n  messageData: SendMessageEventData,\n): void {\n  if (messageData.messageContent.type !== MessageType.TEXT) {\n    return;\n  }\n\n  if (messageData.attachments.length > 0) {\n    return;\n  }\n\n  if (isEmpty(messageData.messageContent.payload.text) === false) {\n    return;\n  }\n\n  throw new SendMessageFailedError(\n    'Message content cannot be empty for text message',\n  );\n}\n","import { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\n\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport {\n  isSendMessageSuccessEventData,\n  MessageSuccessEventData,\n} from './MessageSuccessEventData';\nimport { SendMessageFailedError } from './SendMessageFailedError';\nimport { createSendMessagePayloadData } from './sendMessagePayload';\n\nexport const sendMessage = async (\n  messageData: SendMessageEventData,\n  websocketClient: WebSocketClient | null,\n): Promise<MessageSuccessEventData> => {\n  const sendMessagePayloadData = createSendMessagePayloadData(messageData);\n\n  const response = await sendChatEvent(sendMessagePayloadData, websocketClient);\n\n  if (isSendMessageSuccessEventData(response)) {\n    return response;\n  }\n\n  throw new SendMessageFailedError('Send message failed', { response });\n};\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport const createSendMessagePayloadData = (\n  eventData: SendMessageEventData,\n): EventPayloadData<SendMessageEventData> => ({\n  eventType: AwsInputEventType.SEND_MESSAGE,\n  data: eventData,\n});\n","import { MessageType } from '@brandembassy/ts-types-platform/dist/message/MessageType';\n\nimport { MessageContent } from './createMessageData';\n\nexport function getTextMessageContent(messageText: string): MessageContent {\n  return {\n    payload: {\n      text: messageText,\n    },\n    type: MessageType.TEXT,\n  };\n}\n","import { MessageType } from '@brandembassy/ts-types-platform/dist/message/MessageType';\n\nimport { MessageContent } from './createMessageData';\n\nexport function getPostbackMessageContent(\n  postback: string,\n  messageText: string,\n): MessageContent {\n  return {\n    payload: {\n      text: messageText,\n      postback, // Leaving this here for backwards compatibility\n    },\n    postback,\n    type: MessageType.TEXT, // MessageType.POSTBACK is deprecated\n  };\n}\n","import { SendOutboundEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendOutbound';\n\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport {\n  isSendMessageSuccessEventData,\n  MessageSuccessEventData,\n} from './MessageSuccessEventData';\nimport { SendMessageFailedError } from './SendMessageFailedError';\nimport { createSendOutboundMessagePayloadData } from './sendOutboundMessagePayload';\n\nexport const sendOutboundMessage = async (\n  messageData: SendOutboundEventData,\n  websocketClient: WebSocketClient | null,\n): Promise<MessageSuccessEventData> => {\n  const sendOutboundMessagePayloadData =\n    createSendOutboundMessagePayloadData(messageData);\n\n  const response = await sendChatEvent(\n    sendOutboundMessagePayloadData,\n    websocketClient,\n  );\n\n  if (isSendMessageSuccessEventData(response)) {\n    return response;\n  }\n\n  throw new SendMessageFailedError('Send Outbound message failed', response);\n};\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SendOutboundEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendOutbound';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport const createSendOutboundMessagePayloadData = (\n  eventData: SendOutboundEventData,\n): EventPayloadData<SendOutboundEventData> => ({\n  eventType: AwsInputEventType.SEND_OUTBOUND,\n  data: eventData,\n});\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { MessageSeenByConsumerEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/MessageSeenByConsumer';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createLastMessageSeenPayloadData(\n  threadIdOnExternalPlatform: string,\n): EventPayloadData<MessageSeenByConsumerEventData> {\n  return {\n    eventType: AwsInputEventType.MESSAGE_SEEN,\n    data: {\n      thread: { idOnExternalPlatform: threadIdOnExternalPlatform },\n    },\n  };\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SenderTypingEndedEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SenderTypingEnded';\nimport { SenderTypingStartedEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SenderTypingStarted';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createStartTypingEventPayloadData(\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n): EventPayloadData<SenderTypingStartedEventData> {\n  return {\n    eventType: AwsInputEventType.SENDER_TYPING_STARTED,\n    data: {\n      thread: {\n        idOnExternalPlatform: threadIdOnExternalPlatform,\n      },\n    },\n  };\n}\n\nexport function createStopTypingEventPayloadData(\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n): EventPayloadData<SenderTypingEndedEventData> {\n  return {\n    eventType: AwsInputEventType.SENDER_TYPING_ENDED,\n    data: {\n      thread: {\n        idOnExternalPlatform: threadIdOnExternalPlatform,\n      },\n    },\n  };\n}\n","import { ArchiveThreadEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/ArchiveThread';\nimport { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createLoadThreadMetadataEventPayloadData(\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n): EventPayloadData<ArchiveThreadEventData> {\n  return {\n    eventType: AwsInputEventType.LOAD_THREAD_METADATA,\n    data: {\n      thread: {\n        idOnExternalPlatform: threadIdOnExternalPlatform,\n      },\n    },\n  };\n}\n","import { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { ChatCustomEvent } from '../event/ChatEvent';\nimport { EventListenerFunction } from '../event/ListenerFunction';\n\ninterface DataWithThread {\n  case?: {\n    threadIdOnExternalPlatform?: ThreadIdOnExternalPlatform;\n  };\n  message?: {\n    threadIdOnExternalPlatform?: ThreadIdOnExternalPlatform;\n  };\n  messagePreview?: {\n    threadIdOnExternalPlatform?: ThreadIdOnExternalPlatform;\n  };\n  thread?: {\n    idOnExternalPlatform?: ThreadIdOnExternalPlatform;\n  };\n}\n\nconst getThreadId = (data: unknown): ThreadIdOnExternalPlatform | undefined => {\n  const dataWithThread = data as DataWithThread;\n\n  return (\n    dataWithThread?.thread?.idOnExternalPlatform ??\n    dataWithThread?.case?.threadIdOnExternalPlatform ??\n    dataWithThread?.message?.threadIdOnExternalPlatform ??\n    dataWithThread?.messagePreview?.threadIdOnExternalPlatform\n  );\n};\n\nexport const filterCurrentThreadEventHandler =\n  (threadId: ThreadIdOnExternalPlatform, handler: EventListenerFunction) =>\n  (event: ChatCustomEvent): void => {\n    const eventData = event.detail.data;\n\n    const eventThreadId = getThreadId(eventData);\n\n    if (eventThreadId === threadId) {\n      handler(event);\n    }\n  };\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SetConsumerContactCustomFieldsEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SetConsumerContactCustomFields';\nimport { CustomField } from '@brandembassy/ts-types-platform/dist/customField/CustomField';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createSetThreadCustomFieldsPayloadData(\n  customFields: Array<CustomField>,\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n): EventPayloadData<SetConsumerContactCustomFieldsEventData> {\n  return {\n    eventType: AwsInputEventType.SET_CONSUMER_CONTACT_CUSTOM_FIELD,\n    data: {\n      customFields,\n      thread: {\n        idOnExternalPlatform: threadIdOnExternalPlatform,\n      },\n    },\n  };\n}\n","import { ArchiveThreadEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/ArchiveThread';\nimport { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createArchiveThreadEventPayloadData(\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n): EventPayloadData<ArchiveThreadEventData> {\n  return {\n    eventType: AwsInputEventType.ARCHIVE_THREAD,\n    data: {\n      thread: {\n        idOnExternalPlatform: threadIdOnExternalPlatform,\n      },\n    },\n  };\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { UpdateThreadEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/UpdateThread';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { ChatEventData } from '../event/ChatEvent';\nimport { EventPayloadData } from '../sockets/EventPayload';\nimport { isUndefined } from '../utils/is';\n\nexport function createUpdateThreadPayloadData(\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n  threadName: string,\n): EventPayloadData<UpdateThreadEventData> {\n  return {\n    eventType: AwsInputEventType.UPDATE_THREAD,\n    data: {\n      thread: {\n        idOnExternalPlatform: threadIdOnExternalPlatform,\n        threadName,\n      },\n    },\n  };\n}\n\nexport function isUpdateThreadSuccess(response: ChatEventData): boolean {\n  return isUndefined(response.error);\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SendMessagePreviewEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessagePreview';\nimport { MessageType } from '@brandembassy/ts-types-platform/dist/message/MessageType';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport const createSendMessagePreviewPayloadData = (\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n  text: string,\n): EventPayloadData<SendMessagePreviewEventData> => ({\n  eventType: AwsInputEventType.SEND_MESSAGE_PREVIEW,\n  data: {\n    thread: {\n      idOnExternalPlatform: threadIdOnExternalPlatform,\n    },\n    messageContent: {\n      payload: { text },\n      type: MessageType.TEXT,\n    },\n  },\n});\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { AwsInputEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsInputEvent';\nimport { ContactNumber } from '@brandembassy/ts-types-platform/dist/contact/ContactNumber';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport const createSendTranscriptPayloadData = (\n  contactNumber: ContactNumber,\n  email: string,\n): EventPayloadData<AwsInputEventData> => ({\n  eventType: AwsInputEventType.SEND_TRANSCRIPT,\n  data: {\n    consumerContact: {\n      id: contactNumber,\n    },\n    consumerRecipients: [\n      {\n        idOnExternalPlatform: email,\n      },\n    ],\n  },\n});\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { RecoverThreadEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/RecoverThread';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../../sockets/EventPayload';\n\nexport function createRecoverLivechatThreadPayloadData(\n  threadIdOnExternalPlatform?: ThreadIdOnExternalPlatform,\n): EventPayloadData<RecoverThreadEventData> {\n  const emptyData = {\n    eventType: AwsInputEventType.RECOVER_LIVECHAT,\n    data: {},\n  };\n\n  if (!threadIdOnExternalPlatform) {\n    return emptyData;\n  }\n\n  return {\n    ...emptyData,\n    data: {\n      thread: { idOnExternalPlatform: threadIdOnExternalPlatform },\n    },\n  };\n}\n","import { LoadMoreMessagesEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/LoadMoreMessages';\nimport { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { Customer } from '../../customer/Customer';\nimport { CustomFieldsObject } from '../../customField/CustomFields';\nimport { ChatSDKError } from '../../error/ChatSDKError';\nimport { ChatCustomEvent, ChatEvent } from '../../event/ChatEvent';\nimport { IChatEventTarget } from '../../event/ChatEventTarget';\nimport { sendChatEvent } from '../../event/sendChatEvent';\nimport {\n  isLoadMoreMessagesEventData,\n  MoreMessagesLoadedEvent,\n} from '../../message/loadMoreMessagesEventData';\nimport { createLoadMoreMessagesPayloadData } from '../../message/loadMoreMessagesPayload';\nimport { MessageSuccessEventData } from '../../message/MessageSuccessEventData';\nimport { WebSocketClient } from '../../sockets/WebSocketClient';\nimport { AbortablePromise } from '../../utils/AbortablePromise';\nimport { isEmpty, isUndefined } from '../../utils/is';\nimport { SDKVariableStorage } from '../../variables/VariableStorage';\nimport { isRecoverSuccessPayload } from '../isRecoverSuccessPayload';\nimport { LoadMoreMessagesFailedError } from '../LoadMoreMessagesFailedError';\nimport { Thread } from '../Thread';\nimport { ThreadRecoveredData } from '../ThreadRecoveredData';\nimport { ThreadRecoverFailedError } from '../ThreadRecoverFailedError';\n\nimport { createEndThreadPayloadData } from './createEndThreadPayloadData';\nimport { createRecoverLivechatThreadPayloadData } from './recoverLivechatThreadPayload';\n\nexport class LivechatThread extends Thread {\n  protected _isInitialized: boolean = false;\n  protected _canSendMessage: boolean = true;\n\n  constructor(\n    idOnExternalPlatform: ThreadIdOnExternalPlatform,\n    websocketClient: WebSocketClient,\n    messageEmitter: IChatEventTarget,\n    customer: Customer | null,\n    customFields: CustomFieldsObject = {},\n    isAuthorizationEnabled: boolean = false,\n  ) {\n    super(\n      idOnExternalPlatform,\n      websocketClient,\n      messageEmitter,\n      customer,\n      customFields,\n      isAuthorizationEnabled,\n    );\n\n    this._registerLivechatEventHandlers();\n  }\n\n  /**\n   * Recover existing live chat\n   * @returns AbortablePromise ThreadRecoveredData\n   * @throws ThreadRecoverFailedError\n   *  * This exception is thrown when the recover fails or the thread does not exist.\n   */\n  public override recover(): AbortablePromise<ThreadRecoveredData> {\n    return new AbortablePromise(async (resolve, reject) => {\n      const response = await sendChatEvent(\n        createRecoverLivechatThreadPayloadData(this.idOnExternalPlatform),\n        this._websocketClient,\n      );\n\n      if (isRecoverSuccessPayload(response)) {\n        resolve(response.data);\n      } else {\n        reject(new ThreadRecoverFailedError('Thread not found', { response }));\n      }\n    });\n  }\n\n  public override async sendMessage(\n    messageData: SendMessageEventData,\n  ): Promise<MessageSuccessEventData> {\n    if (this._canSendMessage === false) {\n      throw new ChatSDKError('Cannot send more messages to Contact');\n    }\n\n    return super.sendMessage(messageData);\n  }\n\n  /**\n   * Start livechat\n   * @param initialMessageText - initial message text\n   */\n  public async startChat(\n    initialMessageText = 'Begin conversation',\n  ): Promise<MessageSuccessEventData | void> {\n    if (this._isInitialized) {\n      throw new ChatSDKError('Chat is already initialized');\n    }\n\n    try {\n      const result = await this.sendTextMessage(initialMessageText);\n      this._isInitialized = true;\n\n      return result;\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        throw new ChatSDKError(\n          `Sending initial message failed because of (${error.message})`,\n        );\n      }\n\n      return;\n    }\n  }\n\n  public async endChat(): Promise<void> {\n    const threadData = SDKVariableStorage.THREAD_DATA ?? {};\n    const contactId = threadData?.contactId;\n\n    if (isUndefined(contactId)) {\n      throw new ChatSDKError(\n        'Cannot end Chat because of missing ContactId in the storage',\n      );\n    }\n\n    await sendChatEvent(\n      createEndThreadPayloadData(this.idOnExternalPlatform, contactId),\n      this._websocketClient,\n    );\n\n    return;\n  }\n\n  /**\n   * Load previous messages\n   * @returns Promise MoreMessagesLoadedEvent | null\n   * @throws LoadMoreMessagesFailedError\n   *  * This exception is thrown when the attempt to load more messages fails.\n   */\n  public async loadMoreMessages(): Promise<MoreMessagesLoadedEvent | null> {\n    const { scrollToken, oldestMessageDatetime, contactId } =\n      SDKVariableStorage.THREAD_DATA ?? {};\n\n    if (isEmpty(scrollToken) || isEmpty(contactId)) {\n      return null;\n    }\n\n    const loadMoreMessagesEventData: LoadMoreMessagesEventData = {\n      scrollToken: String(scrollToken),\n      // @ts-expect-error oldestMessageDatetime is missing in type definition\n      oldestMessageDatetime,\n      thread: { idOnExternalPlatform: this.idOnExternalPlatform },\n      // If a contactId is provided, the search will return messages only for this contact\n      contact: {\n        id: contactId,\n      },\n    };\n\n    const response = await sendChatEvent(\n      createLoadMoreMessagesPayloadData(loadMoreMessagesEventData),\n      this._websocketClient,\n    );\n\n    if (isLoadMoreMessagesEventData(response)) {\n      return response;\n    }\n\n    throw new LoadMoreMessagesFailedError('Load more messages failed', {\n      response,\n    });\n  }\n\n  private _registerLivechatEventHandlers() {\n    this.onThreadEvent(\n      ChatEvent.LIVECHAT_RECOVERED,\n      (event: ChatCustomEvent) => {\n        if (!isRecoverSuccessPayload(event.detail)) {\n          return;\n        }\n\n        this._setCustomerExists();\n        this._setExistsOnPlatform(true);\n      },\n    );\n  }\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { EndContactEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/EndContact';\nimport { CaseId } from '@brandembassy/ts-types-platform/dist/post/case/CaseId';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\n\nimport { EventPayloadData } from '../../sockets/EventPayload';\n\nexport function createEndThreadPayloadData(\n  threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n  contactId: CaseId,\n): EventPayloadData<EndContactEventData> {\n  return {\n    eventType: AwsInputEventType.END_CONTACT,\n    data: {\n      thread: { idOnExternalPlatform: threadIdOnExternalPlatform },\n      contact: { id: contactId },\n    },\n  };\n}\n","import { ThreadListFetchedPostbackData } from '@brandembassy/ts-types-chat/dist/awsEvents/ThreadListFetched';\n\nimport { isNull } from '../utils/is';\n\nexport const isThreadListFetchedPostbackData = (\n  data: unknown,\n): data is ThreadListFetchedPostbackData => {\n  if (isNull(data)) {\n    return false;\n  }\n\n  return 'threads' in (data as ThreadListFetchedPostbackData);\n};\n","import { CaseId } from '@brandembassy/ts-types-platform/dist/post/case/CaseId';\n\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nexport function storeContactId(contactId: CaseId): void {\n  const originalThreadData = SDKVariableStorage.THREAD_DATA ?? {};\n\n  SDKVariableStorage.THREAD_DATA = {\n    ...originalThreadData,\n    contactId,\n  };\n}\n","import { isContactCreatedEvent } from '../contact/isContactCreatedEvent';\nimport { ChatEventData } from '../event/ChatEvent';\n\nimport { isRecoverSuccessPayload } from './isRecoverSuccessPayload';\nimport { storeContactId } from './storeContactId';\n\nexport function storeContactIdMiddleware(\n  eventData: ChatEventData,\n): ChatEventData {\n  if (isContactCreatedEvent(eventData)) {\n    const contactId = eventData.data.case.id;\n\n    storeContactId(contactId);\n  }\n\n  if (isRecoverSuccessPayload(eventData)) {\n    const contactId = eventData.data.contact.id;\n\n    storeContactId(contactId);\n  }\n\n  return eventData;\n}\n","import { Message } from '../message';\nimport { isUndefined } from '../utils/is';\nimport { lastItemInArray } from '../utils/last';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nexport interface ScrollData {\n  messages: Array<Message>;\n  scrollToken: string;\n}\n\nexport function storeThreadScrollData(scrollData: ScrollData): void {\n  const oldestMessageDatetime = lastItemInArray(scrollData.messages)?.createdAt;\n\n  const oldThreadData = SDKVariableStorage.THREAD_DATA ?? {};\n\n  SDKVariableStorage.THREAD_DATA = {\n    ...oldThreadData,\n    scrollToken: scrollData.scrollToken,\n    oldestMessageDatetime: isUndefined(oldestMessageDatetime)\n      ? ''\n      : oldestMessageDatetime,\n  };\n}\n","/**\n * Gets the last element of `array`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to query.\n * @returns {*} Returns the last element of `array`.\n * @example\n *\n * _.last([1, 2, 3]);\n * // => 3\n */\nfunction last(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? array[length - 1] : undefined;\n}\n\nexport default last;\n","import { ChatEventData } from '../event/ChatEvent';\nimport { isLoadMoreMessagesEventData } from '../message/loadMoreMessagesEventData';\n\nimport { isRecoverSuccessPayload } from './isRecoverSuccessPayload';\nimport { storeThreadScrollData } from './storeThreadScrollData';\n\nexport function storeThreadScrollDataMiddleware(\n  eventData: ChatEventData,\n): ChatEventData {\n  if (isRecoverSuccessPayload(eventData)) {\n    const { messages, messagesScrollToken } = eventData.data;\n\n    storeThreadScrollData({\n      messages,\n      scrollToken: messagesScrollToken,\n    });\n  }\n\n  if (isLoadMoreMessagesEventData(eventData)) {\n    const { scrollToken, messages } = eventData.data;\n\n    storeThreadScrollData({ scrollToken, messages });\n  }\n\n  return eventData;\n}\n","import { createQueryParametersAsString } from '@brandembassy/be-javascript-utils/dist/query/queryParameters';\nimport { WebSocketClientEvent } from '@brandembassy/push-updates-sdk';\nimport { AuthorizationToken } from '@brandembassy/ts-types-chat/dist/authorization/AuthorizationToken';\nimport { ConsumerAuthorizationSuccessPayloadData } from '@brandembassy/ts-types-chat/dist/authorization/ConsumerAuthorizationSuccessPayloadData';\nimport { AwsChatWindowEventActionRoute } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsChatWindowEvent';\nimport { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { ChannelInfo } from '@brandembassy/ts-types-chat/dist/channel/ChannelInfo';\nimport { BrowserFingerprint } from '@brandembassy/ts-types-chat/dist/user/BrowserFingerprint';\nimport { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\nimport { CustomerIdentityIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/endUser/EndUserIdentityId';\nimport { Thread as ThreadView } from '@brandembassy/ts-types-platform/dist/thread/Thread';\nimport { ThreadIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/thread/ThreadIdOnExternalPlatform';\nimport { VisitId } from '@brandembassy/ts-types-platform/dist/visit/visitId';\nimport { VisitorId } from '@brandembassy/ts-types-platform/dist/visitor/VisitorId';\n\nimport {\n  getAccessToken,\n  resetAccessToken,\n  setAccessToken,\n} from './authorization/accessTokenStorage';\nimport { AuthorizationError } from './authorization/AuthorizationError';\nimport { createAuthorizationPayloadData } from './authorization/authorizationPayloadData';\nimport { authorizationReconnect } from './authorization/authorizationReconnect';\nimport { createRefreshTokenPayload } from './authorization/createRefreshTokenPayload';\nimport { CustomerReconnectSuccessPayloadData } from './authorization/CustomerReconnectSuccessPayloadData';\nimport { getAuthorizationTokenForUrl } from './authorization/getAuthorizationTokenForUrl';\nimport { handleRefreshToken } from './authorization/handleRefreshToken';\nimport { isAuthSuccessEvent } from './authorization/isAuthSuccessEvent';\nimport { isIpAddressBlockedError } from './authorization/isIpAddressBlockedError';\nimport { isTokenRefreshedSuccessResponse } from './authorization/isTokenRefreshedSuccessResponse';\nimport { getBrowserLanguage } from './browserFingerprint/getBrowserFingerprint';\nimport {\n  ChannelAvailabilityResponse,\n  fetchChannelAvailability,\n} from './channel/fetchChannelAvailability';\nimport { fetchChannelInfo } from './channel/fetchChannelInfo';\nimport { handleBasicChannelInfo } from './channel/handleBasicChannelInfo';\nimport {\n  AuthorizationCallback,\n  RawEventCallback,\n  ErrorCallback,\n  type ChatSDKOptions,\n} from './ChatSDKOptions';\nimport { Customer, setCustomerIdentity } from './customer/Customer';\nimport { CustomerInstance } from './customer/CustomerInstance';\nimport { isCustomerIdentityIdValid } from './customer/isCustomerIdentityIdValid';\nimport { setCustomerIdFromOptions } from './customer/setCustomerIdFromOptions';\nimport {\n  CustomFieldsMap,\n  CustomFieldsObject,\n  getCustomFields,\n  setCustomFieldsFromArray,\n} from './customField/CustomFields';\nimport { buildEnvironmentEndpoints, EnvironmentName } from './env/Environments';\nimport { setEnvironmentEndpoints } from './env/setEnvironmentEndpoints';\nimport { CHAT_SDK_VERSION } from './env/version';\nimport { ChatSDKError } from './error/ChatSDKError';\nimport {\n  ERROR_CANNOT_FETCH_TRANSACTION_TOKEN,\n  ERROR_IP_ADDRESS_BLOCKED,\n} from './error/errorMessages';\nimport { IpAddressBlockedError } from './error/IpAddressBlockedError';\nimport { ChatCustomEvent, ChatEvent, ChatEventType } from './event/ChatEvent';\nimport { ChatEventMiddleware } from './event/ChatEventMiddleware';\nimport { ChatEventTarget, IChatEventTarget } from './event/ChatEventTarget';\nimport { RemoveListenerFunction } from './event/ListenerFunction';\nimport { chatEventMapper } from './event/middleware/ChatEventMapper';\nimport { sdkVersionCheck } from './event/middleware/sdkVersionCheck';\nimport { sendChatEvent } from './event/sendChatEvent';\nimport { initializeSdkVariables } from './initializeSdkVariables';\nimport { MessageSuccessEventData } from './message/MessageSuccessEventData';\nimport {\n  OfflineMessageData,\n  sendOfflineMessage,\n} from './message/sendOfflineMessage';\nimport { getEventData } from './request/getEventData';\nimport { makeRequest } from './request/makeRequest';\nimport {\n  onMessageHandler,\n  parseWsMessageEvent,\n} from './request/messageHandler';\nimport { clearCachedTransactionTokenResponse } from './securedSession/cachedTransactionTokenResponse';\nimport {\n  getSecuredSessionType,\n  isSecureSessions,\n  shouldHandleCustomerIdForSecureSessions,\n} from './securedSession/getSecuredSessionType';\nimport { getTransactionToken } from './securedSession/getTransactionToken';\nimport { handleNewThirdPartyToken } from './securedSession/handleNewThirdPartyToken';\nimport { storeIdentityToken } from './securedSession/identityToken';\nimport { SecureSessions } from './securedSession/SecureSessionsType';\nimport { resetThirdPartyToken } from './securedSession/thirdPartyTokenStorage';\nimport { createEvent, createEventPayload } from './sockets/EventPayload';\nimport { WebSocketClient } from './sockets/WebSocketClient';\nimport { LivechatThread, Thread, ThreadRecoverFailedError } from './thread';\nimport {\n  isRecoverSuccessPayload,\n  ThreadRecoveredChatEvent,\n} from './thread/isRecoverSuccessPayload';\nimport { isThreadListFetchedPostbackData } from './thread/isThreadListFetchedPostbackData';\nimport { createRecoverLivechatThreadPayloadData } from './thread/livechatThread/recoverLivechatThreadPayload';\nimport { createRecoverThreadPayloadData } from './thread/recoverThreadPayload';\nimport { storeContactIdMiddleware } from './thread/storeContactIdMiddleware';\nimport { storeThreadScrollDataMiddleware } from './thread/storeThreadScrollDataMiddleware';\nimport { AbortablePromise } from './utils/AbortablePromise';\nimport { assertNonNullable } from './utils/assert';\nimport { generateId } from './utils/generateId';\nimport { getBrandIdAndChannelId } from './utils/getBrandIdAndChannelId';\nimport { getPromiseWithResolvers } from './utils/getPromiseWithResolvers';\nimport { isEmpty, isNil, isNull, isUndefined } from './utils/is';\nimport { SDKVariableStorage } from './variables/VariableStorage';\n\nexport class ChatSdk {\n  onAuthorization?: AuthorizationCallback;\n  onError?: ErrorCallback;\n  onRawEvent?: RawEventCallback;\n\n  public isLivechat: boolean | undefined;\n  public channelId: ChannelId = '';\n\n  #customer: Customer;\n  readonly #customerImage: string | undefined;\n  readonly #customerName: string | undefined;\n  readonly #customerId: CustomerIdentityIdOnExternalPlatform | undefined;\n  readonly #isThirdPartyCookiesSupported: boolean | undefined;\n  #isAuthorizationEnabled: boolean | undefined;\n  #websocketClient: WebSocketClient | null = null;\n\n  readonly #contactCustomFieldsQueue: CustomFieldsMap = new Map();\n  readonly #threadCache: Map<\n    ThreadIdOnExternalPlatform,\n    Thread | LivechatThread\n  > = new Map();\n  readonly #incomingChatEventMiddleware = new ChatEventMiddleware();\n  readonly #messageEmitter: IChatEventTarget;\n  readonly #ready = getPromiseWithResolvers<void>();\n\n  constructor(options: ChatSDKOptions) {\n    if (options === undefined) {\n      throw new ChatSDKError(\n        'No options was provided for initialization of ChatSdk',\n      );\n    }\n\n    this.#customerImage = options.customerImage;\n    this.#customerName = options.customerName;\n    this.#customerId = options.customerId;\n\n    initializeSdkVariables(options);\n\n    this.#customer = CustomerInstance.getInstance();\n\n    if (typeof options.customerId !== 'undefined') {\n      setCustomerIdFromOptions(options.customerId);\n    }\n\n    const { brandId, channelId } = getBrandIdAndChannelId();\n\n    this.onAuthorization = options.onAuthorization;\n    this.onError = options.onError;\n    this.onRawEvent = options.onRawEvent;\n\n    // Register middleware for incoming chat events\n    this.#incomingChatEventMiddleware.register(chatEventMapper);\n    this.#incomingChatEventMiddleware.register(sdkVersionCheck);\n    this.#incomingChatEventMiddleware.register(storeThreadScrollDataMiddleware);\n    this.#incomingChatEventMiddleware.register(storeContactIdMiddleware);\n\n    this.#messageEmitter = new ChatEventTarget();\n\n    try {\n      if (isNaN(brandId)) {\n        throw new Error('Missing BrandID');\n      }\n      if (channelId === undefined) {\n        throw new Error('Missing ChannelId');\n      }\n      if (options.customerId === undefined && !isSecureSessions()) {\n        throw new Error('Missing CustomerId');\n      }\n\n      this.channelId = channelId;\n      this.isLivechat = options.isLivechat;\n      this.#isAuthorizationEnabled =\n        getSecuredSessionType() === SecureSessions.THIRD_PARTY ||\n        options.isAuthorizationEnabled;\n      this.#isThirdPartyCookiesSupported = options.isThirdPartyCookiesSupported;\n\n      this.#initEnvironment(options);\n    } catch (error: unknown) {\n      this.#onErrorHandler(error);\n    }\n  }\n\n  /**\n   * Initiate a WebSocket connection\n   * @param authorizationCode - authorization code\n   * @returns Promise<boolean> - true if the connection was created, false if the connection already exists\n   * @throws ChatSDKError\n   */\n  public async connect(authorizationCode?: string): Promise<boolean> {\n    if (authorizationCode) {\n      SDKVariableStorage.AUTHORIZATION_CODE = authorizationCode;\n    }\n    // Do not create a new connection if there is already one\n    if (this.#websocketClient !== null) {\n      return false;\n    }\n    await this.#createConnection();\n\n    if (isSecureSessions()) {\n      await this.ready();\n    }\n\n    // Init Customer instance after the websocketClient is initialized\n    if (this.#customerId !== undefined) {\n      this.#customer.setId(this.#customerId);\n    }\n\n    if (this.#customerName !== undefined) {\n      this.#customer.setName(this.#customerName);\n    }\n\n    if (this.#customerImage !== undefined) {\n      this.#customer.setImage(this.#customerImage);\n    }\n\n    if (this.#websocketClient !== null) {\n      this.#customer.setWebsocketClient(this.#websocketClient);\n    }\n\n    // Mark the instance as ready (if not already)\n    this.#ready.resolve();\n\n    return true;\n  }\n\n  public async ready(): Promise<void> {\n    return this.#ready.promise;\n  }\n\n  #onErrorHandler(error: unknown): void {\n    const sdkError =\n      error instanceof ChatSDKError ? error : new ChatSDKError(error);\n\n    if (typeof this.onError === 'function') {\n      this.onError(sdkError);\n\n      return;\n    }\n\n    throw sdkError;\n  }\n\n  /**\n   * Get channel info\n   * Returns channel info like feature toggle status, translations, file upload restrictions, theme color settings etc.\n   * @returns ChannelInfo\n   * @throws ChatSDKError\n   */\n  public async getChannelInfo(): Promise<ChannelInfo> {\n    return fetchChannelInfo(\n      SDKVariableStorage.BRAND_ID as BrandId,\n      SDKVariableStorage.CHANNEL_ID as ChannelId,\n      SDKVariableStorage.LANGUAGE ?? getBrowserLanguage(),\n      SDKVariableStorage.ENDPOINT_CHAT as string,\n      SDKVariableStorage.REQUEST_METADATA?.httpHeaders || {},\n    );\n  }\n\n  /**\n   * Get channel availability\n   * Returns channel availability Online/Offline\n   * @returns ChannelAvailabilityResponse\n   * @throws ChatSDKError\n   */\n  public async getChannelAvailability(): Promise<ChannelAvailabilityResponse> {\n    return fetchChannelAvailability(\n      SDKVariableStorage.BRAND_ID as BrandId,\n      SDKVariableStorage.CHANNEL_ID as ChannelId,\n      SDKVariableStorage.ENDPOINT_CHAT as string,\n      SDKVariableStorage.REQUEST_METADATA?.httpHeaders || {},\n      SDKVariableStorage.APP_NAME,\n    );\n  }\n\n  /**\n   * Send Authorization Event\n   * @deprecated - use Secured Session flow instead (SDK option `securedSession` and {@link ChatSdk.connect})\n   * @param authorizationCode - authorization code\n   * @param visitorId - visitor id\n   * @param browserFingerprint - BrowserFingerprint object, use getBrowserFingerprint helper function to create it\n   * @throws AuthorizationError\n   *  * This exception is thrown when the authorization or refresh token fails\n   */\n  public async authorize(\n    authorizationCode?: string,\n    visitorId?: VisitorId,\n    browserFingerprint?: BrowserFingerprint,\n  ): Promise<\n    | ConsumerAuthorizationSuccessPayloadData\n    | CustomerReconnectSuccessPayloadData\n  > {\n    await this.ready(); // Wait for the instance to be ready\n\n    const accessToken = getAccessToken();\n\n    // Reconnect first\n    if (accessToken !== null) {\n      try {\n        const reconnectResponse = await authorizationReconnect(\n          this.#websocketClient,\n          this.#sendRefreshTokenEvent,\n          accessToken,\n          visitorId,\n        );\n\n        return reconnectResponse;\n      } catch (error) {\n        // invalid token, continue with authorization\n      }\n    }\n\n    const basicChannelInfoRequest = handleBasicChannelInfo(\n      this.#isAuthorizationEnabled,\n      this.isLivechat,\n    );\n\n    // Authorization\n    const authorizationPayloadData = createAuthorizationPayloadData(\n      authorizationCode ?? SDKVariableStorage.AUTHORIZATION_CODE ?? null,\n      visitorId,\n      browserFingerprint,\n    );\n\n    const authEvent = createEvent(\n      createEventPayload(authorizationPayloadData),\n      generateId(),\n      AwsChatWindowEventActionRoute.REGISTER,\n    );\n\n    const authorizationRequest = makeRequest(authEvent, this.#websocketClient);\n\n    const [authResponse, basicChannelInfo] = await Promise.all([\n      authorizationRequest,\n      basicChannelInfoRequest,\n    ]);\n\n    if (!isAuthSuccessEvent(authResponse)) {\n      this.#websocketClient?.disconnect();\n\n      throw new AuthorizationError('Authorization failed', authResponse.error);\n    }\n\n    // Auth successful - Use the response data\n    const { consumerIdentity, customer, contact } = authResponse.data;\n\n    // Setup Customer Identity and Customer Custom Fields\n    const customerId = consumerIdentity?.idOnExternalPlatform;\n    if (!isCustomerIdentityIdValid(customerId)) {\n      this.#websocketClient?.disconnect();\n\n      throw new ChatSDKError('Invalid customer identity');\n    }\n\n    setCustomerIdentity(this.#customer, consumerIdentity);\n\n    if (customer?.customFields) {\n      this.#customer.setCustomFieldsFromArray(customer.customFields);\n    }\n\n    // Queue Contact Custom Fields from the response\n    if (contact?.customFields) {\n      setCustomFieldsFromArray(\n        this.#contactCustomFieldsQueue,\n        contact.customFields,\n      );\n    }\n\n    // Set up the thread settings\n    this.#isAuthorizationEnabled = basicChannelInfo.isAuthorizationEnabled;\n    this.isLivechat = basicChannelInfo.isLivechat;\n\n    // Set up the access token and its refresh\n    if (authResponse.data.accessToken?.token !== undefined) {\n      setAccessToken(authResponse.data.accessToken);\n      handleRefreshToken(\n        authResponse.data.accessToken,\n        this.#sendRefreshTokenEvent,\n      );\n    }\n\n    return authResponse.data;\n  }\n\n  /**\n   * Generate Authorization Token from the given url\n   *\n   * @deprecated the additional message content is handled internally, there is no need to use this method\n   * @param threadIdOnExternalPlatform - Thread Id\n   * @param url - Authorization Service URL\n   */\n  public async generateAuthorizationToken(\n    threadIdOnExternalPlatform: ThreadIdOnExternalPlatform,\n    url: string,\n  ): Promise<AuthorizationToken> {\n    if (this.#websocketClient === null) {\n      throw new ChatSDKError('Websocket client is not initialized');\n    }\n\n    return getAuthorizationTokenForUrl(\n      threadIdOnExternalPlatform,\n      url,\n      this.#websocketClient,\n    );\n  }\n\n  /**\n   * Register handler to chat event\n   *\n   * @param type - type of chat event\n   * @param handler - event handler\n   * @returns function to unregister handler\n   */\n  public onChatEvent(\n    type: ChatEventType,\n    handler: (event: ChatCustomEvent) => void,\n  ): RemoveListenerFunction {\n    this.#messageEmitter.addEventListener(type, handler);\n\n    return () => {\n      this.#messageEmitter.removeEventListener(type, handler);\n    };\n  }\n\n  /**\n   * Get Customer instance\n   */\n  public getCustomer(): Customer {\n    return this.#customer;\n  }\n\n  /**\n   * Get Thread instance by id\n   * @param id - thread id\n   * @returns instance of thread based on channel settings\n   */\n  public getThread(id: ThreadIdOnExternalPlatform): Thread | LivechatThread {\n    if (id === '') {\n      throw new ChatSDKError('Cannot get thread because id is empty');\n    }\n\n    if (isNull(this.#websocketClient)) {\n      throw new ChatSDKError(\n        'Cannot get thread because websocket is disconnected',\n      );\n    }\n\n    if (isNil(id)) {\n      throw new ChatSDKError('Cannot get thread because id is undefined');\n    }\n\n    const cachedThread = this.#threadCache.get(id);\n    if (!isUndefined(cachedThread)) {\n      return cachedThread;\n    }\n\n    if (this.isLivechat === true) {\n      const liveThread = new LivechatThread(\n        id,\n        this.#websocketClient,\n        this.#messageEmitter,\n        this.#customer,\n        this._getContactCustomFieldsFromQueue(),\n        this.#isAuthorizationEnabled,\n      );\n      this.#threadCache.set(id, liveThread);\n\n      return liveThread;\n    }\n\n    const thread = new Thread(\n      id,\n      this.#websocketClient,\n      this.#messageEmitter,\n      this.#customer,\n      this._getContactCustomFieldsFromQueue(),\n      this.#isAuthorizationEnabled,\n    );\n    this.#threadCache.set(id, thread);\n\n    return thread;\n  }\n\n  /**\n   * Get list of available threads\n   * @returns list of threads\n   */\n  public async getThreadList(): Promise<Array<ThreadView> | null> {\n    if (isNull(this.#websocketClient)) {\n      throw new ChatSDKError(\n        'Cannot get thread list because websocket is disconnected',\n      );\n    }\n\n    const eventPayload = {\n      eventType: AwsInputEventType.FETCH_THREAD_LIST,\n      data: {},\n    };\n\n    const result = await sendChatEvent(eventPayload, this.#websocketClient);\n\n    if (!isThreadListFetchedPostbackData(result.data)) {\n      throw new ChatSDKError(\n        'Invalid response from fetch thread list (getThreadList)',\n      );\n    }\n\n    return result.data.threads;\n  }\n\n  /**\n   * Get access to a websocket connection\n   * @returns WebSocketClient instance\n   */\n  public getWebsocketClient(): WebSocketClient | null {\n    return this.#websocketClient;\n  }\n\n  /**\n   * Send the Offline Message\n   * @param offlineMessageData - offline message data (name, email, message)\n   * @returns success\n   * @throws SendMessageFailedError\n   *  * This exception is thrown when a message fails to send. The error contains (`error.data`) a response from the backend with details.\n   */\n  public async sendOfflineMessage(\n    offlineMessageData: OfflineMessageData,\n  ): Promise<MessageSuccessEventData> {\n    return sendOfflineMessage(offlineMessageData, this.#websocketClient);\n  }\n\n  /**\n   * Recover thread data\n   * @param threadIdOnExternalPlatform - thread id on external platform\n   * @returns thread session data\n   * @throws ThreadRecoverFailedError\n   *  * This exception is thrown when the recover fails or the thread does not exist.\n   */\n  public recoverThreadData(\n    threadIdOnExternalPlatform:\n      | ThreadIdOnExternalPlatform\n      | undefined = undefined,\n  ): AbortablePromise<ThreadRecoveredChatEvent> {\n    return new AbortablePromise(async (resolve, reject) => {\n      const recoverEvent = createRecoverThreadPayloadData(\n        threadIdOnExternalPlatform,\n      );\n      const recoverResponse = await sendChatEvent(\n        recoverEvent,\n        this.#websocketClient,\n      );\n\n      if (isRecoverSuccessPayload(recoverResponse)) {\n        // Create a Thread instance after success recover\n        this.getThread(recoverResponse.data.thread.idOnExternalPlatform);\n        // Emit the 'recover' event to properly set up the Thread instance.\n        this.#messageEmitter.dispatchEvent(\n          new ChatCustomEvent(ChatEvent.THREAD_RECOVERED, {\n            detail: recoverResponse,\n          }),\n        );\n\n        resolve(recoverResponse);\n      } else {\n        reject(\n          new ThreadRecoverFailedError('Thread not found', {\n            response: recoverResponse,\n          }),\n        );\n      }\n    });\n  }\n\n  /**\n   * Recover livechat thread data\n   * @param threadIdOnExternalPlatform - thread id on external platform\n   * @returns thread livechat session data\n   * @throws ThreadRecoverFailedError\n   *  * This exception is thrown when the recover fails or the thread does not exist.\n   */\n  public recoverLivechatThreadData(\n    threadIdOnExternalPlatform:\n      | ThreadIdOnExternalPlatform\n      | undefined = undefined,\n  ): AbortablePromise<ThreadRecoveredChatEvent> {\n    return new AbortablePromise(async (resolve, reject) => {\n      const recoverEvent = createRecoverLivechatThreadPayloadData(\n        threadIdOnExternalPlatform,\n      );\n      const recoverResponse = await sendChatEvent(\n        recoverEvent,\n        this.#websocketClient,\n      );\n\n      if (isRecoverSuccessPayload(recoverResponse)) {\n        // Create a Thread instance after success recover\n        this.getThread(recoverResponse.data.thread.idOnExternalPlatform);\n        // Emit the 'recover' event to properly set up the Thread instance.\n        this.#messageEmitter.dispatchEvent(\n          new ChatCustomEvent(ChatEvent.LIVECHAT_RECOVERED, {\n            detail: recoverResponse,\n          }),\n        );\n\n        resolve(recoverResponse);\n      } else {\n        reject(\n          new ThreadRecoverFailedError('Thread not found', {\n            response: recoverResponse,\n          }),\n        );\n      }\n    });\n  }\n\n  /**\n   * Reset the ChatSdk session and clear it from customer data\n   * - it disconnects the WS connection and creates a new one\n   * - generates new IDs if not provided\n   */\n  public async resetSession(\n    customerId: CustomerIdentityIdOnExternalPlatform = generateId(),\n    customerName: string = '',\n    customerImage: string = '',\n    visitorId: VisitorId = '',\n    visitId: VisitId = generateId(),\n  ): Promise<void> {\n    // Close the connection and clear the session data (customer, tokens, etc.)\n    this.#websocketClient?.disconnect();\n    this.#websocketClient = null;\n    this.#threadCache.clear();\n    this.#contactCustomFieldsQueue.clear();\n    resetAccessToken();\n    resetThirdPartyToken();\n    clearCachedTransactionTokenResponse();\n\n    this.#customer.destroy();\n\n    // Reinitialize\n    SDKVariableStorage.VISIT_ID = visitId;\n    SDKVariableStorage.VISITOR_ID = visitorId;\n\n    try {\n      await this.#createConnection();\n      this.#customer = new Customer(\n        customerId,\n        customerName,\n        customerImage,\n        this.#websocketClient,\n      );\n    } catch (e) {\n      this.#onErrorHandler(e);\n    }\n  }\n\n  async #createSocketUrl(): Promise<string> {\n    const { brandId, channelId } = getBrandIdAndChannelId();\n    const endpoint = SDKVariableStorage.ENDPOINT_GATEWAY;\n    const appVersion = SDKVariableStorage.APP_VERSION;\n    let accessToken: string | undefined;\n\n    assertNonNullable(endpoint);\n\n    const visitorId = SDKVariableStorage.VISITOR_ID ?? '';\n\n    if (isSecureSessions()) {\n      const customerId = shouldHandleCustomerIdForSecureSessions()\n        ? this.#customer.getId()\n        : null;\n      const authorizationCode = this.#isAuthorizationEnabled\n        ? SDKVariableStorage.AUTHORIZATION_CODE\n        : undefined;\n      const useCache = getSecuredSessionType() !== SecureSessions.THIRD_PARTY;\n      const cookieStorageFallback =\n        getSecuredSessionType() === SecureSessions.SECURED_COOKIES &&\n        !this.#isThirdPartyCookiesSupported;\n\n      try {\n        const transactionTokenResponse = await getTransactionToken(\n          authorizationCode,\n          customerId,\n          cookieStorageFallback,\n          useCache,\n        );\n        accessToken = transactionTokenResponse.accessToken;\n\n        const { customerIdentity, thirdParty, contact, identityToken } =\n          transactionTokenResponse;\n        // Set Customer Identity\n        if (customerIdentity) {\n          setCustomerIdentity(this.#customer, customerIdentity);\n        }\n        // Set Third Party Token\n        if (thirdParty) {\n          handleNewThirdPartyToken(thirdParty);\n        }\n        // Set Contact custom fields\n        if (contact?.customFields) {\n          setCustomFieldsFromArray(\n            this.#contactCustomFieldsQueue,\n            contact.customFields,\n          );\n        }\n        // Set and store fallback identityToken\n        if (identityToken) {\n          storeIdentityToken(identityToken);\n        }\n        // Propagate authorization success with context\n        if (this.onAuthorization) {\n          this.onAuthorization('success', transactionTokenResponse);\n        }\n      } catch (error) {\n        if (isIpAddressBlockedError(error)) {\n          if (typeof this.onError === 'function') {\n            this.onError(new IpAddressBlockedError(ERROR_IP_ADDRESS_BLOCKED));\n          }\n\n          throw new IpAddressBlockedError(ERROR_IP_ADDRESS_BLOCKED);\n        } else {\n          const sdkError = new ChatSDKError(\n            ERROR_CANNOT_FETCH_TRANSACTION_TOKEN,\n            { error },\n          );\n          // Propagate authorization error with context\n          if (this.onAuthorization) {\n            this.onAuthorization('error', {});\n          }\n          this.#onErrorHandler(sdkError);\n\n          throw sdkError;\n        }\n      }\n    }\n\n    // Mark the instance as ready\n    this.#ready.resolve();\n\n    const customMetadataHeaders =\n      SDKVariableStorage.REQUEST_METADATA?.websocketQuery ?? {};\n\n    const queryParameters = {\n      ...customMetadataHeaders,\n      v: appVersion,\n      sdkPlatform: 'web',\n      sdkVersion: CHAT_SDK_VERSION,\n      brandId,\n      channelId,\n      ...(isSecureSessions() ? {} : { customerId: this.#customer.getId() }),\n      visitorId,\n      ...(isSecureSessions() ? { transactionToken: accessToken } : {}),\n    };\n\n    const queryParametersAsString =\n      createQueryParametersAsString(queryParameters);\n\n    try {\n      const url = new URL(endpoint);\n      url.search = queryParametersAsString;\n\n      return url.toString();\n    } catch (error) {\n      this.#onErrorHandler(\n        new ChatSDKError(\n          `Invalid URL: ${endpoint}. Make sure it is a valid URL.`,\n          { error },\n        ),\n      );\n\n      return '';\n    }\n  }\n\n  async #createConnection(): Promise<void> {\n    try {\n      this.#websocketClient = this.#initWS();\n      await this.#websocketClient.connect();\n    } catch (error) {\n      this.#onErrorHandler(error);\n    }\n  }\n\n  _getContactCustomFieldsFromQueue(): CustomFieldsObject {\n    if (this.#contactCustomFieldsQueue.size > 0) {\n      const fields = getCustomFields(this.#contactCustomFieldsQueue);\n      this.#contactCustomFieldsQueue.clear();\n\n      return fields;\n    }\n\n    return {};\n  }\n\n  /**\n   * @deprecated - do not use\n   */\n  #sendRefreshTokenEvent = async (): Promise<void> => {\n    const accessToken = getAccessToken();\n    if (isNull(accessToken)) {\n      return;\n    }\n\n    const refreshTokenResponse = await sendChatEvent(\n      createRefreshTokenPayload(accessToken.token),\n      this.#websocketClient,\n    );\n\n    if (isTokenRefreshedSuccessResponse(refreshTokenResponse)) {\n      setAccessToken(refreshTokenResponse.data.accessToken);\n\n      handleRefreshToken(\n        refreshTokenResponse.data.accessToken,\n        this.#sendRefreshTokenEvent,\n      );\n\n      return;\n    }\n\n    throw new AuthorizationError(\n      'An error occurred while refreshing the access token',\n      refreshTokenResponse.error,\n    );\n  };\n\n  /**\n   * Setup Environment endpoints\n   */\n  #initEnvironment(options: ChatSDKOptions): void {\n    // Set custom environment\n    if (options.environment === EnvironmentName.custom) {\n      if (\n        isEmpty(options.customEnvironment) ||\n        isNil(options.customEnvironment)\n      ) {\n        throw new ChatSDKError(\n          'customEnvironment must be provided when environment is set to \"custom\"',\n        );\n      }\n\n      setEnvironmentEndpoints(options.customEnvironment);\n\n      return;\n    }\n\n    // Set predefined environment\n    const endpoints = buildEnvironmentEndpoints(options.environment);\n    setEnvironmentEndpoints(endpoints);\n  }\n\n  #initWS(): WebSocketClient {\n    const client = new WebSocketClient(\n      this.onError,\n      this.#createSocketUrl.bind(this),\n    );\n\n    client.on(WebSocketClientEvent.MESSAGE, async (event: ChatCustomEvent) => {\n      try {\n        if (typeof this.onRawEvent === 'function') {\n          this.onRawEvent(event);\n        }\n\n        const eventData = await getEventData(\n          parseWsMessageEvent(event),\n          this.#websocketClient,\n        );\n\n        const parsedEvent =\n          this.#incomingChatEventMiddleware.process(eventData);\n\n        if (!isNil(parsedEvent)) {\n          const { type } = parsedEvent;\n\n          onMessageHandler(parsedEvent);\n\n          this.#messageEmitter.dispatchEvent(\n            new ChatCustomEvent(type ?? '', {\n              detail: parsedEvent,\n            }),\n          );\n        }\n      } catch (error: unknown) {\n        this.#onErrorHandler(error);\n      }\n    });\n\n    return client;\n  }\n}\n","interface PromiseWithResolvers<T = unknown> {\n  promise: Promise<T>;\n  reject: (reason: unknown) => void;\n  resolve: (value: T) => void;\n}\n\nexport function getPromiseWithResolvers<T>(): PromiseWithResolvers<T> {\n  let resolve, reject;\n  const promise = new Promise((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n\n  return { promise, resolve, reject } as unknown as PromiseWithResolvers<T>;\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { RefreshTokenData } from '@brandembassy/ts-types-chat/dist/awsEvents/RefreshToken';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nexport function createRefreshTokenPayload(\n  token: string,\n): EventPayloadData<RefreshTokenData> {\n  return {\n    eventType: AwsInputEventType.REFRESH_TOKEN,\n    data: {\n      accessToken: {\n        token,\n      },\n    },\n  };\n}\n","export const APP_NAME = 'chat-web-sdk';\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport {\n  isSecureSessions,\n  shouldHandleCustomerIdForSecureSessions,\n} from '../securedSession/getSecuredSessionType';\nimport { isEmpty } from '../utils/is';\n\nimport { CustomerInstance } from './CustomerInstance';\n\nexport function setCustomerIdFromOptions(customerIdOption: unknown): void {\n  if (\n    isSecureSessions() &&\n    shouldHandleCustomerIdForSecureSessions() === false &&\n    typeof customerIdOption !== 'undefined'\n  ) {\n    throw new ChatSDKError(\n      'The CustomerId cannot be set when secured sessions are enabled',\n    );\n  }\n\n  if (\n    isSecureSessions() &&\n    shouldHandleCustomerIdForSecureSessions() &&\n    isEmpty(customerIdOption)\n  ) {\n    throw new ChatSDKError(\n      'The CustomerId cannot be empty string when \"anonymous\" secured sessions are enabled',\n    );\n  }\n\n  if (typeof customerIdOption === 'string') {\n    CustomerInstance.getInstance().setId(customerIdOption);\n  }\n}\n","import { AccessToken } from '@brandembassy/ts-types-chat/dist/authorization/AccessToken';\n\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport { AuthorizationError } from './AuthorizationError';\nimport { createReconnectPayloadData } from './createReconnectPayloadData';\nimport { CustomerReconnectSuccessPayloadData } from './CustomerReconnectSuccessPayloadData';\nimport { handleRefreshToken } from './handleRefreshToken';\n\nexport async function authorizationReconnect(\n  websocketClient: WebSocketClient | null,\n  refreshTokenEventCallback: () => Promise<void>,\n  accessToken: AccessToken,\n  visitorId?: string,\n): Promise<CustomerReconnectSuccessPayloadData> {\n  const reconnectPayload = createReconnectPayloadData(accessToken, visitorId);\n\n  const response = await sendChatEvent(reconnectPayload, websocketClient);\n\n  const hasError = response.error !== undefined;\n\n  if (hasError) {\n    throw new AuthorizationError(\n      'Authorization reconnect failed',\n      response.error,\n    );\n  }\n\n  const successReconnectResponse: CustomerReconnectSuccessPayloadData = {\n    reconnected: true,\n  };\n\n  handleRefreshToken(accessToken, refreshTokenEventCallback);\n\n  return successReconnectResponse;\n}\n","import { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\n\nimport { isUndefined } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport { fetchChannelInfo } from './fetchChannelInfo';\n\nexport async function handleBasicChannelInfo(\n  isAuthorizationEnabled: undefined | boolean,\n  isLivechat: undefined | boolean,\n): Promise<{\n  isAuthorizationEnabled: boolean;\n  isLivechat: boolean;\n}> {\n  if (!isUndefined(isAuthorizationEnabled) && !isUndefined(isLivechat)) {\n    return {\n      isAuthorizationEnabled,\n      isLivechat,\n    };\n  }\n\n  const channelInfo = await fetchChannelInfo(\n    SDKVariableStorage.BRAND_ID as BrandId,\n    SDKVariableStorage.CHANNEL_ID as ChannelId,\n    SDKVariableStorage.LANGUAGE,\n    SDKVariableStorage.ENDPOINT_CHAT as string,\n    SDKVariableStorage.REQUEST_METADATA?.httpHeaders,\n    SDKVariableStorage.APP_NAME,\n  );\n\n  return {\n    isAuthorizationEnabled: channelInfo.isAuthorizationEnabled,\n    isLivechat: channelInfo.isLiveChat,\n  };\n}\n","import { AuthorizeCustomerData } from '@brandembassy/ts-types-chat/dist/awsEvents/AuthorizeCustomer';\nimport { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { BrowserFingerprint } from '@brandembassy/ts-types-chat/dist/user/BrowserFingerprint';\nimport { VisitorId } from '@brandembassy/ts-types-platform/dist/visitor/VisitorId';\n\nimport { CHAT_SDK_VERSION } from '../env/version';\nimport { EventPayloadData } from '../sockets/EventPayload';\nimport { generateId } from '../utils/generateId';\nimport { createVisitorPayload } from '../visitor/createVisitorPayload';\n\nexport function createAuthorizationPayloadData(\n  authorizationCode: string | null,\n  visitorId: VisitorId = generateId(),\n  browserFingerprint?: BrowserFingerprint,\n): EventPayloadData<AuthorizeCustomerData> {\n  return {\n    eventType: AwsInputEventType.AUTHORIZE_CUSTOMER,\n    data: {\n      authorization: {\n        authorizationCode,\n      },\n      browserFingerprint,\n      disableChannelInfo: true,\n      sdkVersion: CHAT_SDK_VERSION,\n      sdkPlatform: 'web',\n    },\n    ...createVisitorPayload(visitorId as VisitorId),\n  };\n}\n","import { CustomerIdentityIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/customer/CustomerIdentity';\n\nimport { isNil } from '../utils/is';\n\nexport function isCustomerIdentityIdValid(\n  customerIdentityIdOnExternalPlatform:\n    | CustomerIdentityIdOnExternalPlatform\n    | undefined,\n): customerIdentityIdOnExternalPlatform is CustomerIdentityIdOnExternalPlatform {\n  return (\n    !isNil(customerIdentityIdOnExternalPlatform) &&\n    customerIdentityIdOnExternalPlatform !== ''\n  );\n}\n","import { sendChatEvent } from '../event/sendChatEvent';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport {\n  isSendMessageSuccessEventData,\n  MessageSuccessEventData,\n} from './MessageSuccessEventData';\nimport { SendMessageFailedError } from './SendMessageFailedError';\nimport { createSendOfflineMessagePayloadData } from './sendOfflineMessagePayload';\n\nexport interface OfflineMessageData {\n  email: string;\n  message: string;\n  name: string;\n}\n\nexport const sendOfflineMessage = async (\n  offlineMessageData: OfflineMessageData,\n  websocketClient: WebSocketClient | null,\n): Promise<MessageSuccessEventData> => {\n  const offlineMessagePayloadData =\n    createSendOfflineMessagePayloadData(offlineMessageData);\n\n  const response = await sendChatEvent(\n    offlineMessagePayloadData,\n    websocketClient,\n  );\n\n  if (isSendMessageSuccessEventData(response)) {\n    return response;\n  }\n\n  throw new SendMessageFailedError('Send offline message failed', response);\n};\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SendOfflineMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendOfflineMessage';\nimport { CustomerIdentityIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/customer/CustomerIdentity';\nimport { MessageType } from '@brandembassy/ts-types-platform/dist/message/MessageType';\n\nimport { EventPayloadData } from '../sockets/EventPayload';\n\nimport { OfflineMessageData } from './sendOfflineMessage';\n\nexport const createSendOfflineMessagePayloadData = (\n  offlineMessageData: OfflineMessageData,\n): EventPayloadData<SendOfflineMessageEventData> => {\n  const [lastName, ...names] = offlineMessageData.name.split(' ').reverse();\n  const firstName = names.reverse().join(' ');\n\n  const authorCustomerIdentity = {\n    idOnExternalPlatform:\n      offlineMessageData.email as CustomerIdentityIdOnExternalPlatform,\n    firstName,\n    lastName,\n  };\n\n  const data = {\n    messageContent: {\n      type: MessageType.TEXT,\n      payload: {\n        text: offlineMessageData.message,\n      },\n    },\n    authorCustomerIdentity,\n  };\n\n  return {\n    eventType: AwsInputEventType.SEND_OFFLINE_MESSAGE,\n    data,\n  };\n};\n","import { CaseInboxAssigneeChangedData } from '@brandembassy/ts-types-platform/dist/post/case/CaseInboxAssigneeChangedEvent';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport interface AssignedAgentChangedEvent extends ChatEventData {\n  data: CaseInboxAssigneeChangedData;\n  type: typeof ChatEvent.ASSIGNED_AGENT_CHANGED;\n}\n\nexport function isAssignedAgentChangedEvent(\n  event: ChatEventData,\n): event is AssignedAgentChangedEvent {\n  return (\n    event.type === ChatEvent.ASSIGNED_AGENT_CHANGED &&\n    (event as AssignedAgentChangedEvent).data?.case?.id !== undefined\n  );\n}\n","import { TypingEventData } from '@brandembassy/ts-types-platform/dist/user/typing/TypingEventData';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport type AgentTypingStartedData = TypingEventData;\n\nexport interface AgentTypingStartedEvent extends ChatEventData {\n  data: AgentTypingStartedData;\n  type: typeof ChatEvent.AGENT_TYPING_STARTED;\n}\n\nexport function isAgentTypingStartedEvent(\n  event: ChatEventData,\n): event is AgentTypingStartedEvent {\n  return (\n    event.type === ChatEvent.AGENT_TYPING_STARTED &&\n    (event as AgentTypingStartedEvent).data?.thread?.idOnExternalPlatform !==\n      undefined\n  );\n}\n","import { TypingEventData } from '@brandembassy/ts-types-platform/dist/user/typing/TypingEventData';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\n\nexport type AgentTypingEndedData = TypingEventData;\n\nexport interface AgentTypingEndedEvent extends ChatEventData {\n  data: AgentTypingEndedData;\n  type: typeof ChatEvent.AGENT_TYPING_ENDED;\n}\n\nexport function isAgentTypingEndedEvent(\n  event: ChatEventData,\n): event is AgentTypingEndedEvent {\n  return (\n    event.type === ChatEvent.AGENT_TYPING_ENDED &&\n    (event as AgentTypingEndedEvent).data?.thread?.idOnExternalPlatform !==\n      undefined\n  );\n}\n","import { CustomerIdentityIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/endUser/EndUserIdentityId';\n\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { ERROR_CANNOT_FETCH_TRANSACTION_TOKEN } from '../error/errorMessages';\nimport { postJSON } from '../utils/fetchJSON';\nimport { isNil } from '../utils/is';\nimport { SDKVariableStorage } from '../variables/VariableStorage';\n\nimport {\n  cacheTransactionTokenResponse,\n  getCachedTransactionTokenResponse,\n} from './cachedTransactionTokenResponse';\nimport { getAuthorizeUrl } from './getAuthorizeUrl';\nimport { getSecuredSessionType } from './getSecuredSessionType';\nimport { getIdentityToken } from './identityToken';\nimport { SecureSessions } from './SecureSessionsType';\nimport { TransactionTokenResponse } from './TransactionToken';\n\ninterface ThirdPartyAuthorizationPayload {\n  authorization_code: string;\n  code_verifier?: string;\n  grant_type: 'authorization_code';\n}\n\ninterface ThirdPartyAuthorizePayload {\n  thirdParty: ThirdPartyAuthorizationPayload;\n}\n\ninterface AnonymousAuthorizationPayload {\n  customerIdentity: {\n    idOnExternalPlatform: CustomerIdentityIdOnExternalPlatform;\n  };\n}\n\ntype AuthorizePayload =\n  | ThirdPartyAuthorizePayload\n  | AnonymousAuthorizationPayload;\n\nfunction getAuthorizePayload(\n  authorizationCode?: string,\n  customerIdentityIdOnExternalPlatform?: CustomerIdentityIdOnExternalPlatform | null,\n): AuthorizePayload {\n  const payload = {} as AuthorizePayload;\n\n  if (authorizationCode) {\n    (payload as ThirdPartyAuthorizePayload).thirdParty = {\n      authorization_code: authorizationCode,\n      grant_type: 'authorization_code',\n    };\n  }\n\n  if (!isNil(customerIdentityIdOnExternalPlatform)) {\n    (payload as AnonymousAuthorizationPayload).customerIdentity = {\n      idOnExternalPlatform: customerIdentityIdOnExternalPlatform,\n    };\n  }\n\n  return payload;\n}\n\nexport const getTransactionToken = async (\n  authorizationCode?: string,\n  customerIdentityIdOnExternalPlatform?: CustomerIdentityIdOnExternalPlatform | null,\n  cookieStorageFallback: boolean = false,\n  useCache: boolean = false,\n): Promise<\n  Partial<TransactionTokenResponse> & {\n    cached?: boolean;\n  }\n> => {\n  // Get cached token if available\n  if (useCache) {\n    const cachedTransactionResponse = getCachedTransactionTokenResponse();\n    if (cachedTransactionResponse) {\n      return {\n        ...cachedTransactionResponse,\n        identityToken:\n          getIdentityToken() ?? cachedTransactionResponse.identityToken,\n        cached: true,\n      };\n    }\n  }\n\n  // If 3rd party cookies are blocked, we need to \"activate\" the fallback on the server side by query parameter\n  const sendStorageFallbackQueryParameter =\n    cookieStorageFallback &&\n    getSecuredSessionType() === SecureSessions.SECURED_COOKIES;\n\n  // If we already have identity token and are in fallback mode,\n  // send authorization header to receive correct identity token\n  const identityToken = getIdentityToken();\n  const sendFallbackAuthorization =\n    sendStorageFallbackQueryParameter && identityToken;\n\n  // Request transaction token\n  const authorizeUrl = getAuthorizeUrl(sendStorageFallbackQueryParameter);\n  const data = await postJSON<TransactionTokenResponse>(\n    authorizeUrl,\n    getAuthorizePayload(\n      authorizationCode,\n      customerIdentityIdOnExternalPlatform,\n    ),\n    {\n      credentials: 'include',\n      headers: {\n        ...SDKVariableStorage.REQUEST_METADATA?.httpHeaders,\n        ...(sendFallbackAuthorization && {\n          Authorization: `Bearer ${identityToken}`,\n        }),\n      },\n    },\n  );\n\n  if (!data.accessToken) {\n    throw new ChatSDKError(ERROR_CANNOT_FETCH_TRANSACTION_TOKEN, { data });\n  }\n\n  cacheTransactionTokenResponse(data, data.expiresIn);\n\n  return data;\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\n\nexport function isIpAddressBlockedError(error: unknown): boolean {\n  return (\n    error instanceof ChatSDKError &&\n    // @ts-expect-error unknown data type\n    (error.data as unknown)?.responseBody?.errorCode === 'ip_blocked'\n  );\n}\n","import { getAuthorizationTokenForUrl } from '../authorization/getAuthorizationTokenForUrl';\nimport { ChatSDKError } from '../error/ChatSDKError';\nimport { ChatEventData } from '../event/ChatEvent';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport {\n  fetchMessageWithFullContent,\n  getUrlPathForMessageWithFullContent,\n} from './fetchMessageWithFullContent';\nimport { MessageCreatedEvent } from './isMessageCreatedEvent';\n\nexport async function getMessageWithFullContent(\n  messageCreatedEvent: MessageCreatedEvent,\n  websocketClient: WebSocketClient | null,\n): Promise<ChatEventData> {\n  if (\n    messageCreatedEvent.data.message.hasAdditionalMessageContent === false ||\n    websocketClient === null\n  ) {\n    return messageCreatedEvent;\n  }\n\n  try {\n    const { brand, message, thread } = messageCreatedEvent.data;\n    const messageUrl = getUrlPathForMessageWithFullContent(\n      brand.id,\n      message.id,\n    );\n    const authorizationToken = await getAuthorizationTokenForUrl(\n      thread.idOnExternalPlatform,\n      messageUrl,\n      websocketClient,\n    );\n    const messageWithFullContent = await fetchMessageWithFullContent(\n      message,\n      brand.id,\n      authorizationToken,\n    );\n\n    return {\n      ...messageCreatedEvent,\n      data: {\n        ...messageCreatedEvent.data,\n        message: messageWithFullContent,\n      },\n    };\n  } catch (error) {\n    throw new ChatSDKError('Failed to fetch additional message content', {\n      error,\n    });\n  }\n}\n","import { ChatEventData } from '../event/ChatEvent';\nimport { normalizeEvent } from '../event/normalizeEvent';\n\nimport { requestQueue } from './requestQueue';\n\nexport const parseWsMessageEvent = (\n  event: CustomEvent,\n): ChatEventData | undefined => {\n  const eventDetail = event?.detail;\n\n  if (!eventDetail) {\n    return;\n  }\n\n  let eventData;\n\n  try {\n    eventData = JSON.parse(eventDetail.data);\n  } catch (error) {\n    return;\n  }\n\n  return normalizeEvent(eventData);\n};\n\nexport const onMessageHandler = (event: ChatEventData): void => {\n  const { id } = event;\n\n  if (requestQueue.has(id)) {\n    const resolve = requestQueue.get(id);\n\n    if (typeof resolve === 'function') {\n      resolve(event);\n    }\n\n    requestQueue.delete(id);\n  }\n};\n","import { AwsResponseEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SetPositionInQueuePayloadData } from '@brandembassy/ts-types-chat/dist/awsEvents/SetPositionInQueuePayload';\nimport { EventId } from '@brandembassy/ts-types-platform/dist/pushUpdate/EventId';\n\nimport { ChatEventData } from '../../event/ChatEvent';\nimport { isEmpty } from '../../utils/is';\n\nexport interface SetPositionInQueueChatEvent extends ChatEventData {\n  data: SetPositionInQueuePayloadData;\n  id: EventId;\n  type: AwsResponseEventType.SET_POSITION_IN_QUEUE;\n}\n\nexport const isSetPositionInQueueEvent = (\n  event: unknown,\n): event is SetPositionInQueueChatEvent => {\n  const setPositionInQueueEvent = event as SetPositionInQueueChatEvent;\n\n  return (\n    Number.isInteger(setPositionInQueueEvent?.data.positionInQueue) &&\n    isEmpty(setPositionInQueueEvent?.id) === false &&\n    setPositionInQueueEvent?.type === AwsResponseEventType.SET_POSITION_IN_QUEUE\n  );\n};\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport class CreateInvitationFailedError extends ChatSDKError {\n  data: ChatEventData;\n\n  constructor(message: string, data: ChatEventData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { CreateInvitationToGroupChatEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/InvitationToGroupChat';\nimport { CaseId } from '@brandembassy/ts-types-platform/dist/post/case/CaseId';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { EventPayloadData } from '../sockets/EventPayload';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport { CreateInvitationFailedError } from './CreateInvitationFailedError';\n\nexport function createCreateInvitationToGroupChatPayloadData(\n  id: CaseId,\n): EventPayloadData<CreateInvitationToGroupChatEventData> {\n  return {\n    eventType: AwsInputEventType.CREATE_GROUP_CHAT_INVITE,\n    data: {\n      contact: {\n        id,\n      },\n    },\n  };\n}\n\nexport function isInvitationToGroupChatCreated(\n  response: ChatEventData,\n): boolean {\n  return response.type === ChatEvent.GROUP_CHAT_INVITE_CREATED;\n}\n\nexport async function sendCreateInvitationToGroupChatEvent(\n  createInvitationPayloadData: EventPayloadData<CreateInvitationToGroupChatEventData>,\n  wsClient: WebSocketClient | null,\n): Promise<ChatEventData> {\n  const response = await sendChatEvent(createInvitationPayloadData, wsClient);\n\n  if (isInvitationToGroupChatCreated(response)) {\n    return response;\n  }\n\n  throw new CreateInvitationFailedError('Create invitation failed', response);\n}\n","import { ChatSDKError } from './ChatSDKError';\n\nexport function isChatSDKError(\n  error: unknown,\n): error is InstanceType<typeof ChatSDKError> {\n  return error instanceof ChatSDKError && error?.data !== undefined;\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\nimport { ChatEventData } from '../event/ChatEvent';\n\nexport interface JoinGroupChatFailedErrorData {\n  response: ChatEventData;\n}\n\nexport class JoinGroupChatFailedError extends ChatSDKError {\n  data: JoinGroupChatFailedErrorData;\n\n  constructor(message: string, data: JoinGroupChatFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { JoinGroupChatEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/JoinGroupChat';\n\nimport { isChatSDKError } from '../error/isChatSDKError';\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { EventPayloadData } from '../sockets/EventPayload';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport { JoinGroupChatFailedError } from './JoinGroupChatFailedError';\n\nexport function createJoinGroupChatPayloadData(\n  code: string,\n): EventPayloadData<JoinGroupChatEventData> {\n  return {\n    eventType: AwsInputEventType.JOIN_GROUP_CHAT,\n    data: {\n      invitation: {\n        code,\n      },\n    },\n  };\n}\n\nexport function isJoinGroupChatSuccessResponse(\n  response: ChatEventData,\n): boolean {\n  return response.type === ChatEvent.GROUP_CHAT_JOINED;\n}\n\nexport async function sendJoinGroupChatEvent(\n  joinGroupChatPayloadData: EventPayloadData<JoinGroupChatEventData>,\n  wsClient: WebSocketClient | null,\n): Promise<ChatEventData> {\n  const response = await sendChatEvent(joinGroupChatPayloadData, wsClient);\n\n  if (isJoinGroupChatSuccessResponse(response)) {\n    return response;\n  }\n\n  throw new JoinGroupChatFailedError('Join Group chat failed', { response });\n}\n\nexport function isJoinGroupChatFailedError(\n  error: unknown,\n): error is InstanceType<typeof JoinGroupChatFailedError> {\n  return error instanceof JoinGroupChatFailedError && isChatSDKError(error);\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { LeaveGroupChatEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/LeaveGroupChat';\nimport { CaseId } from '@brandembassy/ts-types-platform/dist/post/case/CaseId';\n\nimport { ChatEventData } from '../event/ChatEvent';\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { EventPayloadData } from '../sockets/EventPayload';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nexport function createLeaveGroupChatPayloadData(\n  id: CaseId,\n): EventPayloadData<LeaveGroupChatEventData> {\n  return {\n    eventType: AwsInputEventType.LEAVE_GROUP_CHAT,\n    data: {\n      contact: {\n        id,\n      },\n    },\n  };\n}\n\nexport async function sendLeaveGroupChatEvent(\n  leaveGroupChatPayloadData: EventPayloadData<LeaveGroupChatEventData>,\n  wsClient: WebSocketClient | null,\n): Promise<ChatEventData> {\n  return sendChatEvent(leaveGroupChatPayloadData, wsClient);\n}\n","import { ChatSDKError } from '../error/ChatSDKError';\n\ninterface SendEmailInvitationFailedErrorData {\n  response: unknown;\n}\n\nexport class SendEmailInvitationFailedError extends ChatSDKError {\n  data: SendEmailInvitationFailedErrorData;\n\n  constructor(message: string, data: SendEmailInvitationFailedErrorData) {\n    super(message);\n    this.data = data;\n  }\n}\n","import { AwsInputEventType } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsEventType';\nimport { SendEmailInvitationToGroupChatEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendEmailInvitationToGroupChat';\nimport { CaseId } from '@brandembassy/ts-types-platform/dist/post/case/CaseId';\n\nimport { ChatEvent, ChatEventData } from '../event/ChatEvent';\nimport { sendChatEvent } from '../event/sendChatEvent';\nimport { EventPayloadData } from '../sockets/EventPayload';\nimport { WebSocketClient } from '../sockets/WebSocketClient';\n\nimport { SendEmailInvitationFailedError } from './SendEmailInvitationFailedError';\n\nexport function createSendEmailInvitationToGroupChatPayloadData(\n  caseId: CaseId,\n  invitationCode: string,\n  email: string,\n): EventPayloadData<SendEmailInvitationToGroupChatEventData> {\n  return {\n    eventType: AwsInputEventType.SEND_EMAIL_INVITE_TO_GROUP_CHAT,\n    data: {\n      contact: {\n        id: caseId,\n      },\n      invitation: {\n        code: invitationCode,\n      },\n      recipients: [\n        {\n          idOnExternalPlatform: email,\n        },\n      ],\n    },\n  };\n}\n\nexport function isEmailInvitationToGroupChatSent(\n  response: ChatEventData,\n): boolean {\n  return response.type === ChatEvent.GROUP_CHAT_INVITE_SENT;\n}\n\nexport async function sendEmailInvitationToGroupChatEvent(\n  createInvitationPayloadData: EventPayloadData<SendEmailInvitationToGroupChatEventData>,\n  wsClient: WebSocketClient | null,\n): Promise<ChatEventData> {\n  const response = await sendChatEvent(createInvitationPayloadData, wsClient);\n\n  if (isEmailInvitationToGroupChatSent(response)) {\n    return response;\n  }\n\n  throw new SendEmailInvitationFailedError('Send Email Invitation failed', {\n    response,\n  });\n}\n","export class CacheStorageError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'CacheStorageError';\n  }\n}\n","import { isUndefined } from '../utils/is';\n\nimport { CacheStorageError } from './CacheStorageError';\n\nexport interface ICacheStorage {\n  getItem<T = unknown>(key: string): T | null;\n  removeItem(key: string): void;\n  setItem(key: string, data: unknown, ttl: number): void;\n}\n\nexport interface CachedStorageItem {\n  data: unknown;\n  expiresAt: number;\n}\n\n/**\n * Cache storage wrapper\n * - A simple wrapper around the Storage API with a TTL (Time To Live) per item.\n * - Uses JSON.stringify and JSON.parse to serialize and deserialize data.\n * - Uses Date.getTime() to calculate the expiration time.\n *\n * @param storage - The storage instance (e.g., localStorage or sessionStorage).\n * @param keyPrefix - Optional key prefix\n */\nexport class CacheStorage implements ICacheStorage {\n  #storage: Storage;\n  #keyPrefix: string;\n\n  /**\n   * Create a new CacheStorage instance\n   * @param storage - storage instance\n   * @param keyPrefix - Optional key prefix for storage keys\n   * @throws CacheStorageError\n   */\n  constructor(storage: Storage, keyPrefix?: string) {\n    if (\n      !storage ||\n      !storage.getItem ||\n      !storage.setItem ||\n      !storage.removeItem\n    ) {\n      throw new CacheStorageError('CacheStorage: Storage is required');\n    }\n    this.#storage = storage;\n    this.#keyPrefix = keyPrefix ?? '';\n  }\n\n  /**\n   * Get an item from the storage if not expired\n   * @param key - key\n   */\n  public getItem<T = unknown>(key: string): T | null {\n    const item = this.#storage.getItem(this.#keyPrefix + key);\n\n    if (!item) {\n      return null;\n    }\n\n    const { data = undefined, expiresAt = 0 }: CachedStorageItem =\n      JSON.parse(item);\n    const isExpired = expiresAt < new Date().getTime();\n\n    if (isExpired || isUndefined(data)) {\n      this.#storage.removeItem(key);\n\n      return null;\n    }\n\n    return data as T;\n  }\n\n  /**\n   * Remove an item from the storage\n   * @param key - key\n   */\n  public removeItem(key: string): void {\n    this.#storage.removeItem(this.#keyPrefix + key);\n  }\n\n  /**\n   * Save an item in the storage with a ttl\n   * @param key - key\n   * @param data - data to store\n   * @param ttl - time to live in milliseconds\n   */\n  public setItem(key: string, data: unknown, ttl: number): void {\n    const item: CachedStorageItem = {\n      data,\n      expiresAt: new Date().getTime() + ttl,\n    };\n\n    this.#storage.setItem(this.#keyPrefix + key, JSON.stringify(item));\n  }\n}\n","export interface CustomerReconnectSuccessPayloadData {\n  reconnected: true;\n}\n\nexport function isCustomerReconnectSuccessPayloadData(\n  payload: unknown,\n): payload is CustomerReconnectSuccessPayloadData {\n  if (typeof payload !== 'object' || payload === null) {\n    return false;\n  }\n\n  if (!('reconnected' in payload)) {\n    return false;\n  }\n\n  return payload.reconnected === true;\n}\n","import { ChannelInfo } from '@brandembassy/ts-types-chat/dist/channel/ChannelInfo';\nimport { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\n\nimport { getBrowserLanguage } from '../browserFingerprint/getBrowserFingerprint';\nimport {\n  EnvironmentName,\n  buildEnvironmentEndpoints,\n} from '../env/Environments';\n\nimport { ChannelInfoOptions } from './ChannelInfoOptions';\nimport { fetchChannelInfo } from './fetchChannelInfo';\n\n/**\n * Get channel info\n * Returns channel info like feature toggle status, translations, file upload restrictions, theme color settings etc.\n * @see {@link ChannelInfo}\n */\nexport async function getChannelInfo(\n  brandId: BrandId,\n  channelId: ChannelId,\n  language = getBrowserLanguage(),\n  options: ChannelInfoOptions,\n): Promise<ChannelInfo> {\n  const { httpHeaders, environment, customEnvironment, appName, appVersion } =\n    options;\n\n  const additionalHttpHeaders = {\n    ...(httpHeaders ?? {}),\n    ...(appVersion ? { 'x-app-version': String(appVersion) } : {}),\n  };\n\n  const chatEndpoint =\n    environment === EnvironmentName.custom\n      ? customEnvironment.chat\n      : buildEnvironmentEndpoints(environment).chat;\n\n  return fetchChannelInfo(\n    brandId,\n    channelId,\n    language,\n    chatEndpoint,\n    additionalHttpHeaders,\n    appName,\n  );\n}\n","import { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nimport { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\n\nimport {\n  EnvironmentName,\n  buildEnvironmentEndpoints,\n} from '../env/Environments';\n\nimport { ChannelAvailabilityOptions } from './ChannelAvailabilityOptions';\nimport {\n  ChannelAvailabilityResponse,\n  fetchChannelAvailability,\n} from './fetchChannelAvailability';\n\n/**\n * Get channel availability\n * Returns the availability status of a channel, indicating whether it is online or offline.\n * @see {@link ChannelAvailabilityResponse}\n */\nexport async function getChannelAvailability(\n  brandId: BrandId,\n  channelId: ChannelId,\n  options: ChannelAvailabilityOptions,\n): Promise<ChannelAvailabilityResponse> {\n  const { httpHeaders, appName, appVersion, customEnvironment, environment } =\n    options;\n\n  const additionalHttpHeaders = {\n    ...(httpHeaders ?? {}),\n    ...(appVersion ? { 'x-app-version': String(appVersion) } : {}),\n  };\n\n  const chatEndpoint =\n    environment === EnvironmentName.custom\n      ? customEnvironment.chat\n      : buildEnvironmentEndpoints(environment).chat;\n\n  return fetchChannelAvailability(\n    brandId,\n    channelId,\n    chatEndpoint,\n    additionalHttpHeaders,\n    appName,\n  );\n}\n","import { User } from '@brandembassy/ts-types-platform/dist/user/User';\nimport { UserId } from '@brandembassy/ts-types-platform/dist/user/UserId';\n\nimport { ChatSdk } from './ChatSdk';\n\n// Export runtime classes and types\nexport type { SendMessageEventData } from '@brandembassy/ts-types-chat/dist/awsEvents/SendMessage';\nexport type { ConsumerIdentityInput as CustomerIdentity } from '@brandembassy/ts-types-chat/dist/awsEvents/AwsInputEvent';\nexport type { CaseInboxAssigneeChangedData as AssignedAgentChangedData } from '@brandembassy/ts-types-platform/dist/post/case/CaseInboxAssigneeChangedEvent';\nexport { MessageType } from '@brandembassy/ts-types-platform/dist/message/MessageType';\nexport { WebSocketClientEvent } from '@brandembassy/push-updates-sdk';\nexport { WebSocketClientError } from './sockets/WebSocketClientError';\nexport { ChatEvent } from './event/ChatEvent';\nexport type { ChatEventType } from './event/ChatEvent';\nexport { sendChatEvent } from './event/sendChatEvent';\nexport { EnvironmentName, EnvironmentEndpoints } from './env/Environments';\nexport * from './agent';\nexport * from './thread';\nexport * from './contact';\nexport * from './ChatSdk';\nexport * from './message';\nexport { Customer } from './customer/Customer';\nexport type { Customer as CustomerView } from '@brandembassy/ts-types-platform/dist/customer/customer';\nexport * from './utils/narrowing';\nexport { generateId } from './utils/generateId';\nexport { splitName } from './utils/splitName';\nexport type {\n  AuthorizationCallback,\n  ChatSDKOptions,\n  ErrorCallback,\n  RawEventCallback,\n} from './ChatSDKOptions';\nexport type { SecureSessionsType } from './securedSession/SecureSessionsType';\nexport { SecureSessions } from './securedSession/SecureSessionsType';\nexport * from './groupChat';\nexport * from './utils/AbortablePromise';\nexport { AbortError } from './error/AbortError';\nexport { ChatSDKError } from './error/ChatSDKError';\nexport { isChatSDKError } from './error/isChatSDKError';\nexport { IpAddressBlockedError } from './error/IpAddressBlockedError';\nexport { SdkVersionNotSupported } from './error/SdkVersionNotSupported';\nexport {\n  getBrowserFingerprint,\n  getDeviceType,\n  BrowserFingerprintOptions,\n  getBrowserLanguage,\n  getBrowserLocation,\n  getValidLanguage,\n} from './browserFingerprint/getBrowserFingerprint';\nexport {\n  CacheStorage,\n  ICacheStorage,\n  CachedStorageItem,\n} from './storage/CacheStorage';\nexport { CacheStorageError } from './storage/CacheStorageError';\nexport * from './attachment/sendAttachments';\n\n// Export types for API Docs availability\nexport * from './authorization/AuthorizeConsumerEventResponse';\nexport type { BrandId } from '@brandembassy/ts-types-platform/dist/brand/BrandId';\nexport type { ChannelId } from '@brandembassy/ts-types-platform/dist/channel/ChannelId';\nexport {\n  ChannelAvailability,\n  ChannelInfo,\n} from '@brandembassy/ts-types-chat/dist/channel/ChannelInfo';\nexport type { ChannelAvailabilityResponse } from './channel/fetchChannelAvailability';\nexport { Thread as ThreadView } from '@brandembassy/ts-types-platform/dist/thread/Thread';\nexport type { CustomerIdentityIdOnExternalPlatform } from '@brandembassy/ts-types-platform/dist/endUser/EndUserIdentityId';\nexport type { WebSocketClient } from './sockets/WebSocketClient';\nexport type {\n  EventListenerFunction,\n  RemoveListenerFunction,\n} from './event/ListenerFunction';\nexport type { IChatEventTarget } from './event/ChatEventTarget';\nexport type { ChatEventData } from './event/ChatEvent';\nexport type { MoreMessagesLoadedEvent } from './message/loadMoreMessagesEventData';\nexport type { ThreadRecoveredPostbackData } from '@brandembassy/ts-types-chat/dist/awsEvents/ThreadRecovered';\nexport type { MessageSuccessEventData } from './message/MessageSuccessEventData';\nexport type { ConsumerAuthorizationSuccessPayloadData } from '@brandembassy/ts-types-chat/dist/authorization/ConsumerAuthorizationSuccessPayloadData';\nexport type { UploadFailResponse } from './attachment/uploadAttachment';\nexport { UploadAttachmentError } from './attachment/UploadAttachmentError';\nexport type Agent = User;\nexport type AgentId = UserId;\nexport type { AuthorizationToken } from '@brandembassy/ts-types-chat/dist/authorization/AuthorizationToken';\nexport type {\n  TransactionToken,\n  TransactionTokenResponse,\n} from './securedSession/TransactionToken';\nexport type { OfflineMessageData } from './message/sendOfflineMessage';\nexport type { EventPayloadData } from './sockets/EventPayload';\nexport type { ThreadRecoveredChatEvent } from './thread/isRecoverSuccessPayload';\nexport * from './authorization/createReconnectPayloadData';\nexport * from './authorization/CustomerReconnectSuccessPayloadData';\nexport { AuthorizationError } from './authorization/AuthorizationError';\nexport { CHAT_SDK_VERSION } from './env/version';\nexport { registerWindowUnload, isWindowClosing } from './utils/isWindowClosing';\nexport type { CustomFieldsObject } from './customField/CustomFields';\nexport {\n  getCustomFieldsArray,\n  getCustomFieldsFromArray,\n} from './customField/CustomFields';\nexport { getChannelInfo } from './channel/getChannelInfo';\nexport type { ChannelInfoOptions } from './channel/ChannelInfoOptions';\nexport { getChannelAvailability } from './channel/getChannelAvailability';\nexport type { ChannelAvailabilityOptions } from './channel/ChannelAvailabilityOptions';\nexport type { NetworkRequestMetadata } from './request/NetworkRequestMetadata';\nexport type { IStorage } from './storage/Storage';\n\n// Export the ChatSDK as default\nexport default ChatSdk;\n"],"names":["root","factory","exports","module","require","define","amd","a","i","self","__WEBPACK_EXTERNAL_MODULE__198__","PushUpdateEventType","queryParameters","Object","keys","filter","key","map","encodeURIComponent","join","CaseStatus_1","defineProperty","enumerable","get","CaseStatus","WebSocketClientEvent_1","WebSocketClientEvent","pushUpdateWebSocket_1","setupSocketConnection","extendStatics","__extends","this","d","b","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","value","WebSocketClient","HEART_BEAT_CHECK_TIMEOUT","HEART_BEAT_INTERVAL","Logger_1","ReconnectingWebSocket_1","EventTargetPolyfill_1","HeartBeatState_1","_super","url","protocols","options","_this","heartBeatTimeout","heartBeatCheckTimeout","enableDebugMode","debugMode","log","LogLevels","INFO","disableDebugMode","level","message","args","logger","sendHeartBeat","send","JSON","stringify","action","handleHeartBeatResponse","heartBeatState","HeartBeatState","DYING","LIVING","dispatchHeartBeatState","setHeartBeatCheckTimeout","clearTimeout","setTimeout","heartbeatState","dispatchEvent","CustomEvent","isHeartBeatActive","socket","ReconnectingWebSocket","onopen","OPEN","onclose","closeEvent","retryCount","maxRetries","DIED","CLOSE","detail","onmessage","event","parse","data","MESSAGE","onerror","ERROR","startHeartBeat","interval","heartBeatCallback","stopHeartBeat","EventTargetPolyfill","ChannelAvailability","listeners","addEventListener","type","callback","push","removeEventListener","stack","l","length","splice","slice","defaultPrevented","MessageType","DeviceType","ApplicationType","AwsInputEventType","AwsResponseEventType","removeEmptyValuesFromObject","objectData","entries","_a","reduce","result","AwsChatWindowEventActionRoute","__assign","assign","t","s","n","arguments","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","getPushUpdateWebSocket","queryParameters_1","initializeHeartbeat_1","object_1","WebSocketClient_1","defaultConnectionOptions","forceSecureProtocol","heartbeatAfterAuthorize","maxReconnectionDelay","urlProvider","concat","connectionOptions","tenantId","userId","brandId","wscOptions","webSocketUrlWithoutProtocol","query","queryString","createQueryParametersAsString","protocol","window","location","URL","search","createWebSocketUrlWithProtocol","undefined","initializeHeartbeat","handleMessage","payload","authorizationStatus","error","warn","__values","o","Symbol","iterator","m","next","done","__read","r","ar","__spreadArray","to","from","pack","DEFAULT","minReconnectionDelay","Math","random","minUptime","reconnectionDelayGrowFactor","connectionTimeout","Infinity","maxEnqueuedMessages","startClosed","debug","_listeners","open","close","_shouldReconnect","_connectLock","_closeCalled","_messageQueue","_retryCount","_binaryType","_handleOpen","_debug","_options","_connectTimeout","_uptimeTimeout","_acceptOpen","_ws","binaryType","forEach","listener","_callEventListener","_handleMessage","_handleError","_disconnect","_connect","_handleClose","_clearTimeouts","_url","_protocols","_maxRetries","max","configurable","set","acc","Blob","size","byteLength","bufferedAmount","extensions","readyState","WebSocket","CLOSED","CONNECTING","code","reason","reconnect","e_1","listeners_1","listeners_1_1","e_1_1","return","setMaxRetires","_i","console","_getNextDelay","_b","_c","_d","delay","pow","_wait","Promise","resolve","_getNextUrl","then","Error","_removeListeners","_addListeners","_handleTimeout","catch","err","ErrorEvent","CloseEvent","handleEvent","MessageDirection","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","definition","obj","prop","toStringTag","setAccessToken","accessToken","ACCESS_TOKEN","token","ACCESS_TOKEN_EXPIRES_IN","expiresIn","getAccessToken","Number","ChatSDKError","super","name","cause","additionalInfo","AuthorizationError","errorMessage","CHAT_SDK_VERSION","generateId","crypto","randomUUID","randomValues","Uint8Array","getRandomValues","uuid","index","includes","toString","padStart","generateUuidFallback","createVisitorPayload","visitorId","visitor","id","objectProto","Ctor","func","transform","arg","global","freeSelf","Function","nativeObjectToString","symToStringTag","isOwn","tag","unmasked","uid","maskSrcKey","exec","IE_PROTO","funcToString","reIsHostCtor","reIsNative","RegExp","replace","test","object","mapTag","promiseTag","setTag","weakMapTag","dataViewTag","dataViewCtorString","mapCtorString","promiseCtorString","setCtorString","weakMapCtorString","getTag","ArrayBuffer","ctorString","isArray","freeExports","nodeType","freeModule","Buffer","isBuffer","typedArrayTags","freeProcess","process","nodeUtil","types","binding","nodeIsTypedArray","isTypedArray","requestQueue","Map","makeRequest","async","wsClient","eventId","MAXIMUM_REQUEST_COUNT","TIME_SLOT_IN_SECONDS","requestRateLimitCounter","requestCounterIntervalId","MaximumRequestCountReachError","resetLimitCounter","splitName","firstName","names","split","ERROR_CANNOT_REFRESH_THIRD_PARTY_TOKEN","ERROR_CANNOT_FETCH_TRANSACTION_TOKEN","ERROR_IP_ADDRESS_BLOCKED","setCustomFields","fields","ident","validateCustomField","setCustomFieldsFromArray","getCustomFields","fromEntries","getCustomFieldsArray","getCustomFieldsFromArray","field","isCustomFieldValueValid","getCustomFieldMaxLengthErrorMessage","setCustomerIdentity","customer","customerIdentity","idOnExternalPlatform","lastName","image","customFields","setId","setName","trim","setImage","Customer","websocketClient","getIdOrCreateNewOne","customerId","getId","destroy","customerIdentityIdOnExternalPlatform","getName","getImage","setExists","exists","setWebsocketClient","setCustomField","sendCustomFields","sendChatEvent","eventType","SEND_CONSUMER_CUSTOM_FIELDS","CustomerInstance","getInstance","instance","createCustomerIdentityPayload","storedName","storedImage","customerIdentityNamePayload","getBrandIdAndChannelId","BRAND_ID","channelId","CHANNEL_ID","isNaN","createEventPayload","eventPayloadData","storedDestinationId","DESTINATION","storedVisitId","VISIT_ID","storedVisitorId","VISITOR_ID","consumerIdentity","destination","visit","brand","channel","createEvent","actionRoute","AwsChatWindowEvent","CHAT_WINDOW_EVENT","payloadData","webSocketClient","setInterval","requestRateLimit","createReconnectPayloadData","RECONNECT_CONSUMER","refreshTokenTimeoutId","handleRefreshToken","refreshTokenAction","accessTokenExpiresIn","idealTimeToRefreshAccessToken","round","getIdealTimeInSecondsForIssueRefreshToken","getAuthorizationTokenForUrl","threadIdOnExternalPlatform","threadId","GENERATE_AUTHORIZATION_TOKEN","thread","createGenerateAuthorizationTokenPayloadData","authorizationToken","isAuthSuccessEvent","status","CONSUMER_AUTHORIZED","isTokenRefreshedSuccessResponse","response","TOKEN_REFRESHED","getBrowserLanguage","navigator","language","getBrowserLocation","Intl","DateTimeFormat","resolvedOptions","timeZone","getDeviceType","deviceType","MOBILE","TABLET","DESKTOP","getBrowserFingerprint","deviceInfoFromUserAgent","userAgent","country","ip","browser","getBrowser","browserVersion","version","os","getOS","osVersion","getDevice","applicationType","BROWSER","getValidLanguage","cleanedLanguage","getCanonicalLocales","Locale","baseName","getDefaultHeaders","requestMetadata","callerServiceId","requestMetadataHeaders","Accept","APP_NAME","AbortError","ERROR_CODE_SDK_VERSION_NOT_SUPPORTED","SdkVersionNotSupported","isSdkVersionNotSupportedEvent","errorCode","sdkVersionCheck","getNetworkInfo","connection","effectiveType","downlink","rtt","online","onLine","isPageUnloading","isWindowClosing","unloadHandler","registerWindowUnload","SecureSessions","fetchJSON","resource","signal","headers","restOptions","abortController","AbortController","onAbort","abort","once","requestInit","requestTimeStart","Date","now","fetch","ok","errorResponseData","rawDataAsString","text","statusText","getErrorResponseData","requestDuration","requestUrl","requestOptions","responseStatus","responseStatusText","networkInfo","aborted","abortableFetch","json","getJSON","method","postJSON","body","fetchChannelAvailability","chatEndpoint","requestMetadataHttpHeaders","fetchChannelInfo","getSecuredSessionType","SECURED_SESSION","shouldHandleCustomerIdForSecureSessions","ANONYMOUS","isSecureSessions","EnvironmentName","EnvironmentToPublicDNS","AE1","AU1","AU2","CA1","EU1","EU2","JO1","JP1","KR1","NA1","NA2","UK1","UK2","ZA1","custom","buildEnvironmentEndpoints","environment","publicDNS","chat","toLowerCase","gateway","authorize","setEnvironmentEndpoints","endpoints","assertEndpoint","ENDPOINT_GATEWAY","ENDPOINT_CHAT","ENDPOINT_AUTHORIZE","endpoint","endpointName","validateEndpoint","IpAddressBlockedError","ChatEvent","AGENT_TYPING_STARTED","AGENT_TYPING_ENDED","ASSIGNED_AGENT_CHANGED","CONTACT_CREATED","CONTACT_STATUS_CHANGED","CONTACT_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED","ChatCustomEvent","ChatEventMiddleware","middlewares","register","middleware","processedEvent","ChatEventTarget","EventTarget","isOutbound","direction","EMPTY_EVENT","createdAt","toISOString","normalizeEvent","hasEventId","hasError","hasEventType","hasData","context","eventDetailData","postback","isDataWithPostback","postbackData","postbackEventType","rawEventId","restEventData","eventRest","eventTypeMap","SENDER_TYPING_STARTED","SENDER_TYPING_ENDED","CASE_INBOX_ASSIGNEE_CHANGED","CASE_CREATED","CASE_STATUS_CHANGED","CASE_TO_ROUTING_QUEUE_ASSIGNMENT_CHANGED","LIVECHAT_RECOVERED","normalizedContactHistoryItems","contactHistory","chatEventMapper","item","Boolean","THREAD_RECOVERED","assertIsCallable","initializeRequestMetadata","onError","httpHeaders","entry","headerKey","headerObject","Headers","append","validateAndFilterHeader","validateAndFilterHttpHeaders","networkRequestMetadata","websocketQuery","queryKey","searchParams","URLSearchParams","validateAndFilterQueryParam","validateAndFilterWebSocketQuery","isSendMessageSuccessEventData","SendMessageFailedError","getAuthor","INBOUND","authorEndUserIdentity","fullName","authorUser","surname","isMessage","hasId","hasDirection","hasMessageContent","messageContent","isMessageCreatedEvent","MESSAGE_CREATED","isMessageSentEvent","MESSAGE_SENT","isMessageReadChangedEvent","MESSAGE_READ_CHANGED","getUrlPathForMessageWithFullContent","messageId","isS3ChatEvent","EVENT_IN_S3","TRANSACTION_TOKEN_CACHE_KEY","getAuthorizeUrl","storageFallback","authorizeUrl","pathname","IDENTITY_TOKEN_KEY","getIdentityToken","IDENTITY_TOKEN","STORAGE","getItem","getThirdPartyToken","THIRD_PARTY_TOKEN","refreshThirdPartyToken","refreshUrl","thirdParty","grant_type","refresh_token","credentials","REQUEST_METADATA","handleNewThirdPartyToken","setThirdPartyToken","expires_in","WebSocketClientError","WsEventTarget","socketURLGetter","connect","disconnect","stringData","on","handlerCallback","off","_errorHandler","eventError","startsWith","errorHandlerBound","bind","AUTHORIZATION_FAILED","UploadAttachmentError","createAttachmentPayload","file","abortSignal","attachment","reader","reject","FileReader","onloadend","errorEvent","target","readAsDataURL","createLocalFileReader","mimeType","createPayloadForAttachmentUpload","uploadAttachmentResponse","fileName","requestBody","content","uploadAttachment","fileUrl","friendlyName","allowedFileSize","isUploadFailResponse","isAttachmentUpload","files","every","createTemporaryAttachmentsUpload","all","createAttachmentUploadMessageData","attachments","browserFingerprint","TEXT","consumer","consumerContact","isContactStatusChangedEvent","case","isContactCreatedEvent","isContactToRoutingQueueAssignmentChangedEvent","isContactRecipientsChangedEvent","CONTACT_RECIPIENTS_CHANGED","createMessageData","isLoadMoreMessagesEventData","MORE_MESSAGES_LOADED","messages","createLoadMoreMessagesPayloadData","eventData","LOAD_MORE_MESSAGES","AbortablePromise","executor","abortReason","_abortReason","promise","ArchiveThreadFailedError","GetMetadataFailedError","isLoadMetadataSuccessPayload","THREAD_METADATA_LOADED","lastMessage","isRecoverSuccessPayload","testResponseData","isThreadArchivedSuccessPayload","THREAD_ARCHIVED","LoadMoreMessagesFailedError","createRecoverThreadPayloadData","emptyData","RECOVER_THREAD","SetThreadNameFailedError","ThreadRecoverFailedError","Thread","messageEmitter","isAuthorizationEnabled","_existsOnPlatform","_typingTimeoutID","_isAuthorizationEnabled","_customFields","_typingPreviewText","_websocketClient","_messageEmitter","_customer","_registerEventHandlers","recover","sendMessage","messageData","assertNonEmptyTextMessageContent","sendMessagePayloadData","SEND_MESSAGE","_mergeCustomFieldsAndAccessTokenWithMessageData","sendTextMessage","messageText","textMessageContent","getTextMessageContent","sendPostbackMessage","postbackMessageContent","getPostbackMessageContent","sendOutboundMessage","sendOutboundMessagePayloadData","SEND_OUTBOUND","loadMoreMessages","scrollToken","oldestMessageDatetime","THREAD_DATA","loadMoreMessagesEventData","lastMessageSeen","MESSAGE_SEEN","sendAttachments","keystroke","timeout","onSendCallback","_stopTypingCallback","stopTyping","keystrokeForPreview","currentText","_typingForPreviewTimeoutID","stopTypingForPreview","shouldSendPreview","currentPreviewText","sendMessagePreview","getMetadata","LOAD_THREAD_METADATA","onThreadEvent","handler","filteredEventHandler","eventThreadId","dataWithThread","messagePreview","getThreadId","filterCurrentThreadEventHandler","selectedFieldIdents","customField","SET_CONSUMER_CONTACT_CUSTOM_FIELD","removeCustomField","delete","archive","ARCHIVE_THREAD","updateThreadData","threadName","UPDATE_THREAD","isUpdateThreadSuccess","SEND_MESSAGE_PREVIEW","createSendMessagePreviewPayloadData","sendTranscript","contactNumber","email","SEND_TRANSCRIPT","consumerRecipients","createSendTranscriptPayloadData","_setExistsOnPlatform","_setExistsOnPlatformBasedOnContactStatus","eventDetail","contact","ContactStatus","_setCustomerExists","_clearCustomFieldsOnContactStatusChangedToClosed","clear","_mergeCustomFieldsWithMessageData","_mergeAccessTokenWithMessageData","storedThirdPartyToken","storedAccessToken","access_token","messageDataWithCustomFields","createRecoverLivechatThreadPayloadData","RECOVER_LIVECHAT","LivechatThread","_isInitialized","_canSendMessage","_registerLivechatEventHandlers","startChat","initialMessageText","endChat","threadData","contactId","END_CONTACT","createEndThreadPayloadData","isThreadListFetchedPostbackData","storeContactId","originalThreadData","storeContactIdMiddleware","storeThreadScrollData","scrollData","array","oldThreadData","storeThreadScrollDataMiddleware","messagesScrollToken","ChatSdk","res","rej","getPromiseWithResolvers","refreshTokenResponse","REFRESH_TOKEN","customerImage","customerName","AUTHORIZATION_CODE","authorizationCode","appName","APP_VERSION","appVersion","destinationId","visitId","LANGUAGE","secureSessionsOption","values","getSecureSessionsTypeFromOptions","securedSession","identityToken","storage","setItem","removeItem","cacheStorage","CACHE_STORAGE","initializeSdkVariables","customerIdOption","setCustomerIdFromOptions","onAuthorization","onRawEvent","isLivechat","THIRD_PARTY","isThirdPartyCookiesSupported","ready","getChannelInfo","getChannelAvailability","reconnectResponse","refreshTokenEventCallback","reconnectPayload","reconnected","authorizationReconnect","basicChannelInfoRequest","channelInfo","isLiveChat","handleBasicChannelInfo","authorizationPayloadData","AUTHORIZE_CUSTOMER","authorization","disableChannelInfo","sdkVersion","sdkPlatform","createAuthorizationPayloadData","authEvent","REGISTER","authorizationRequest","authResponse","basicChannelInfo","generateAuthorizationToken","onChatEvent","getCustomer","getThread","cachedThread","liveThread","_getContactCustomFieldsFromQueue","getThreadList","eventPayload","FETCH_THREAD_LIST","threads","getWebsocketClient","sendOfflineMessage","offlineMessageData","offlineMessagePayloadData","reverse","authorCustomerIdentity","SEND_OFFLINE_MESSAGE","createSendOfflineMessagePayloadData","recoverThreadData","recoverEvent","recoverResponse","recoverLivechatThreadData","resetSession","isAssignedAgentChangedEvent","isAgentTypingStartedEvent","isAgentTypingEndedEvent","sdkError","assertNonNullable","useCache","cookieStorageFallback","SECURED_COOKIES","transactionTokenResponse","cachedTransactionResponse","cached","sendStorageFallbackQueryParameter","sendFallbackAuthorization","authorization_code","getAuthorizePayload","Authorization","getTransactionToken","responseBody","isIpAddressBlockedError","customMetadataHeaders","v","transactionToken","queryParametersAsString","customEnvironment","client","messageCreatedEvent","hasAdditionalMessageContent","messageUrl","messageWithFullContent","fetchMessageWithFullContent","getMessageWithFullContent","s3Object","getEventData","parseWsMessageEvent","parsedEvent","has","onMessageHandler","isSetPositionInQueueEvent","setPositionInQueueEvent","isInteger","positionInQueue","SET_POSITION_IN_QUEUE","CreateInvitationFailedError","createCreateInvitationToGroupChatPayloadData","CREATE_GROUP_CHAT_INVITE","sendCreateInvitationToGroupChatEvent","createInvitationPayloadData","GROUP_CHAT_INVITE_CREATED","isInvitationToGroupChatCreated","isChatSDKError","JoinGroupChatFailedError","createJoinGroupChatPayloadData","JOIN_GROUP_CHAT","invitation","sendJoinGroupChatEvent","joinGroupChatPayloadData","GROUP_CHAT_JOINED","isJoinGroupChatSuccessResponse","isJoinGroupChatFailedError","createLeaveGroupChatPayloadData","LEAVE_GROUP_CHAT","sendLeaveGroupChatEvent","leaveGroupChatPayloadData","SendEmailInvitationFailedError","createSendEmailInvitationToGroupChatPayloadData","caseId","invitationCode","SEND_EMAIL_INVITE_TO_GROUP_CHAT","recipients","sendEmailInvitationToGroupChatEvent","GROUP_CHAT_INVITE_SENT","isEmailInvitationToGroupChatSent","CacheStorageError","CacheStorage","keyPrefix","expiresAt","getTime","ttl","isCustomerReconnectSuccessPayloadData","additionalHttpHeaders"],"sourceRoot":""}